"use strict";

var flat = {};
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var ImageResourceStatus = {
    INITIATING: 'Initiating',
    FAILED: 'Failed',
    LOADING: 'Loading',
    LOADED: 'Loaded'
};

var ImageResource = function () {
    function ImageResource() {
        _classCallCheck(this, ImageResource);

        this.progress = 0;
        this.status = ImageResourceStatus.INITIATING;
        this.onLoad = null;
        this.onProgress = null;
        this.onStatusChanged = null;
    }

    _createClass(ImageResource, [{
        key: 'setProgress',
        value: function setProgress(progress) {
            this.progress = progress;

            if (this.onProgress) {
                this.onProgress(this.progress);
            }
        }
    }, {
        key: 'setStatus',
        value: function setStatus(status) {
            this.status = status;

            if (this.onStatusChanged) {
                this.onStatusChanged(this.status);
            }

            switch (this.status) {
                case ImageResourceStatus.INITIATING:
                    break;

                case ImageResourceStatus.FAILED:
                    break;

                case ImageResourceStatus.LOADING:
                    break;

                case ImageResourceStatus.LOADED:
                    this.progress = 1;
                    if (this.onLoad) {
                        this.onLoad();
                    }
                    break;

                default:
            }
        }
    }, {
        key: 'setTriggers',
        value: function setTriggers() {
            var _this = this;

            if (this.img) {
                this.promise = new Promise(function (resolve, reject) {
                    _this.img.onloadstart = function () {
                        _this.setStatus(ImageResourceStatus.LOADING);
                    };
                    _this.img.onprogress = function (progress) {
                        _this.progress = _this.setProgress(progress);
                    };
                    _this.img.onload = function () {
                        _this.setStatus(ImageResourceStatus.LOADED);
                        resolve(_this);
                    };
                    _this.img.onerror = function (error) {
                        _this.setStatus(ImageResourceStatus.FAILED);
                        reject(error);
                    };
                });
            }
        }
    }, {
        key: 'setSource',
        value: function setSource(source) {
            if (source) {
                if (source instanceof Image) {
                    if (source.src) {
                        this.img = source;

                        if (source.completed) {
                            this.setStatus(ImageResourceStatus.LOADED);
                        } else {
                            this.setTriggers();
                        }
                    } else {
                        console.error('ImageResource requires a proper source.');
                    }
                } else if (typeof source == 'string') {
                    this.img = new Image();

                    this.setTriggers();

                    this.img.src = source;
                }

                return this.promise;
            } else {
                console.error('ImageResource requires a proper source.');
            }
        }
    }, {
        key: 'loaded',
        get: function get() {
            return this.status == ImageResourceStatus.LOADED;
        }
    }], [{
        key: 'IMAGE_STATUS',
        get: function get() {
            return ImageResourceStatus;
        }
    }]);

    return ImageResource;
}();

var Resources = function () {
    function Resources() {
        _classCallCheck(this, Resources);

        this.imageCache = new Map();
    }

    /**
    * @method addImage - Add an image resource and starts loading it if possible.
    * @param {Object|string} imgSource - image source. It may be an img element object or the img url string.
    * @param {string} [alias] - image alias used to retrieve resource. if imgSource is a string and alias is not specified, then the alias will be set to the imgSource.
    * @return {Promisse} - promise that fullfills when the resource has loaded.
    */


    _createClass(Resources, [{
        key: 'addImage',
        value: function addImage(imgSource, alias) {
            if (typeof imgSource == 'string' && !alias) {
                alias = imgSource;
            }

            var newImageResource = new ImageResource();

            if (!alias) {
                console.log('Resources.addImage: alias not set and thus this image will not be cached!');
            } else {
                if (this.imageCache.has(alias)) {
                    window.alert('Resources.addImage: image alias "' + alias + '" is already being used and will be overwritten.');
                }

                this.imageCache.set(alias, newImageResource);
            }

            return newImageResource.setSource(imgSource);
        }

        /**
        * @method addImages - Same as addImage but for multple image resources.
        * @param {Array} sources - each element should be an array that matches the arguments of the addImage method: [imgSource, alias].
        * @return {Promisse} - promise that fullfills when all resources have loaded.
        */

    }, {
        key: 'addImages',
        value: function addImages(sources) {
            if (!(sources instanceof Array)) {
                console.error('Resources.addImages: argument is not an array');

                return;
            }

            var promises = [];

            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = sources[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var aguments = _step.value;

                    promises.push(this.addImage.apply(this, aguments));
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }

            return Promise.all(promises);
        }

        /**
        * @method getImage - returns the img element object respective to the given alias.
        */

    }, {
        key: 'getImage',
        value: function getImage(alias) {
            var cache = this.imageCache.get(alias);

            if (!cache) {
                console.error('Resources.getImage: could not find alias "${alias}"');
            }

            return cache;
        }
    }]);

    return Resources;
}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsYXNzZXMvZmxhdC5qcyIsImNsYXNzZXMvcmVzb3VyY2VzLmpzIl0sIm5hbWVzIjpbImZsYXQiLCJJbWFnZVJlc291cmNlU3RhdHVzIiwiSU5JVElBVElORyIsIkZBSUxFRCIsIkxPQURJTkciLCJMT0FERUQiLCJJbWFnZVJlc291cmNlIiwicHJvZ3Jlc3MiLCJzdGF0dXMiLCJvbkxvYWQiLCJvblByb2dyZXNzIiwib25TdGF0dXNDaGFuZ2VkIiwiaW1nIiwicHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwib25sb2Fkc3RhcnQiLCJzZXRTdGF0dXMiLCJvbnByb2dyZXNzIiwic2V0UHJvZ3Jlc3MiLCJvbmxvYWQiLCJvbmVycm9yIiwiZXJyb3IiLCJzb3VyY2UiLCJJbWFnZSIsInNyYyIsImNvbXBsZXRlZCIsInNldFRyaWdnZXJzIiwiY29uc29sZSIsIlJlc291cmNlcyIsImltYWdlQ2FjaGUiLCJNYXAiLCJpbWdTb3VyY2UiLCJhbGlhcyIsIm5ld0ltYWdlUmVzb3VyY2UiLCJsb2ciLCJoYXMiLCJ3aW5kb3ciLCJhbGVydCIsInNldCIsInNldFNvdXJjZSIsInNvdXJjZXMiLCJBcnJheSIsInByb21pc2VzIiwiYWd1bWVudHMiLCJwdXNoIiwiYWRkSW1hZ2UiLCJhcHBseSIsImFsbCIsImNhY2hlIiwiZ2V0Il0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLE9BQU8sRUFBYjs7Ozs7OztBQ0FBLElBQU1DLHNCQUFzQjtBQUN4QkMsZ0JBQVksWUFEWTtBQUV4QkMsWUFBUSxRQUZnQjtBQUd4QkMsYUFBUyxTQUhlO0FBSXhCQyxZQUFRO0FBSmdCLENBQTVCOztJQU9NQztBQUNGLDZCQUFjO0FBQUE7O0FBQ1YsYUFBS0MsUUFBTCxHQUFnQixDQUFoQjtBQUNBLGFBQUtDLE1BQUwsR0FBY1Asb0JBQW9CQyxVQUFsQztBQUNBLGFBQUtPLE1BQUwsR0FBYyxJQUFkO0FBQ0EsYUFBS0MsVUFBTCxHQUFrQixJQUFsQjtBQUNBLGFBQUtDLGVB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ZDtBQUNIOztBQUVELG1CQUFPMkIsS0FBUDtBQUNIIiwiZmlsZSI6ImZsYXQtZW5naW5lLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGZsYXQgPSB7fTtcclxuIiwiY29uc3QgSW1hZ2VSZXNvdXJjZVN0YXR1cyA9IHtcclxuICAgIElOSVRJQVRJTkc6ICdJbml0aWF0aW5nJyxcclxuICAgIEZBSUxFRDogJ0ZhaWxlZCcsXHJcbiAgICBMT0FESU5HOiAnTG9hZGluZycsXHJcbiAgICBMT0FERUQ6ICdMb2FkZWQnXHJcbn07XHJcblxyXG5jbGFzcyBJbWFnZVJlc291cmNlIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3MgPSAwO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gSW1hZ2VSZXNvdXJjZVN0YXR1cy5JTklUSUFUSU5HO1xyXG4gICAgICAgIHRoaXMub25Mb2FkID0gbnVsbDtcclxuICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsO1xyXG4gICAgICAgIHRoaXMub25TdGF0dXNDaGFuZ2VkID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0IElNQUdFX1NUQVRVUygpIHtcclxuICAgICAgICByZXR1cm4gSW1hZ2VSZXNvdXJjZVN0YXR1cztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbG9hZGVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN0YXR1cyA9PSBJbWFnZVJlc291cmNlU3RhdHVzLkxPQURFRDtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQcm9ncmVzcyhwcm9ncmVzcykge1xyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3MgPSBwcm9ncmVzcztcclxuXHJcbiAgICAgICAgaWYodGhpcy5vblByb2dyZXNzKSB7XHJcbiAgICAgICAgICAgIHRoaXMub25Qcm9ncmVzcyh0aGlzLnByb2dyZXNzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U3RhdHVzKHN0YXR1cykge1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xyXG5cclxuICAgICAgICBpZih0aGlzLm9uU3RhdHVzQ2hhbmdlZCkge1xyXG4gICAgICAgICAgICB0aGlzLm9uU3RhdHVzQ2hhbmdlZCh0aGlzLnN0YXR1cyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzd2l0Y2ggKHRoaXMuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgSW1hZ2VSZXNvdXJjZVN0YXR1cy5JTklUSUFUSU5HOlxyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgSW1hZ2VSZXNvdXJjZVN0YXR1cy5GQUlMRUQ6XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBJbWFnZVJlc291cmNlU3RhdHVzLkxPQURJTkc6XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBJbWFnZVJlc291cmNlU3RhdHVzLkxPQURFRDpcclxuICAgICAgICAgICAgdGhpcy5wcm9ncmVzcyA9IDE7XHJcbiAgICAgICAgICAgIGlmKHRoaXMub25Mb2FkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uTG9hZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VHJpZ2dlcnMoKSB7XHJcbiAgICAgICAgaWYodGhpcy5pbWcpIHtcclxuICAgICAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbWcub25sb2Fkc3RhcnQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoSW1hZ2VSZXNvdXJjZVN0YXR1cy5MT0FESU5HKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5vbnByb2dyZXNzID0gcHJvZ3Jlc3MgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSB0aGlzLnNldFByb2dyZXNzKHByb2dyZXNzKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoSW1hZ2VSZXNvdXJjZVN0YXR1cy5MT0FERUQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodGhpcyk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbWcub25lcnJvciA9IChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdHVzKEltYWdlUmVzb3VyY2VTdGF0dXMuRkFJTEVEKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFNvdXJjZShzb3VyY2UpIHtcclxuICAgICAgICBpZihzb3VyY2UpIHtcclxuICAgICAgICAgICAgaWYoc291cmNlIGluc3RhbmNlb2YgSW1hZ2UpIHtcclxuICAgICAgICAgICAgICAgIGlmKHNvdXJjZS5zcmMpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmltZyA9IHNvdXJjZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoc291cmNlLmNvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1cyhJbWFnZVJlc291cmNlU3RhdHVzLkxPQURFRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFRyaWdnZXJzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW1hZ2VSZXNvdXJjZSByZXF1aXJlcyBhIHByb3BlciBzb3VyY2UuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZih0eXBlb2Ygc291cmNlID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmltZyA9IG5ldyBJbWFnZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VHJpZ2dlcnMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5zcmMgPSBzb3VyY2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbWFnZVJlc291cmNlIHJlcXVpcmVzIGEgcHJvcGVyIHNvdXJjZS4nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIFJlc291cmNlcyB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmltYWdlQ2FjaGUgPSBuZXcgTWFwKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAqIEBtZXRob2QgYWRkSW1hZ2UgLSBBZGQgYW4gaW1hZ2UgcmVzb3VyY2UgYW5kIHN0YXJ0cyBsb2FkaW5nIGl0IGlmIHBvc3NpYmxlLlxyXG4gICAgKiBAcGFyYW0ge09iamVjdHxzdHJpbmd9IGltZ1NvdXJjZSAtIGltYWdlIHNvdXJjZS4gSXQgbWF5IGJlIGFuIGltZyBlbGVtZW50IG9iamVjdCBvciB0aGUgaW1nIHVybCBzdHJpbmcuXHJcbiAgICAqIEBwYXJhbSB7c3RyaW5nfSBbYWxpYXNdIC0gaW1hZ2UgYWxpYXMgdXNlZCB0byByZXRyaWV2ZSByZXNvdXJjZS4gaWYgaW1nU291cmNlIGlzIGEgc3RyaW5nIGFuZCBhbGlhcyBpcyBub3Qgc3BlY2lmaWVkLCB0aGVuIHRoZSBhbGlhcyB3aWxsIGJlIHNldCB0byB0aGUgaW1nU291cmNlLlxyXG4gICAgKiBAcmV0dXJuIHtQcm9taXNzZX0gLSBwcm9taXNlIHRoYXQgZnVsbGZpbGxzIHdoZW4gdGhlIHJlc291cmNlIGhhcyBsb2FkZWQuXHJcbiAgICAqL1xyXG4gICAgYWRkSW1hZ2UoaW1nU291cmNlLCBhbGlhcykge1xyXG4gICAgICAgIGlmKCAodHlwZW9mIGltZ1NvdXJjZSA9PSAnc3RyaW5nJykgJiYgIWFsaWFzICkge1xyXG4gICAgICAgICAgICBhbGlhcyA9IGltZ1NvdXJjZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld0ltYWdlUmVzb3VyY2UgPSBuZXcgSW1hZ2VSZXNvdXJjZSgpO1xyXG5cclxuICAgICAgICBpZighYWxpYXMpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1Jlc291cmNlcy5hZGRJbWFnZTogYWxpYXMgbm90IHNldCBhbmQgdGh1cyB0aGlzIGltYWdlIHdpbGwgbm90IGJlIGNhY2hlZCEnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuaW1hZ2VDYWNoZS5oYXMoYWxpYXMpKSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoYFJlc291cmNlcy5hZGRJbWFnZTogaW1hZ2UgYWxpYXMgXCIke2FsaWFzfVwiIGlzIGFscmVhZHkgYmVpbmcgdXNlZCBhbmQgd2lsbCBiZSBvdmVyd3JpdHRlbi5gKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5pbWFnZUNhY2hlLnNldChhbGlhcywgbmV3SW1hZ2VSZXNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbmV3SW1hZ2VSZXNvdXJjZS5zZXRTb3VyY2UoaW1nU291cmNlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICogQG1ldGhvZCBhZGRJbWFnZXMgLSBTYW1lIGFzIGFkZEltYWdlIGJ1dCBmb3IgbXVsdHBsZSBpbWFnZSByZXNvdXJjZXMuXHJcbiAgICAqIEBwYXJhbSB7QXJyYXl9IHNvdXJjZXMgLSBlYWNoIGVsZW1lbnQgc2hvdWxkIGJlIGFuIGFycmF5IHRoYXQgbWF0Y2hlcyB0aGUgYXJndW1lbnRzIG9mIHRoZSBhZGRJbWFnZSBtZXRob2Q6IFtpbWdTb3VyY2UsIGFsaWFzXS5cclxuICAgICogQHJldHVybiB7UHJvbWlzc2V9IC0gcHJvbWlzZSB0aGF0IGZ1bGxmaWxscyB3aGVuIGFsbCByZXNvdXJjZXMgaGF2ZSBsb2FkZWQuXHJcbiAgICAqL1xyXG4gICAgYWRkSW1hZ2VzKHNvdXJjZXMpIHtcclxuICAgICAgICBpZighKHNvdXJjZXMgaW5zdGFuY2VvZiBBcnJheSkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVzb3VyY2VzLmFkZEltYWdlczogYXJndW1lbnQgaXMgbm90IGFuIGFycmF5Jyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwcm9taXNlcyA9IFtdO1xyXG5cclxuICAgICAgICBmb3IoY29uc3QgYWd1bWVudHMgb2Ygc291cmNlcykge1xyXG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMuYWRkSW1hZ2UuYXBwbHkodGhpcywgYWd1bWVudHMpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAqIEBtZXRob2QgZ2V0SW1hZ2UgLSByZXR1cm5zIHRoZSBpbWcgZWxlbWVudCBvYmplY3QgcmVzcGVjdGl2ZSB0byB0aGUgZ2l2ZW4gYWxpYXMuXHJcbiAgICAqL1xyXG4gICAgZ2V0SW1hZ2UoYWxpYXMpIHtcclxuICAgICAgICBjb25zdCBjYWNoZSA9IHRoaXMuaW1hZ2VDYWNoZS5nZXQoYWxpYXMpO1xyXG5cclxuICAgICAgICBpZighY2FjaGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVzb3VyY2VzLmdldEltYWdlOiBjb3VsZCBub3QgZmluZCBhbGlhcyBcIiR7YWxpYXN9XCInKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjYWNoZTtcclxuICAgIH1cclxufVxyXG4iXX0=
