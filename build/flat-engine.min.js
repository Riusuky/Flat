'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
* @class
*/
var Engine = function () {
    /**
    * @constructor
    */
    function Engine() {
        _classCallCheck(this, Engine);

        if (Engine.instance instanceof Engine) {
            console.error('Engine.constructor: Engine instance already exists.');
            return null;
        }

        Engine.instance = this;

        this.lastTime = Date.now();
        this.callbackSet = new Set();
        this.keyCallbackSet = new Set();
        this.mouseCallbackSet = new Set();

        document.addEventListener('keyup', this.handleKeyEvents.bind(this));
        document.addEventListener('keydown', this.handleKeyEvents.bind(this));
        document.addEventListener('keypress', this.handleKeyEvents.bind(this));

        if (!Render) {
            console.error('Engine.constructor: Render class is not defined.');
        } else if (!(Render.instance instanceof Render)) {
            console.error('Engine.constructor: There is no render instance to subscribre mouse events.');
        } else {
            this.render = Render.instance;

            this.render.canvas.addEventListener('mouseover', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('mousemove', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('mouseleave', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('mouseout', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('click', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('auxclick', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('mousedown', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('mouseup', this.handleMouseEvents.bind(this));
        }
    }

    _createClass(Engine, [{
        key: 'handleKeyEvents',
        value: function handleKeyEvents(event) {
            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = this.keyCallbackSet[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var callback = _step.value;

                    callback(event);
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }
        }
    }, {
        key: 'handleMouseEvents',
        value: function handleMouseEvents(event) {
            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
                for (var _iterator2 = this.mouseCallbackSet[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                    var callback = _step2.value;

                    callback(event);
                }
            } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                        _iterator2.return();
                    }
                } finally {
                    if (_didIteratorError2) {
                        throw _iteratorError2;
                    }
                }
            }
        }
    }, {
        key: 'start',
        value: function start() {
            requestAnimationFrame(this.routine.bind(this));
        }
    }, {
        key: 'routine',
        value: function routine() {
            var deltaTime = this.currentTime - this.lastTime;

            var _iteratorNormalCompletion3 = true;
            var _didIteratorError3 = false;
            var _iteratorError3 = undefined;

            try {
                for (var _iterator3 = this.callbackSet[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                    var callback = _step3.value;

                    callback(deltaTime);
                }
            } catch (err) {
                _didIteratorError3 = true;
                _iteratorError3 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion3 && _iterator3.return) {
                        _iterator3.return();
                    }
                } finally {
                    if (_didIteratorError3) {
                        throw _iteratorError3;
                    }
                }
            }

            this.render.render();

            requestAnimationFrame(this.routine.bind(this));
        }

        /**
        * @callback routineCallback
        * @param {number} deltaTime - time since the callback was last called.
        */

        /**
        * @method registerRoutineCallback - add a callback to be invoked by the engine.
        * @param {routineCallback} callback
        */

    }, {
        key: 'registerRoutineCallback',
        value: function registerRoutineCallback(callback) {
            if (typeof callback == 'function') {
                this.callbackSet.add(callback);
            } else {
                console.error('Engine.registerRoutineCallback: callback is not set as a function.');
            }
        }
    }, {
        key: 'registerKeyEventCallback',
        value: function registerKeyEventCallback(callback) {
            if (typeof callback == 'function') {
                this.keyCallbackSet.add(callback);
            } else {
                console.error('Engine.registerKeyEventCallback: callback is not set as a function.');
            }
        }
    }, {
        key: 'registerMouseEventCallback',
        value: function registerMouseEventCallback(callback) {
            if (typeof callback == 'function') {
                this.mouseCallbackSet.add(callback);
            } else {
                console.error('Engine.registerMouseEventCallback: callback is not set as a function.');
            }
        }
    }, {
        key: 'currentTime',
        get: function get() {
            return Date.now();
        }
    }]);

    return Engine;
}();
"use strict";

var flat = {};
'use strict';

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
* @class
*/
var ImageObject = function () {
    /**
    * @constructor
    */
    function ImageObject(sprite) {
        var subscribeToRender = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

        _classCallCheck(this, ImageObject);

        if (sprite) {
            this.setSprite(sprite);
        }

        this.pivotX = 0.5;
        this.pivotY = 0.5;

        this.x = 0;
        this.y = 0;

        this.originalsizeX = this.originalsizeX || 0;
        this.originalsizeY = this.originalsizeY || 0;

        this.scaleX = 1;
        this.scaleY = 1;

        this.layer = 0;

        this.visible = true;

        if (!Render) {
            console.error('ImageObject.constructor: Render class is not defined.');
        } else if (!(Render.instance instanceof Render)) {
            console.error('ImageObject.constructor: There is no render instance to subscribre to.');
        } else {
            this.render = Render.instance;
            if (subscribeToRender) {
                this.subscribeToRender();
            }
        }
    }

    _createClass(ImageObject, [{
        key: 'mayRender',
        value: function mayRender() {
            return this.sprite instanceof Image && this.visible;
        }
    }, {
        key: 'setSprite',
        value: function setSprite(sprite) {
            var adjustSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

            if (sprite instanceof Image) {
                this.sprite = sprite;

                if (adjustSize) {
                    this.originalsizeX = sprite.naturalWidth;
                    this.originalsizeY = sprite.naturalHeight;
                }
            } else if (sprite) {
                console.error('GameObject.constructor: sprite is not set as a Image object.');
            } else {
                this.sprite = null;
            }
        }
    }, {
        key: 'subscribeToRender',
        value: function subscribeToRender() {
            this.render.registerObject(this);
        }
    }, {
        key: 'unsubscribeToRender',
        value: function unsubscribeToRender() {
            this.render.unregisterObject(this);
        }
    }, {
        key: 'createCopy',
        value: function createCopy() {
            var newCopy = new ImageObject(this.sprite, false);

            this.copyPropertiesTo(newCopy);

            return newCopy;
        }
    }, {
        key: 'copyPropertiesTo',
        value: function copyPropertiesTo(targetImageObject) {
            if (targetImageObject instanceof ImageObject) {
                targetImageObject.sprite = this.sprite;

                targetImageObject.pivot = [this.pivotX, this.pivotY];
                targetImageObject.position = [this.x, this.y];

                targetImageObject.originalsize = [this.originalsizeX, this.originalsizeY];

                targetImageObject.scale = [this.scaleX, this.scaleY];

                targetImageObject.layer = this.layer;
            } else {
                console.error('ImageObject.copyPropertiesTo: targetImageObject is not a ImageObject instance.');
            }
        }
    }, {
        key: 'pivot',
        get: function get() {
            return [this.pivotX, this.pivotY];
        },
        set: function set(pivot) {
            if (pivot instanceof Array && pivot.length == 2 && typeof pivot[0] == 'number' && typeof pivot[1] == 'number') {
                this.pivotX = pivot[0];
                this.pivotY = pivot[1];
            } else {
                console.error('set ImageObject.pivot: pivot is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'position',
        get: function get() {
            return [this.x, this.y];
        },
        set: function set(position) {
            if (position instanceof Array && position.length == 2 && typeof position[0] == 'number' && typeof position[1] == 'number') {
                this.x = position[0];
                this.y = position[1];
            } else {
                console.error('set ImageObject.position: position is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'sizeX',
        get: function get() {
            return this.originalsizeX * this.scaleX;
        }
    }, {
        key: 'sizeY',
        get: function get() {
            return this.originalsizeY * this.scaleY;
        }
    }, {
        key: 'size',
        get: function get() {
            return [this.originalsizeX * this.scaleX, this.originalsizeY * this.scaleY];
        }
    }, {
        key: 'originalsize',
        get: function get() {
            return [this.originalsizeX, this.originalsizeY];
        },
        set: function set(originalsize) {
            if (originalsize instanceof Array && originalsize.length == 2 && typeof originalsize[0] == 'number' && typeof originalsize[1] == 'number') {
                this.originalsizeX = originalsize[0];
                this.originalsizeY = originalsize[1];
            } else {
                console.error('set ImageObject.originalsize: originalsize is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'scale',
        get: function get() {
            return [this.scaleX, this.scaleY];
        },
        set: function set(scale) {
            if (scale instanceof Array && scale.length == 2 && typeof scale[0] == 'number' && typeof scale[1] == 'number') {
                this.scaleX = scale[0];
                this.scaleY = scale[1];
            } else if (typeof scale == 'number') {
                this.scaleX = scale;
                this.scaleY = scale;
            } else {
                console.error('set ImageObject.scale: scale is not an array of size 2 that contains numbers or simply a number.');
            }
        }
    }]);

    return ImageObject;
}();

/**
* @class
*/


var GameObject = function (_ImageObject) {
    _inherits(GameObject, _ImageObject);

    /**
    * @constructor
    */
    function GameObject(sprite) {
        var subscribeToRender = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

        _classCallCheck(this, GameObject);

        var _this = _possibleConstructorReturn(this, (GameObject.__proto__ || Object.getPrototypeOf(GameObject)).call(this, sprite, subscribeToRender));

        _this.vx = 0;
        _this.vy = 0;

        _this.originalBorderWidth = _this.originalsizeX || 64;
        _this.originalBorderHeight = _this.originalsizeY || 64;
        // // Box colider
        // this.boxColliderSize = [0, 0];
        // this.boxColliderPositionOffset = [0, 0];
        //
        // this.active = true;
        return _this;
    }

    _createClass(GameObject, [{
        key: 'update',
        value: function update(deltaTime) {
            if (this.active) {
                this.x += this.vx * deltaTime;
                this.y += this.vy * deltaTime;
            }
        }
    }, {
        key: 'hasCollided',
        value: function hasCollided(otherBorder) {
            var myBorder = this.border;

            return Math.min(myBorder.right, otherBorder.right) - Math.max(myBorder.left, otherBorder.left) >= 0 && Math.min(myBorder.bottom, otherBorder.bottom) - Math.max(myBorder.top, otherBorder.top) >= 0;
        }
    }, {
        key: 'createCopy',
        value: function createCopy() {
            var newCopy = new GameObject(this.sprite, false);

            this.copyPropertiesTo(newCopy);

            return newCopy;
        }
    }, {
        key: 'copyPropertiesTo',
        value: function copyPropertiesTo(targetGameObject) {
            if (targetGameObject instanceof GameObject) {
                _get(GameObject.prototype.__proto__ || Object.getPrototypeOf(GameObject.prototype), 'copyPropertiesTo', this).call(this, targetGameObject);

                targetGameObject.vx = this.vx;
                targetGameObject.vy = this.vy;

                targetGameObject.originalBorderWidth = this.originalBorderWidth;
                targetGameObject.originalBorderHeight = this.originalBorderHeight;
            } else {
                console.error('GameObject.copyPropertiesTo: targetGameObject is not a GameObject instance.');
            }
        }
    }, {
        key: 'borderWidth',
        get: function get() {
            return this.originalBorderWidth * this.scaleX;
        }
    }, {
        key: 'borderHeight',
        get: function get() {
            return this.originalBorderHeight * this.scaleY;
        }
    }, {
        key: 'originalBorder',
        get: function get() {
            return [this.originalBorderWidth, this.originalBorderHeight];
        },
        set: function set(originalBorder) {
            if (originalBorder instanceof Array && originalBorder.length == 2 && typeof originalBorder[0] == 'number' && typeof originalBorder[1] == 'number') {
                this.originalBorderWidth = originalBorder[0];
                this.originalBorderHeight = originalBorder[1];
            } else {
                console.error('set ImageObject.originalBorder: originalBorder is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'border',
        get: function get() {
            var borderRadius = [+0.5 * this.originalBorderWidth * this.scaleX, 0.5 * this.originalBorderHeight * this.scaleY];

            return {
                top: this.y + borderRadius[1],
                right: this.x + borderRadius[0],
                bottom: this.y - borderRadius[1],
                left: this.x - borderRadius[0]
            };
        }
    }]);

    return GameObject;
}(ImageObject);
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Render = function () {
    function Render(canvas) {
        _classCallCheck(this, Render);

        if (Render.instance instanceof Render) {
            console.error('Render.constructor: Render instance already exists.');
            return null;
        }

        if (!(canvas instanceof HTMLCanvasElement)) {
            console.error("Render.constructor: given canvas object is not an HTMLCanvasElement.");
            return null;
        }

        Render.instance = this;

        this.canvas = canvas;
        this.context2D = this.canvas.getContext('2d');

        this.updateCanvasSize();

        window.addEventListener('resize', this.updateCanvasSize);

        // Coordinate sytem. Axis orientation will be: X->right , Y->up
        this.originX = 0.5;
        this.originY = 0.5;

        this.coordOffsetX = 0;
        this.coordOffsetY = 0;

        this.objectSet = new Set();

        this.drawTileGrid = false;
        this.drawBorders = false;
        this.drawTileHighlight = false;
    }

    _createClass(Render, [{
        key: 'canvasPositionToRenderCoordinates',
        value: function canvasPositionToRenderCoordinates(position) {
            if (position instanceof Array && position.length == 2 && typeof position[0] == 'number' && typeof position[1] == 'number') {
                var realOrigin = this.realOrigin;

                return [position[0] - realOrigin[0], realOrigin[1] - position[1]];
            } else {
                console.error('set Render.canvasPositionToRenderCoordinates: position is not an array of size 2 that contains numbers.');
                return null;
            }
        }
    }, {
        key: 'mousePositionToCanvasRelativePosition',
        value: function mousePositionToCanvasRelativePosition(mousePosition) {
            var canvasRect = this.canvas.getBoundingClientRect();

            return [mousePosition[0] - canvasRect.left, mousePosition[1] - canvasRect.top];
        }
    }, {
        key: 'mousePositionToRenderCoordinates',
        value: function mousePositionToRenderCoordinates(mousePosition) {
            return this.canvasPositionToRenderCoordinates(this.mousePositionToCanvasRelativePosition(mousePosition));
        }
    }, {
        key: 'mousePositionToTileCoordinates',
        value: function mousePositionToTileCoordinates(mousePosition) {
            if (!Terrain) {
                console.error('Render.mousePositionToTileCoordinates: Terrain class is not defined.');
            } else if (!(this.terrain instanceof Terrain)) {
                console.error('Render.mousePositionToTileCoordinates: terrain is not set.');
            } else {
                var realOrigin = this.realOrigin;
                var relativeCanvasPosition = this.mousePositionToCanvasRelativePosition(mousePosition);

                var coordinates = [0.5 + (relativeCanvasPosition[0] - realOrigin[0]) / this.terrain.tileSizeX, -0.5 + (realOrigin[1] - relativeCanvasPosition[1]) / this.terrain.tileSizeY];

                return [Math.floor(coordinates[0]), Math.ceil(coordinates[1])];
            }
        }
    }, {
        key: 'updateCanvasSize',
        value: function updateCanvasSize() {
            var containerStyle = window.getComputedStyle(this.canvas.parentElement);

            this.canvas.width = parseFloat(containerStyle.width) - parseFloat(containerStyle.paddingLeft) - parseFloat(containerStyle.paddingRight) - parseFloat(containerStyle.borderLeftWidth) - parseFloat(containerStyle.borderRightWidth);
            this.canvas.height = parseFloat(containerStyle.height) - parseFloat(containerStyle.paddingTop) - parseFloat(containerStyle.paddingBottom) - parseFloat(containerStyle.borderTopWidth) - parseFloat(containerStyle.borderBottomWidth);
        }
    }, {
        key: 'registerObject',
        value: function registerObject(imageObject) {
            if (!ImageObject) {
                console.error('Render.registerObject: ImageObject class is not defined.');
            } else if (!(imageObject instanceof ImageObject)) {
                console.error('Render.registerObject: imageObject is not a ImageObject object.');
            } else {
                this.objectSet.add(imageObject);
            }
        }
    }, {
        key: 'unregisterObject',
        value: function unregisterObject(imageObject) {
            if (!ImageObject) {
                console.error('Render.registerObject: ImageObject class is not defined.');
            } else if (!(imageObject instanceof ImageObject)) {
                console.error('Render.registerObject: imageObject is not a ImageObject object.');
            } else {
                this.objectSet.delete(imageObject);
            }
        }
    }, {
        key: 'setTerrain',
        value: function setTerrain(terrain) {
            if (!Terrain) {
                console.error('Render.setTerrain: Terrain class is not defined.');
            } else if (!(terrain instanceof Terrain)) {
                console.error('Render.setTerrain: terrain is not a Terrain object.');
            } else {
                this.terrain = terrain;
            }
        }
    }, {
        key: 'render',
        value: function render() {
            this.context2D.clearRect(0, 0, this.canvas.width, this.canvas.height);

            this.renderTerrain();

            if (this.drawTileGrid) {
                this.renderTileGrid();
            }

            this.renderObjects();
        }
    }, {
        key: 'renderTerrain',
        value: function renderTerrain() {
            var realOrigin = this.realOrigin;

            this.context2D.fillStyle = 'rgba(255, 255, 255, 0.4)';

            if (this.terrain) {
                var _iteratorNormalCompletion = true;
                var _didIteratorError = false;
                var _iteratorError = undefined;

                try {
                    for (var _iterator = this.terrain.tiles[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                        var tile = _step.value;

                        var tilePosition = [(realOrigin[0] + (tile.row - 0.5) * this.terrain.tileSizeX).toFixed(), (realOrigin[1] - (tile.column + 0.5) * this.terrain.tileSizeY).toFixed()];

                        if (tile.sprite) {
                            this.context2D.drawImage(tile.sprite, tilePosition[0], tilePosition[1], this.terrain.tileSizeX.toFixed(), this.terrain.tileSizeY.toFixed());
                        }

                        if (this.drawTileHighlight && tile.highlighted) {
                            this.context2D.fillRect(tilePosition[0], tilePosition[1], this.terrain.tileSizeX.toFixed(), this.terrain.tileSizeY.toFixed());
                        }
                    }
                } catch (err) {
                    _didIteratorError = true;
                    _iteratorError = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion && _iterator.return) {
                            _iterator.return();
                        }
                    } finally {
                        if (_didIteratorError) {
                            throw _iteratorError;
                        }
                    }
                }
            }
        }
    }, {
        key: 'renderObjects',
        value: function renderObjects() {
            var realOrigin = this.realOrigin;

            var objectSize = void 0,
                objectBorder = void 0;

            this.context2D.strokeStyle = 'purple';
            this.context2D.lineWidth = 2;

            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
                for (var _iterator2 = _.sortBy([].concat(_toConsumableArray(this.objectSet)), 'layer')[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                    var objectToRender = _step2.value;

                    if (objectToRender.mayRender()) {
                        objectSize = objectToRender.size;
                        this.context2D.drawImage(objectToRender.sprite, (realOrigin[0] + objectToRender.x - objectToRender.pivotX * objectSize[0]).toFixed(), (realOrigin[1] - (objectToRender.y + (1 - objectToRender.pivotY) * objectSize[1])).toFixed(), objectSize[0].toFixed(), objectSize[1].toFixed());

                        if (this.drawBorders) {
                            if (!GameObject) {
                                console.error('Render.renderObjects: GameObject class not defined.');
                            } else if (objectToRender instanceof GameObject) {
                                objectBorder = objectToRender.border;
                                this.context2D.strokeRect(realOrigin[0] + objectBorder.left, realOrigin[1] - objectBorder.top, objectToRender.borderWidth, objectToRender.borderHeight);
                            }
                        }
                    }
                }
            } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                        _iterator2.return();
                    }
                } finally {
                    if (_didIteratorError2) {
                        throw _iteratorError2;
                    }
                }
            }
        }
    }, {
        key: 'renderTileGrid',
        value: function renderTileGrid() {
            if (this.terrain) {
                this.context2D.strokeStyle = 'white';
                this.context2D.lineWidth = 1;

                var realOrigin = this.realOrigin;

                var minX = Math.ceil(0.5 - realOrigin[0] / this.terrain.tileSizeX);
                var maxX = Math.floor(0.5 + (this.canvas.width - realOrigin[0]) / this.terrain.tileSizeX);

                var minY = Math.ceil(-0.5 + (realOrigin[1] - this.canvas.height) / this.terrain.tileSizeY);
                var maxY = Math.floor(-0.5 + realOrigin[1] / this.terrain.tileSizeY);

                this.context2D.beginPath();

                var loackedPosition = 0;

                for (var i = minX; i <= maxX; i++) {
                    loackedPosition = (realOrigin[0] + (i - 0.5) * this.terrain.tileSizeX).toFixed();
                    this.context2D.moveTo(loackedPosition, 0);
                    this.context2D.lineTo(loackedPosition, this.canvas.height);
                }

                for (var j = minY; j <= maxY; j++) {
                    loackedPosition = (realOrigin[1] - (j + 0.5) * this.terrain.tileSizeY).toFixed();
                    this.context2D.moveTo(0, loackedPosition);
                    this.context2D.lineTo(this.canvas.width, loackedPosition);
                }

                this.context2D.stroke();
            }
        }
    }, {
        key: 'origin',
        get: function get() {
            return [this.originX, this.originY];
        },
        set: function set(origin) {
            if (origin instanceof Array && origin.length == 2 && typeof origin[0] == 'number' && typeof origin[1] == 'number') {
                this.originX = origin[0];
                this.originY = origin[1];
            } else {
                console.error('set Render.origin: origin is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'coordOffset',
        get: function get() {
            return [this.coordOffsetX, this.coordOffsetY];
        },
        set: function set(coordOffset) {
            if (coordOffset instanceof Array && coordOffset.length == 2 && typeof coordOffset[0] == 'number' && typeof coordOffset[1] == 'number') {
                this.coordOffsetX = coordOffset[0].toFixed();
                this.coordOffsetY = coordOffset[1].toFixed();
            } else {
                console.error('set Render.coordOffset: coordOffset is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'realOrigin',
        get: function get() {
            return [this.originX * this.canvas.width + this.coordOffsetX, (1 - this.originY) * this.canvas.height - this.coordOffsetY];
        }
    }]);

    return Render;
}();
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var ImageResourceStatus = {
    INITIATING: 'Initiating',
    FAILED: 'Failed',
    LOADING: 'Loading',
    LOADED: 'Loaded'
};

var ImageResource = function () {
    function ImageResource() {
        _classCallCheck(this, ImageResource);

        this.progress = 0;
        this.status = ImageResourceStatus.INITIATING;
        this.onLoad = null;
        this.onProgress = null;
        this.onStatusChanged = null;
    }

    _createClass(ImageResource, [{
        key: 'setProgress',
        value: function setProgress(progress) {
            this.progress = progress;

            console.log('ImageResource.setProgress: ' + progress);

            if (this.onProgress) {
                this.onProgress(this.progress);
            }
        }
    }, {
        key: 'setStatus',
        value: function setStatus(status) {
            this.status = status;

            if (this.onStatusChanged) {
                this.onStatusChanged(this.status);
            }

            switch (this.status) {
                case ImageResourceStatus.INITIATING:
                    break;

                case ImageResourceStatus.FAILED:
                    break;

                case ImageResourceStatus.LOADING:
                    break;

                case ImageResourceStatus.LOADED:
                    this.setProgress(1);
                    if (this.onLoad) {
                        this.onLoad();
                    }
                    break;

                default:
            }
        }
    }, {
        key: 'setTriggers',
        value: function setTriggers() {
            var _this = this;

            if (this.img) {
                this.promise = new Promise(function (resolve, reject) {
                    _this.img.onloadstart = function () {
                        _this.setStatus(ImageResourceStatus.LOADING);
                    };
                    _this.img.onprogress = function (progress) {
                        _this.progress = _this.setProgress(progress);
                    };
                    _this.img.onload = function () {
                        _this.setStatus(ImageResourceStatus.LOADED);
                        resolve(_this);
                    };
                    _this.img.onerror = function (error) {
                        _this.setStatus(ImageResourceStatus.FAILED);
                        reject(error);
                    };
                });
            }
        }
    }, {
        key: 'setSource',
        value: function setSource(source, alias) {
            var _this2 = this;

            if (source) {
                if (source instanceof Image) {
                    if (source.src) {
                        if (alias) {
                            this.alias = alias;
                        }

                        this.imageSrc = source.src;
                        this.img = source;

                        if (source.complete) {
                            this.setStatus(ImageResourceStatus.LOADED);

                            return new Promise(function (resolve, reject) {
                                resolve(_this2);
                            });
                        } else {
                            this.setTriggers();
                        }
                    } else {
                        console.error('ImageResource requires a proper source.');
                    }
                } else if (typeof source == 'string') {
                    if (alias) {
                        this.alias = alias;
                    }

                    this.imageSrc = source;
                    this.img = new Image();

                    this.setTriggers();

                    this.img.src = source;
                }

                return this.promise;
            } else {
                console.error('ImageResource requires a proper source.');
            }
        }
    }, {
        key: 'loaded',
        get: function get() {
            return this.status == ImageResourceStatus.LOADED;
        }
    }], [{
        key: 'IMAGE_STATUS',
        get: function get() {
            return ImageResourceStatus;
        }
    }]);

    return ImageResource;
}();

var Resources = function () {
    function Resources() {
        _classCallCheck(this, Resources);

        this.imageCache = new Map();
    }

    /**
    * @method addImage - Add an image resource and starts loading it if possible.
    * @param {Object|string} imgSource - image source. It may be an img element object or the img url string.
    * @param {string} [alias] - image alias used to retrieve resource. if imgSource is a string and alias is not specified, then the alias will be set to the imgSource.
    * @return {Promisse} - promise that fullfills when the resource has loaded.
    */


    _createClass(Resources, [{
        key: 'addImage',
        value: function addImage(imgSource, alias) {
            if (typeof imgSource == 'string' && !alias) {
                alias = imgSource;
            }

            var newImageResource = new ImageResource();

            if (!alias) {
                console.log('Resources.addImage: alias not set and thus this image will not be cached!');
            } else {
                if (this.imageCache.has(alias)) {
                    window.alert('Resources.addImage: image alias "' + alias + '" is already being used and will be overwritten.');
                }

                this.imageCache.set(alias, newImageResource);
            }

            return newImageResource.setSource(imgSource, alias);
        }

        /**
        * @method addImages - Same as addImage but for multple image resources.
        * @param {Array} sources - each element should be an array that matches the arguments of the addImage method: [imgSource, alias].
        * @return {Promisse} - promise that fullfills when all resources have loaded.
        */

    }, {
        key: 'addImages',
        value: function addImages(sources) {
            if (!(sources instanceof Array)) {
                console.error('Resources.addImages: argument is not an array');

                return;
            }

            var promises = [];

            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = sources[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var entry = _step.value;

                    if (entry instanceof Array) {
                        promises.push(this.addImage.apply(this, entry));
                    } else {
                        promises.push(this.addImage(entry));
                    }
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }

            return Promise.all(promises);
        }
    }, {
        key: 'getOrAddImage',
        value: function getOrAddImage(imgSource, alias) {
            if (typeof imgSource == 'string' && !alias) {
                alias = imgSource;
            }

            var newImageResource = new ImageResource();

            if (!alias) {
                console.log('Resources.addImage: alias not set and thus this image will not be cached!');
            } else {
                var cache = this.imageCache.get(alias);

                if (cache) {
                    return new Promise(function (resolve, reject) {
                        resolve(cache);
                    });
                }
            }

            this.imageCache.set(alias, newImageResource);

            return newImageResource.setSource(imgSource, alias);
        }
    }, {
        key: 'getOrAddImages',
        value: function getOrAddImages(sources) {
            if (!(sources instanceof Array)) {
                console.error('Resources.addImages: argument is not an array');

                return;
            }

            var promises = [];

            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
                for (var _iterator2 = sources[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                    var entry = _step2.value;

                    if (entry instanceof Array) {
                        promises.push(this.getOrAddImage.apply(this, entry));
                    } else {
                        promises.push(this.getOrAddImage(entry));
                    }
                }
            } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                        _iterator2.return();
                    }
                } finally {
                    if (_didIteratorError2) {
                        throw _iteratorError2;
                    }
                }
            }

            return Promise.all(promises);
        }

        /**
        * @method getImage - returns the img element object respective to the given alias.
        */

    }, {
        key: 'getImage',
        value: function getImage(alias) {
            var cache = this.imageCache.get(alias);

            if (!cache) {
                console.error('Resources.getImage: could not find alias "${alias}"');
            }

            return cache;
        }
    }]);

    return Resources;
}();
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Tile = function Tile(row, column, sprite) {
    _classCallCheck(this, Tile);

    if (sprite instanceof Image) {
        this.sprite = sprite;
    } else if (sprite) {
        console.error('Tile.constructor: sprite is not a Image object.');
        return null;
    }

    row = Number(row.toFixed());
    column = Number(column.toFixed());

    if (typeof row == 'number' && typeof column == 'number') {
        this.row = row;
        this.column = column;
    } else {
        console.error('Tile.constructor: row and column must be numbers.');
        return null;
    }

    this.highlighted = false;
};

var Terrain = function () {
    function Terrain() {
        _classCallCheck(this, Terrain);

        this.tileSizeX = 64;
        this.tileSizeY = 64;

        this.tileMap = new Map();
        this.tileHighlightMap = new Map();
    }

    _createClass(Terrain, [{
        key: 'setTile',
        value: function setTile(tile) {
            if (!(tile instanceof Tile)) {
                console.error('Terrain.setTile: tile is not a Tile object.');
            } else {
                this.tileMap.set(tile.row + 'x' + tile.column, tile);
            }
        }
    }, {
        key: 'setTiles',
        value: function setTiles(tiles) {
            if (!(tiles instanceof Array)) {
                console.error('Terrain.setTiles: tiles is not an Array.');
            } else {
                var _iteratorNormalCompletion = true;
                var _didIteratorError = false;
                var _iteratorError = undefined;

                try {
                    for (var _iterator = tiles[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                        var tile = _step.value;

                        this.setTile(tile);
                    }
                } catch (err) {
                    _didIteratorError = true;
                    _iteratorError = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion && _iterator.return) {
                            _iterator.return();
                        }
                    } finally {
                        if (_didIteratorError) {
                            throw _iteratorError;
                        }
                    }
                }
            }
        }
    }, {
        key: 'setTileHighlight',
        value: function setTileHighlight(row, column) {
            var highlighted = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

            if (typeof row == 'number' && typeof column == 'number' && typeof highlighted == 'boolean') {
                var tile = this.tileMap.get(row + 'x' + column);
                if (!tile) {
                    tile = new Tile(row, column);
                    this.setTile(tile);
                }

                tile.highlighted = highlighted;

                return tile;
            } else {
                console.error('Terrain.setTileHighlight: row and column must be numbers and highlighted must be a boolean.');
            }

            return null;
        }
    }, {
        key: 'clear',
        value: function clear() {
            this.tileMap.clear();
            this.tileHighlightMap = new Map();
        }
    }, {
        key: 'tiles',
        get: function get() {
            return [].concat(_toConsumableArray(this.tileMap.values()));
        }
    }, {
        key: 'tileSize',
        get: function get() {
            return [this.tileSizeX, this.tileSizeY];
        },
        set: function set(tileSize) {
            if (tileSize instanceof Array && tileSize.length == 2 && typeof tileSize[0] == 'number' && typeof tileSize[1] == 'number') {
                this.tileSizeX = tileSize[0];
                this.tileSizeY = tileSize[1];
            } else {
                console.error('set Terrain.tileSize: tileSize is not an array of size 2 that contains numbers.');
            }
        }
    }]);

    return Terrain;
}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS5qcyIsImZsYXQuanMiLCJnYW1lLW9iamVjdC5qcyIsInJlbmRlci5qcyIsInJlc291cmNlcy5qcyIsInRlcnJhaW4uanMiXSwibmFtZXMiOlsiRW5naW5lIiwiaW5zdGFuY2UiLCJjb25zb2xlIiwiZXJyb3IiLCJsYXN0VGltZSIsIkRhdGUiLCJub3ciLCJjYWxsYmFja1NldCIsIlNldCIsImtleUNhbGxiYWNrU2V0IiwibW91c2VDYWxsYmFja1NldCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZUtleUV2ZW50cyIsImJpbmQiLCJSZW5kZXIiLCJyZW5kZXIiLCJjYW52YXMiLCJoYW5kbGVNb3VzZUV2ZW50cyIsImV2ZW50IiwiY2FsbGJhY2siLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJyb3V0aW5lIiwiZGVsdGFUaW1lIiwiY3VycmVudFRpbWUiLCJhZGQiLCJmbGF0IiwiSW1hZ2VPYmplY3QiLCJzcHJpdGUiLCJzdWJzY3JpYmVUb1JlbmRlciIsInNldFNwcml0ZSIsInBpdm90WCIsInBpdm90WSIsIngiLCJ5Iiwib3JpZ2luYWxzaXplWCIsIm9yaWdpbmFsc2l6ZVkiLCJzY2FsZVgiLCJzY2FsZVkiLCJsYXllciIsInZpc2libGUiLCJJbWFnZSIsImFkanVzdFNpemUiLCJuYXR1cmFsV2lkdGgiLCJuYXR1cmFsSGVpZ2h0IiwicmVnaXN0ZXJPYmplY3QiLCJ1bnJlZ2lzdGVyT2JqZWN0IiwibmV3Q29weSIsImNvcHlQcm9wZXJ0aWVzVG8iLCJ0YXJnZXRJbWFnZU9iamVjdCIsInBpdm90IiwicG9zaXRpb24iLCJvcmlnaW5hbHNpemUiLCJzY2FsZSIsIkFycmF5IiwibGVuZ3RoIiwiR2FtZU9iamVjdCIsInZ4IiwidnkiLCJvcmlnaW5hbEJvcmRlcldpZHRoIiwib3JpZ2luYWxCb3JkZXJIZWlnaHQiLCJhY3RpdmUiLCJvdGhlckJvcmRlciIsIm15Qm9yZGVyIiwiYm9yZGVyIiwiTWF0aCIsIm1pbiIsInJpZ2h0IiwibWF4IiwibGVmdCIsImJvdHRvbSIsInRvcCIsInRhcmdldEdhbWVPYmplY3QiLCJvcmlnaW5hbEJvcmRlciIsImJvcmRlclJhZGl1cyIsIkhUTUxDYW52YXNFbGVtZW50IiwiY29udGV4dDJEIiwiZ2V0Q29udGV4dCIsInVwZGF0ZUNhbnZhc1NpemUiLCJ3aW5kb3ciLCJvcmlnaW5YIiwib3JpZ2luWSIsImNvb3JkT2Zmc2V0WCIsImNvb3JkT2Zmc2V0WSIsIm9iamVjdFNldCIsImRyYXdUaWxlR3JpZCIsImRyYXdCb3JkZXJzIiwiZHJhd1RpbGVIaWdobGlnaHQiLCJyZWFsT3JpZ2luIiwibW91c2VQb3NpdGlvbiIsImNhbnZhc1JlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJjYW52YXNQb3NpdGlvblRvUmVuZGVyQ29vcmRpbmF0ZXMiLCJtb3VzZVBvc2l0aW9uVG9DYW52YXNSZWxhdGl2ZVBvc2l0aW9uIiwiVGVycmFpbiIsInRlcnJhaW4iLCJyZWxhdGl2ZUNhbnZhc1Bvc2l0aW9uIiwiY29vcmRpbmF0ZXMiLCJ0aWxlU2l6ZVgiLCJ0aWxlU2l6ZVkiLCJmbG9vciIsImNlaWwiLCJjb250YWluZXJTdHlsZSIsImdldENvbXB1dGVkU3R5bGUiLCJwYXJlbnRFbGVtZW50Iiwid2lkdGgiLCJwYXJzZUZsb2F0IiwicGFkZGluZ0xlZnQiLCJwYWRkaW5nUmlnaHQiLCJib3JkZXJMZWZ0V2lkdGgiLCJib3JkZXJSaWdodFdpZHRoIiwiaGVpZ2h0IiwicGFkZGluZ1RvcCIsInBhZGRpbmdCb3R0b20iLCJib3JkZXJUb3BXaWR0aCIsImJvcmRlckJvdHRvbVdpZHRoIiwiaW1hZ2VPYmplY3QiLCJkZWxldGUiLCJjbGVhclJlY3QiLCJyZW5kZXJUZXJyYWluIiwicmVuZGVyVGlsZUdyaWQiLCJyZW5kZXJPYmplY3RzIiwiZmlsbFN0eWxlIiwidGlsZXMiLCJ0aWxlIiwidGlsZVBvc2l0aW9uIiwicm93IiwidG9GaXhlZCIsImNvbHVtbiIsImRyYXdJbWFnZSIsImhpZ2hsaWdodGVkIiwiZmlsbFJlY3QiLCJvYmplY3RTaXplIiwib2JqZWN0Qm9yZGVyIiwic3Ryb2tlU3R5bGUiLCJsaW5lV2lkdGgiLCJfIiwic29ydEJ5Iiwib2JqZWN0VG9SZW5kZXIiLCJtYXlSZW5kZXIiLCJzaXplIiwic3Ryb2tlUmVjdCIsImJvcmRlcldpZHRoIiwiYm9yZGVySGVpZ2h0IiwibWluWCIsIm1heFgiLCJtaW5ZIiwibWF4WSIsImJlZ2luUGF0aCIsImxvYWNrZWRQb3NpdGlvbiIsImkiLCJtb3ZlVG8iLCJsaW5lVG8iLCJqIiwic3Ryb2tlIiwib3JpZ2luIiwiY29vcmRPZmZzZXQiLCJJbWFnZVJlc291cmNlU3RhdHVzIiwiSU5JVElBVElORyIsIkZBSUxFRCIsIkxPQURJTkciLCJMT0FERUQiLCJJbWFnZVJlc291cmNlIiwicHJvZ3Jlc3MiLCJzdGF0dXMiLCJvbkxvYWQiLCJvblByb2dyZXNzIiwib25TdGF0dXNDaGFuZ2VkIiwibG9nIiwic2V0UHJvZ3Jlc3MiLCJpbWciLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbmxvYWRzdGFydCIsInNldFN0YXR1cyIsIm9ucHJvZ3Jlc3MiLCJvbmxvYWQiLCJvbmVycm9yIiwic291cmNlIiwiYWxpYXMiLCJzcmMiLCJpbWFnZVNyYyIsImNvbXBsZXRlIiwic2V0VHJpZ2dlcnMiLCJSZXNvdXJjZXMiLCJpbWFnZUNhY2hlIiwiTWFwIiwiaW1nU291cmNlIiwibmV3SW1hZ2VSZXNvdXJjZSIsImhhcyIsImFsZXJ0Iiwic2V0Iiwic2V0U291cmNlIiwic291cmNlcyIsInByb21pc2VzIiwiZW50cnkiLCJwdXNoIiwiYWRkSW1hZ2UiLCJhcHBseSIsImFsbCIsImNhY2hlIiwiZ2V0IiwiZ2V0T3JBZGRJbWFnZSIsIlRpbGUiLCJOdW1iZXIiLCJ0aWxlTWFwIiwidGlsZUhpZ2hsaWdodE1hcCIsInNldFRpbGUiLCJjbGVhciIsInZhbHVlcyIsInRpbGVTaXplIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7O0lBR01BO0FBQ0Y7OztBQUdB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bmdpbmUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiogQGNsYXNzXHJcbiovXHJcbmNsYXNzIEVuZ2luZSB7XHJcbiAgICAvKipcclxuICAgICogQGNvbnN0cnVjdG9yXHJcbiAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgaWYoRW5naW5lLmluc3RhbmNlIGluc3RhbmNlb2YgRW5naW5lKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VuZ2luZS5jb25zdHJ1Y3RvcjogRW5naW5lIGluc3RhbmNlIGFscmVhZHkgZXhpc3RzLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIEVuZ2luZS5pbnN0YW5jZSA9IHRoaXM7XHJcblxyXG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tTZXQgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgdGhpcy5rZXlDYWxsYmFja1NldCA9IG5ldyBTZXQoKTtcclxuICAgICAgICB0aGlzLm1vdXNlQ2FsbGJhY2tTZXQgPSBuZXcgU2V0KCk7XHJcblxyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5oYW5kbGVLZXlFdmVudHMuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuaGFuZGxlS2V5RXZlbnRzLmJpbmQodGhpcykpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgdGhpcy5oYW5kbGVLZXlFdmVudHMuYmluZCh0aGlzKSk7XHJcblxyXG4gICAgICAgIGlmKCFSZW5kZXIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRW5naW5lLmNvbnN0cnVjdG9yOiBSZW5kZXIgY2xhc3MgaXMgbm90IGRlZmluZWQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoIShSZW5kZXIuaW5zdGFuY2UgaW5zdGFuY2VvZiBSZW5kZXIpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VuZ2luZS5jb25zdHJ1Y3RvcjogVGhlcmUgaXMgbm8gcmVuZGVyIGluc3RhbmNlIHRvIHN1YnNjcmlicmUgbW91c2UgZXZlbnRzLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIgPSBSZW5kZXIuaW5zdGFuY2U7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuaGFuZGxlTW91c2VFdmVudHMuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3V0JywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2F1eGNsaWNrJywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuaGFuZGxlTW91c2VFdmVudHMuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlS2V5RXZlbnRzKGV2ZW50KSB7XHJcbiAgICAgICAgZm9yKGNvbnN0IGNhbGxiYWNrIG9mIHRoaXMua2V5Q2FsbGJhY2tTZXQpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBoYW5kbGVNb3VzZUV2ZW50cyhldmVudCkge1xyXG4gICAgICAgIGZvcihjb25zdCBjYWxsYmFjayBvZiB0aGlzLm1vdXNlQ2FsbGJhY2tTZXQpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGFydCgpIHtcclxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5yb3V0aW5lLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjdXJyZW50VGltZSgpIHtcclxuICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTtcclxuICAgIH1cclxuXHJcbiAgICByb3V0aW5lKCkge1xyXG4gICAgICAgIGNvbnN0IGRlbHRhVGltZSA9IHRoaXMuY3VycmVudFRpbWUgLSB0aGlzLmxhc3RUaW1lO1xyXG5cclxuICAgICAgICBmb3IoY29uc3QgY2FsbGJhY2sgb2YgdGhpcy5jYWxsYmFja1NldCkge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhkZWx0YVRpbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIucmVuZGVyKCk7XHJcblxyXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJvdXRpbmUuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAqIEBjYWxsYmFjayByb3V0aW5lQ2FsbGJhY2tcclxuICAgICogQHBhcmFtIHtudW1iZXJ9IGRlbHRhVGltZSAtIHRpbWUgc2luY2UgdGhlIGNhbGxiYWNrIHdhcyBsYXN0IGNhbGxlZC5cclxuICAgICovXHJcblxyXG4gICAgLyoqXHJcbiAgICAqIEBtZXRob2QgcmVnaXN0ZXJSb3V0aW5lQ2FsbGJhY2sgLSBhZGQgYSBjYWxsYmFjayB0byBiZSBpbnZva2VkIGJ5IHRoZSBlbmdpbmUuXHJcbiAgICAqIEBwYXJhbSB7cm91dGluZUNhbGxiYWNrfSBjYWxsYmFja1xyXG4gICAgKi9cclxuICAgIHJlZ2lzdGVyUm91dGluZUNhbGxiYWNrKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgdGhpcy5jYWxsYmFja1NldC5hZGQoY2FsbGJhY2spO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRW5naW5lLnJlZ2lzdGVyUm91dGluZUNhbGxiYWNrOiBjYWxsYmFjayBpcyBub3Qgc2V0IGFzIGEgZnVuY3Rpb24uJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyS2V5RXZlbnRDYWxsYmFjayhjYWxsYmFjaykge1xyXG4gICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHRoaXMua2V5Q2FsbGJhY2tTZXQuYWRkKGNhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VuZ2luZS5yZWdpc3RlcktleUV2ZW50Q2FsbGJhY2s6IGNhbGxiYWNrIGlzIG5vdCBzZXQgYXMgYSBmdW5jdGlvbi4nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVnaXN0ZXJNb3VzZUV2ZW50Q2FsbGJhY2soY2FsbGJhY2spIHtcclxuICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICB0aGlzLm1vdXNlQ2FsbGJhY2tTZXQuYWRkKGNhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VuZ2luZS5yZWdpc3Rlck1vdXNlRXZlbnRDYWxsYmFjazogY2FsbGJhY2sgaXMgbm90IHNldCBhcyBhIGZ1bmN0aW9uLicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJjb25zdCBmbGF0ID0ge307XHJcbiIsIi8qKlxyXG4qIEBjbGFzc1xyXG4qL1xyXG5jbGFzcyBJbWFnZU9iamVjdCB7XHJcbiAgICAvKipcclxuICAgICogQGNvbnN0cnVjdG9yXHJcbiAgICAqL1xyXG4gICAgY29uc3RydWN0b3Ioc3ByaXRlLCBzdWJzY3JpYmVUb1JlbmRlciA9IHRydWUpIHtcclxuICAgICAgICBpZihzcHJpdGUpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRTcHJpdGUoc3ByaXRlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucGl2b3RYID0gMC41O1xyXG4gICAgICAgIHRoaXMucGl2b3RZID0gMC41O1xyXG5cclxuICAgICAgICB0aGlzLnggPSAwO1xyXG4gICAgICAgIHRoaXMueSA9IDA7XHJcblxyXG4gICAgICAgIHRoaXMub3JpZ2luYWxzaXplWCA9IHRoaXMub3JpZ2luYWxzaXplWCB8fCAwO1xyXG4gICAgICAgIHRoaXMub3JpZ2luYWxzaXplWSA9IHRoaXMub3JpZ2luYWxzaXplWSB8fCAwO1xyXG5cclxuICAgICAgICB0aGlzLnNjYWxlWCA9IDE7XHJcbiAgICAgICAgdGhpcy5zY2FsZVkgPSAxO1xyXG5cclxuICAgICAgICB0aGlzLmxheWVyID0gMDtcclxuXHJcbiAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYoIVJlbmRlcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbWFnZU9iamVjdC5jb25zdHJ1Y3RvcjogUmVuZGVyIGNsYXNzIGlzIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKCEoUmVuZGVyLmluc3RhbmNlIGluc3RhbmNlb2YgUmVuZGVyKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbWFnZU9iamVjdC5jb25zdHJ1Y3RvcjogVGhlcmUgaXMgbm8gcmVuZGVyIGluc3RhbmNlIHRvIHN1YnNjcmlicmUgdG8uJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlciA9IFJlbmRlci5pbnN0YW5jZTtcclxuICAgICAgICAgICAgaWYoc3Vic2NyaWJlVG9SZW5kZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlVG9SZW5kZXIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgcGl2b3QoKSB7XHJcbiAgICAgICAgcmV0dXJuIFt0aGlzLnBpdm90WCwgdGhpcy5waXZvdFldO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBwaXZvdChwaXZvdCkge1xyXG4gICAgICAgIGlmKCAocGl2b3QgaW5zdGFuY2VvZiBBcnJheSkgJiYgKHBpdm90Lmxlbmd0aCA9PSAyKSAmJiAodHlwZW9mIHBpdm90WzBdID09ICdudW1iZXInKSAmJiAodHlwZW9mIHBpdm90WzFdID09ICdudW1iZXInKSApIHtcclxuICAgICAgICAgICAgdGhpcy5waXZvdFggPSBwaXZvdFswXTtcclxuICAgICAgICAgICAgdGhpcy5waXZvdFkgPSBwaXZvdFsxXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3NldCBJbWFnZU9iamVjdC5waXZvdDogcGl2b3QgaXMgbm90IGFuIGFycmF5IG9mIHNpemUgMiB0aGF0IGNvbnRhaW5zIG51bWJlcnMuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBwb3NpdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55XTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgcG9zaXRpb24ocG9zaXRpb24pIHtcclxuICAgICAgICBpZiggKHBvc2l0aW9uIGluc3RhbmNlb2YgQXJyYXkpICYmIChwb3NpdGlvbi5sZW5ndGggPT0gMikgJiYgKHR5cGVvZiBwb3NpdGlvblswXSA9PSAnbnVtYmVyJykgJiYgKHR5cGVvZiBwb3NpdGlvblsxXSA9PSAnbnVtYmVyJykgKSB7XHJcbiAgICAgICAgICAgIHRoaXMueCA9IHBvc2l0aW9uWzBdO1xyXG4gICAgICAgICAgICB0aGlzLnkgPSBwb3NpdGlvblsxXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3NldCBJbWFnZU9iamVjdC5wb3NpdGlvbjogcG9zaXRpb24gaXMgbm90IGFuIGFycmF5IG9mIHNpemUgMiB0aGF0IGNvbnRhaW5zIG51bWJlcnMuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBzaXplWCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5vcmlnaW5hbHNpemVYKnRoaXMuc2NhbGVYO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzaXplWSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5vcmlnaW5hbHNpemVZKnRoaXMuc2NhbGVZO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzaXplKCkge1xyXG4gICAgICAgIHJldHVybiBbdGhpcy5vcmlnaW5hbHNpemVYKnRoaXMuc2NhbGVYLCB0aGlzLm9yaWdpbmFsc2l6ZVkqdGhpcy5zY2FsZVldO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBvcmlnaW5hbHNpemUoKSB7XHJcbiAgICAgICAgcmV0dXJuIFt0aGlzLm9yaWdpbmFsc2l6ZVgsIHRoaXMub3JpZ2luYWxzaXplWV07XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IG9yaWdpbmFsc2l6ZShvcmlnaW5hbHNpemUpIHtcclxuICAgICAgICBpZiggKG9yaWdpbmFsc2l6ZSBpbnN0YW5jZW9mIEFycmF5KSAmJiAob3JpZ2luYWxzaXplLmxlbmd0aCA9PSAyKSAmJiAodHlwZW9mIG9yaWdpbmFsc2l6ZVswXSA9PSAnbnVtYmVyJykgJiYgKHR5cGVvZiBvcmlnaW5hbHNpemVbMV0gPT0gJ251bWJlcicpICkge1xyXG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsc2l6ZVggPSBvcmlnaW5hbHNpemVbMF07XHJcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxzaXplWSA9IG9yaWdpbmFsc2l6ZVsxXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3NldCBJbWFnZU9iamVjdC5vcmlnaW5hbHNpemU6IG9yaWdpbmFsc2l6ZSBpcyBub3QgYW4gYXJyYXkgb2Ygc2l6ZSAyIHRoYXQgY29udGFpbnMgbnVtYmVycy4nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNjYWxlKCkge1xyXG4gICAgICAgIHJldHVybiBbdGhpcy5zY2FsZVgsIHRoaXMuc2NhbGVZXTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgc2NhbGUoc2NhbGUpIHtcclxuICAgICAgICBpZiggKHNjYWxlIGluc3RhbmNlb2YgQXJyYXkpICYmIChzY2FsZS5sZW5ndGggPT0gMikgJiYgKHR5cGVvZiBzY2FsZVswXSA9PSAnbnVtYmVyJykgJiYgKHR5cGVvZiBzY2FsZVsxXSA9PSAnbnVtYmVyJykgKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gc2NhbGVbMF07XHJcbiAgICAgICAgICAgIHRoaXMuc2NhbGVZID0gc2NhbGVbMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYodHlwZW9mIHNjYWxlID09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gc2NhbGU7XHJcbiAgICAgICAgICAgIHRoaXMuc2NhbGVZID0gc2NhbGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzZXQgSW1hZ2VPYmplY3Quc2NhbGU6IHNjYWxlIGlzIG5vdCBhbiBhcnJheSBvZiBzaXplIDIgdGhhdCBjb250YWlucyBudW1iZXJzIG9yIHNpbXBseSBhIG51bWJlci4nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbWF5UmVuZGVyKCkge1xyXG4gICAgICAgIHJldHVybiAodGhpcy5zcHJpdGUgaW5zdGFuY2VvZiBJbWFnZSkgJiYgdGhpcy52aXNpYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNwcml0ZShzcHJpdGUsIGFkanVzdFNpemUgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYoc3ByaXRlIGluc3RhbmNlb2YgSW1hZ2UpIHtcclxuICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBzcHJpdGU7XHJcblxyXG4gICAgICAgICAgICBpZihhZGp1c3RTaXplKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsc2l6ZVggPSBzcHJpdGUubmF0dXJhbFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbHNpemVZID0gc3ByaXRlLm5hdHVyYWxIZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZihzcHJpdGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignR2FtZU9iamVjdC5jb25zdHJ1Y3Rvcjogc3ByaXRlIGlzIG5vdCBzZXQgYXMgYSBJbWFnZSBvYmplY3QuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnNwcml0ZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN1YnNjcmliZVRvUmVuZGVyKCkge1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnJlZ2lzdGVyT2JqZWN0KHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHVuc3Vic2NyaWJlVG9SZW5kZXIoKSB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIudW5yZWdpc3Rlck9iamVjdCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVDb3B5KCkge1xyXG4gICAgICAgIGNvbnN0IG5ld0NvcHkgPSBuZXcgSW1hZ2VPYmplY3QodGhpcy5zcHJpdGUsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgdGhpcy5jb3B5UHJvcGVydGllc1RvKG5ld0NvcHkpO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3Q29weTtcclxuICAgIH1cclxuXHJcbiAgICBjb3B5UHJvcGVydGllc1RvKHRhcmdldEltYWdlT2JqZWN0KSB7XHJcbiAgICAgICAgaWYoKHRhcmdldEltYWdlT2JqZWN0IGluc3RhbmNlb2YgSW1hZ2VPYmplY3QpKSB7XHJcbiAgICAgICAgICAgIHRhcmdldEltYWdlT2JqZWN0LnNwcml0ZSA9IHRoaXMuc3ByaXRlO1xyXG5cclxuICAgICAgICAgICAgdGFyZ2V0SW1hZ2VPYmplY3QucGl2b3QgPSBbdGhpcy5waXZvdFgsIHRoaXMucGl2b3RZXTtcclxuICAgICAgICAgICAgdGFyZ2V0SW1hZ2VPYmplY3QucG9zaXRpb24gPSBbdGhpcy54LCB0aGlzLnldO1xyXG5cclxuICAgICAgICAgICAgdGFyZ2V0SW1hZ2VPYmplY3Qub3JpZ2luYWxzaXplID0gW3RoaXMub3JpZ2luYWxzaXplWCwgdGhpcy5vcmlnaW5hbHNpemVZXTtcclxuXHJcbiAgICAgICAgICAgIHRhcmdldEltYWdlT2JqZWN0LnNjYWxlID0gW3RoaXMuc2NhbGVYLCB0aGlzLnNjYWxlWV07XHJcblxyXG4gICAgICAgICAgICB0YXJnZXRJbWFnZU9iamVjdC5sYXllciA9IHRoaXMubGF5ZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbWFnZU9iamVjdC5jb3B5UHJvcGVydGllc1RvOiB0YXJnZXRJbWFnZU9iamVjdCBpcyBub3QgYSBJbWFnZU9iamVjdCBpbnN0YW5jZS4nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4qIEBjbGFzc1xyXG4qL1xyXG5jbGFzcyBHYW1lT2JqZWN0IGV4dGVuZHMgSW1hZ2VPYmplY3Qge1xyXG4gICAgLyoqXHJcbiAgICAqIEBjb25zdHJ1Y3RvclxyXG4gICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHNwcml0ZSwgc3Vic2NyaWJlVG9SZW5kZXIgPSB0cnVlKSB7XHJcbiAgICAgICAgc3VwZXIoc3ByaXRlLCBzdWJzY3JpYmVUb1JlbmRlcik7XHJcblxyXG4gICAgICAgIHRoaXMudnggPSAwO1xyXG4gICAgICAgIHRoaXMudnkgPSAwO1xyXG5cclxuICAgICAgICB0aGlzLm9yaWdpbmFsQm9yZGVyV2lkdGggPSB0aGlzLm9yaWdpbmFsc2l6ZVggfHwgNjQ7XHJcbiAgICAgICAgdGhpcy5vcmlnaW5hbEJvcmRlckhlaWdodCA9IHRoaXMub3JpZ2luYWxzaXplWSB8fCA2NDtcclxuICAgICAgICAvLyAvLyBCb3ggY29saWRlclxyXG4gICAgICAgIC8vIHRoaXMuYm94Q29sbGlkZXJTaXplID0gWzAsIDBdO1xyXG4gICAgICAgIC8vIHRoaXMuYm94Q29sbGlkZXJQb3NpdGlvbk9mZnNldCA9IFswLCAwXTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vIHRoaXMuYWN0aXZlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGUoZGVsdGFUaW1lKSB7XHJcbiAgICAgICAgaWYodGhpcy5hY3RpdmUpIHtcclxuICAgICAgICAgICAgdGhpcy54ICs9IHRoaXMudngqZGVsdGFUaW1lO1xyXG4gICAgICAgICAgICB0aGlzLnkgKz0gdGhpcy52eSpkZWx0YVRpbWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBib3JkZXJXaWR0aCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5vcmlnaW5hbEJvcmRlcldpZHRoKnRoaXMuc2NhbGVYO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBib3JkZXJIZWlnaHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3JpZ2luYWxCb3JkZXJIZWlnaHQqdGhpcy5zY2FsZVk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG9yaWdpbmFsQm9yZGVyKCkge1xyXG4gICAgICAgIHJldHVybiBbdGhpcy5vcmlnaW5hbEJvcmRlcldpZHRoLCB0aGlzLm9yaWdpbmFsQm9yZGVySGVpZ2h0XTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgb3JpZ2luYWxCb3JkZXIob3JpZ2luYWxCb3JkZXIpIHtcclxuICAgICAgICBpZiggKG9yaWdpbmFsQm9yZGVyIGluc3RhbmNlb2YgQXJyYXkpICYmIChvcmlnaW5hbEJvcmRlci5sZW5ndGggPT0gMikgJiYgKHR5cGVvZiBvcmlnaW5hbEJvcmRlclswXSA9PSAnbnVtYmVyJykgJiYgKHR5cGVvZiBvcmlnaW5hbEJvcmRlclsxXSA9PSAnbnVtYmVyJykgKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxCb3JkZXJXaWR0aCA9IG9yaWdpbmFsQm9yZGVyWzBdO1xyXG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsQm9yZGVySGVpZ2h0ID0gb3JpZ2luYWxCb3JkZXJbMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzZXQgSW1hZ2VPYmplY3Qub3JpZ2luYWxCb3JkZXI6IG9yaWdpbmFsQm9yZGVyIGlzIG5vdCBhbiBhcnJheSBvZiBzaXplIDIgdGhhdCBjb250YWlucyBudW1iZXJzLicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgYm9yZGVyKCkge1xyXG4gICAgICAgIGNvbnN0IGJvcmRlclJhZGl1cyA9IFsrIDAuNSp0aGlzLm9yaWdpbmFsQm9yZGVyV2lkdGgqdGhpcy5zY2FsZVgsIDAuNSp0aGlzLm9yaWdpbmFsQm9yZGVySGVpZ2h0KnRoaXMuc2NhbGVZXTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdG9wOiB0aGlzLnkgKyBib3JkZXJSYWRpdXNbMV0sXHJcbiAgICAgICAgICAgIHJpZ2h0OiB0aGlzLnggKyBib3JkZXJSYWRpdXNbMF0sXHJcbiAgICAgICAgICAgIGJvdHRvbTogdGhpcy55IC0gYm9yZGVyUmFkaXVzWzFdLFxyXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLnggLSBib3JkZXJSYWRpdXNbMF1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGhhc0NvbGxpZGVkKG90aGVyQm9yZGVyKSB7XHJcbiAgICAgICAgdmFyIG15Qm9yZGVyID0gdGhpcy5ib3JkZXI7XHJcblxyXG4gICAgICAgIHJldHVybiAoTWF0aC5taW4obXlCb3JkZXIucmlnaHQsIG90aGVyQm9yZGVyLnJpZ2h0KSAtIE1hdGgubWF4KG15Qm9yZGVyLmxlZnQsIG90aGVyQm9yZGVyLmxlZnQpID49IDApICYmIChNYXRoLm1pbihteUJvcmRlci5ib3R0b20sIG90aGVyQm9yZGVyLmJvdHRvbSkgLSBNYXRoLm1heChteUJvcmRlci50b3AsIG90aGVyQm9yZGVyLnRvcCkgPj0gMCk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ29weSgpIHtcclxuICAgICAgICBjb25zdCBuZXdDb3B5ID0gbmV3IEdhbWVPYmplY3QodGhpcy5zcHJpdGUsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgdGhpcy5jb3B5UHJvcGVydGllc1RvKG5ld0NvcHkpO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3Q29weTtcclxuICAgIH1cclxuXHJcbiAgICBjb3B5UHJvcGVydGllc1RvKHRhcmdldEdhbWVPYmplY3QpIHtcclxuICAgICAgICBpZigodGFyZ2V0R2FtZU9iamVjdCBpbnN0YW5jZW9mIEdhbWVPYmplY3QpKSB7XHJcbiAgICAgICAgICAgIHN1cGVyLmNvcHlQcm9wZXJ0aWVzVG8odGFyZ2V0R2FtZU9iamVjdCk7XHJcblxyXG4gICAgICAgICAgICB0YXJnZXRHYW1lT2JqZWN0LnZ4ID0gdGhpcy52eDtcclxuICAgICAgICAgICAgdGFyZ2V0R2FtZU9iamVjdC52eSA9IHRoaXMudnk7XHJcblxyXG4gICAgICAgICAgICB0YXJnZXRHYW1lT2JqZWN0Lm9yaWdpbmFsQm9yZGVyV2lkdGggPSB0aGlzLm9yaWdpbmFsQm9yZGVyV2lkdGg7XHJcbiAgICAgICAgICAgIHRhcmdldEdhbWVPYmplY3Qub3JpZ2luYWxCb3JkZXJIZWlnaHQgPSB0aGlzLm9yaWdpbmFsQm9yZGVySGVpZ2h0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignR2FtZU9iamVjdC5jb3B5UHJvcGVydGllc1RvOiB0YXJnZXRHYW1lT2JqZWN0IGlzIG5vdCBhIEdhbWVPYmplY3QgaW5zdGFuY2UuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsImNsYXNzIFJlbmRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihjYW52YXMpIHtcclxuICAgICAgICBpZihSZW5kZXIuaW5zdGFuY2UgaW5zdGFuY2VvZiBSZW5kZXIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVuZGVyLmNvbnN0cnVjdG9yOiBSZW5kZXIgaW5zdGFuY2UgYWxyZWFkeSBleGlzdHMuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoIShjYW52YXMgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlJlbmRlci5jb25zdHJ1Y3RvcjogZ2l2ZW4gY2FudmFzIG9iamVjdCBpcyBub3QgYW4gSFRNTENhbnZhc0VsZW1lbnQuXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFJlbmRlci5pbnN0YW5jZSA9IHRoaXM7XHJcblxyXG4gICAgICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xyXG4gICAgICAgIHRoaXMuY29udGV4dDJEID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVDYW52YXNTaXplKCk7XHJcblxyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnVwZGF0ZUNhbnZhc1NpemUpO1xyXG5cclxuICAgICAgICAvLyBDb29yZGluYXRlIHN5dGVtLiBBeGlzIG9yaWVudGF0aW9uIHdpbGwgYmU6IFgtPnJpZ2h0ICwgWS0+dXBcclxuICAgICAgICB0aGlzLm9yaWdpblggPSAwLjU7XHJcbiAgICAgICAgdGhpcy5vcmlnaW5ZID0gMC41O1xyXG5cclxuICAgICAgICB0aGlzLmNvb3JkT2Zmc2V0WCA9IDA7XHJcbiAgICAgICAgdGhpcy5jb29yZE9mZnNldFkgPSAwO1xyXG5cclxuICAgICAgICB0aGlzLm9iamVjdFNldCA9IG5ldyBTZXQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5kcmF3VGlsZUdyaWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmRyYXdCb3JkZXJzID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5kcmF3VGlsZUhpZ2hsaWdodCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbnZhc1Bvc2l0aW9uVG9SZW5kZXJDb29yZGluYXRlcyhwb3NpdGlvbikge1xyXG4gICAgICAgIGlmKCAocG9zaXRpb24gaW5zdGFuY2VvZiBBcnJheSkgJiYgKHBvc2l0aW9uLmxlbmd0aCA9PSAyKSAmJiAodHlwZW9mIHBvc2l0aW9uWzBdID09ICdudW1iZXInKSAmJiAodHlwZW9mIHBvc2l0aW9uWzFdID09ICdudW1iZXInKSApIHtcclxuICAgICAgICAgICAgY29uc3QgcmVhbE9yaWdpbiA9IHRoaXMucmVhbE9yaWdpbjtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvblswXSAtIHJlYWxPcmlnaW5bMF0sXHJcbiAgICAgICAgICAgICAgICByZWFsT3JpZ2luWzFdIC0gcG9zaXRpb25bMV1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3NldCBSZW5kZXIuY2FudmFzUG9zaXRpb25Ub1JlbmRlckNvb3JkaW5hdGVzOiBwb3NpdGlvbiBpcyBub3QgYW4gYXJyYXkgb2Ygc2l6ZSAyIHRoYXQgY29udGFpbnMgbnVtYmVycy4nKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1vdXNlUG9zaXRpb25Ub0NhbnZhc1JlbGF0aXZlUG9zaXRpb24obW91c2VQb3NpdGlvbikge1xyXG4gICAgICAgIGNvbnN0IGNhbnZhc1JlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgbW91c2VQb3NpdGlvblswXSAtIGNhbnZhc1JlY3QubGVmdCxcclxuICAgICAgICAgICAgbW91c2VQb3NpdGlvblsxXSAtIGNhbnZhc1JlY3QudG9wXHJcbiAgICAgICAgXTtcclxuICAgIH1cclxuXHJcbiAgICBtb3VzZVBvc2l0aW9uVG9SZW5kZXJDb29yZGluYXRlcyhtb3VzZVBvc2l0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzUG9zaXRpb25Ub1JlbmRlckNvb3JkaW5hdGVzKHRoaXMubW91c2VQb3NpdGlvblRvQ2FudmFzUmVsYXRpdmVQb3NpdGlvbihtb3VzZVBvc2l0aW9uKSk7XHJcbiAgICB9XHJcblxyXG4gICAgbW91c2VQb3NpdGlvblRvVGlsZUNvb3JkaW5hdGVzKG1vdXNlUG9zaXRpb24pIHtcclxuICAgICAgICBpZighVGVycmFpbikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZW5kZXIubW91c2VQb3NpdGlvblRvVGlsZUNvb3JkaW5hdGVzOiBUZXJyYWluIGNsYXNzIGlzIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKCEodGhpcy50ZXJyYWluIGluc3RhbmNlb2YgVGVycmFpbikpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVuZGVyLm1vdXNlUG9zaXRpb25Ub1RpbGVDb29yZGluYXRlczogdGVycmFpbiBpcyBub3Qgc2V0LicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgcmVhbE9yaWdpbiA9IHRoaXMucmVhbE9yaWdpbjtcclxuICAgICAgICAgICAgY29uc3QgcmVsYXRpdmVDYW52YXNQb3NpdGlvbiA9IHRoaXMubW91c2VQb3NpdGlvblRvQ2FudmFzUmVsYXRpdmVQb3NpdGlvbihtb3VzZVBvc2l0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gW1xyXG4gICAgICAgICAgICAgICAgMC41ICsgKHJlbGF0aXZlQ2FudmFzUG9zaXRpb25bMF0gLSByZWFsT3JpZ2luWzBdKS90aGlzLnRlcnJhaW4udGlsZVNpemVYLFxyXG4gICAgICAgICAgICAgICAgLTAuNSArIChyZWFsT3JpZ2luWzFdIC0gcmVsYXRpdmVDYW52YXNQb3NpdGlvblsxXSkvdGhpcy50ZXJyYWluLnRpbGVTaXplWVxyXG4gICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoY29vcmRpbmF0ZXNbMF0pLFxyXG4gICAgICAgICAgICAgICAgTWF0aC5jZWlsKGNvb3JkaW5hdGVzWzFdKVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgb3JpZ2luKCkge1xyXG4gICAgICAgIHJldHVybiBbdGhpcy5vcmlnaW5YLCB0aGlzLm9yaWdpblldO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBvcmlnaW4ob3JpZ2luKSB7XHJcbiAgICAgICAgaWYoIChvcmlnaW4gaW5zdGFuY2VvZiBBcnJheSkgJiYgKG9yaWdpbi5sZW5ndGggPT0gMikgJiYgKHR5cGVvZiBvcmlnaW5bMF0gPT0gJ251bWJlcicpICYmICh0eXBlb2Ygb3JpZ2luWzFdID09ICdudW1iZXInKSApIHtcclxuICAgICAgICAgICAgdGhpcy5vcmlnaW5YID0gb3JpZ2luWzBdO1xyXG4gICAgICAgICAgICB0aGlzLm9yaWdpblkgPSBvcmlnaW5bMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzZXQgUmVuZGVyLm9yaWdpbjogb3JpZ2luIGlzIG5vdCBhbiBhcnJheSBvZiBzaXplIDIgdGhhdCBjb250YWlucyBudW1iZXJzLicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgY29vcmRPZmZzZXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIFt0aGlzLmNvb3JkT2Zmc2V0WCwgdGhpcy5jb29yZE9mZnNldFldO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBjb29yZE9mZnNldChjb29yZE9mZnNldCkge1xyXG4gICAgICAgIGlmKCAoY29vcmRPZmZzZXQgaW5zdGFuY2VvZiBBcnJheSkgJiYgKGNvb3JkT2Zmc2V0Lmxlbmd0aCA9PSAyKSAmJiAodHlwZW9mIGNvb3JkT2Zmc2V0WzBdID09ICdudW1iZXInKSAmJiAodHlwZW9mIGNvb3JkT2Zmc2V0WzFdID09ICdudW1iZXInKSApIHtcclxuICAgICAgICAgICAgdGhpcy5jb29yZE9mZnNldFggPSBjb29yZE9mZnNldFswXS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29vcmRPZmZzZXRZID0gY29vcmRPZmZzZXRbMV0udG9GaXhlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignc2V0IFJlbmRlci5jb29yZE9mZnNldDogY29vcmRPZmZzZXQgaXMgbm90IGFuIGFycmF5IG9mIHNpemUgMiB0aGF0IGNvbnRhaW5zIG51bWJlcnMuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCByZWFsT3JpZ2luKCkge1xyXG4gICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgIHRoaXMub3JpZ2luWCp0aGlzLmNhbnZhcy53aWR0aCArIHRoaXMuY29vcmRPZmZzZXRYLFxyXG4gICAgICAgICAgICAoMSAtIHRoaXMub3JpZ2luWSkqdGhpcy5jYW52YXMuaGVpZ2h0IC0gdGhpcy5jb29yZE9mZnNldFlcclxuICAgICAgICBdO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUNhbnZhc1NpemUoKSB7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmNhbnZhcy5wYXJlbnRFbGVtZW50KTtcclxuXHJcbiAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSBwYXJzZUZsb2F0KGNvbnRhaW5lclN0eWxlLndpZHRoKSAtIHBhcnNlRmxvYXQoY29udGFpbmVyU3R5bGUucGFkZGluZ0xlZnQpIC0gcGFyc2VGbG9hdChjb250YWluZXJTdHlsZS5wYWRkaW5nUmlnaHQpIC0gcGFyc2VGbG9hdChjb250YWluZXJTdHlsZS5ib3JkZXJMZWZ0V2lkdGgpIC0gcGFyc2VGbG9hdChjb250YWluZXJTdHlsZS5ib3JkZXJSaWdodFdpZHRoKTtcclxuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSBwYXJzZUZsb2F0KGNvbnRhaW5lclN0eWxlLmhlaWdodCkgLSBwYXJzZUZsb2F0KGNvbnRhaW5lclN0eWxlLnBhZGRpbmdUb3ApIC0gcGFyc2VGbG9hdChjb250YWluZXJTdHlsZS5wYWRkaW5nQm90dG9tKSAtIHBhcnNlRmxvYXQoY29udGFpbmVyU3R5bGUuYm9yZGVyVG9wV2lkdGgpIC0gcGFyc2VGbG9hdChjb250YWluZXJTdHlsZS5ib3JkZXJCb3R0b21XaWR0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVnaXN0ZXJPYmplY3QoaW1hZ2VPYmplY3QpIHtcclxuICAgICAgICBpZighSW1hZ2VPYmplY3QpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVuZGVyLnJlZ2lzdGVyT2JqZWN0OiBJbWFnZU9iamVjdCBjbGFzcyBpcyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighKGltYWdlT2JqZWN0IGluc3RhbmNlb2YgSW1hZ2VPYmplY3QpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlbmRlci5yZWdpc3Rlck9iamVjdDogaW1hZ2VPYmplY3QgaXMgbm90IGEgSW1hZ2VPYmplY3Qgb2JqZWN0LicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5vYmplY3RTZXQuYWRkKGltYWdlT2JqZWN0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdW5yZWdpc3Rlck9iamVjdChpbWFnZU9iamVjdCkge1xyXG4gICAgICAgIGlmKCFJbWFnZU9iamVjdCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZW5kZXIucmVnaXN0ZXJPYmplY3Q6IEltYWdlT2JqZWN0IGNsYXNzIGlzIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKCEoaW1hZ2VPYmplY3QgaW5zdGFuY2VvZiBJbWFnZU9iamVjdCkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVuZGVyLnJlZ2lzdGVyT2JqZWN0OiBpbWFnZU9iamVjdCBpcyBub3QgYSBJbWFnZU9iamVjdCBvYmplY3QuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm9iamVjdFNldC5kZWxldGUoaW1hZ2VPYmplY3QpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRUZXJyYWluKHRlcnJhaW4pIHtcclxuICAgICAgICBpZighVGVycmFpbikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZW5kZXIuc2V0VGVycmFpbjogVGVycmFpbiBjbGFzcyBpcyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighKHRlcnJhaW4gaW5zdGFuY2VvZiBUZXJyYWluKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZW5kZXIuc2V0VGVycmFpbjogdGVycmFpbiBpcyBub3QgYSBUZXJyYWluIG9iamVjdC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudGVycmFpbiA9IHRlcnJhaW47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlcigpIHtcclxuICAgICAgICB0aGlzLmNvbnRleHQyRC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyVGVycmFpbigpO1xyXG5cclxuICAgICAgICBpZih0aGlzLmRyYXdUaWxlR3JpZCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlclRpbGVHcmlkKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJlbmRlck9iamVjdHMoKTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJUZXJyYWluKCkge1xyXG4gICAgICAgIGNvbnN0IHJlYWxPcmlnaW4gPSB0aGlzLnJlYWxPcmlnaW47XHJcblxyXG4gICAgICAgIHRoaXMuY29udGV4dDJELmZpbGxTdHlsZSA9ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNCknO1xyXG5cclxuICAgICAgICBpZih0aGlzLnRlcnJhaW4pIHtcclxuICAgICAgICAgICAgZm9yKGNvbnN0IHRpbGUgb2YgdGhpcy50ZXJyYWluLnRpbGVzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0aWxlUG9zaXRpb24gPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgKHJlYWxPcmlnaW5bMF0gKyAodGlsZS5yb3cgLSAwLjUpKnRoaXMudGVycmFpbi50aWxlU2l6ZVgpLnRvRml4ZWQoKSxcclxuICAgICAgICAgICAgICAgICAgICAocmVhbE9yaWdpblsxXSAtICh0aWxlLmNvbHVtbiArIDAuNSkqdGhpcy50ZXJyYWluLnRpbGVTaXplWSkudG9GaXhlZCgpXHJcbiAgICAgICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKHRpbGUuc3ByaXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0MkQuZHJhd0ltYWdlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aWxlLnNwcml0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGlsZVBvc2l0aW9uWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aWxlUG9zaXRpb25bMV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnRlcnJhaW4udGlsZVNpemVYKS50b0ZpeGVkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnRlcnJhaW4udGlsZVNpemVZKS50b0ZpeGVkKClcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuZHJhd1RpbGVIaWdobGlnaHQgJiYgdGlsZS5oaWdobGlnaHRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dDJELmZpbGxSZWN0KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aWxlUG9zaXRpb25bMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbGVQb3NpdGlvblsxXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMudGVycmFpbi50aWxlU2l6ZVgpLnRvRml4ZWQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMudGVycmFpbi50aWxlU2l6ZVkpLnRvRml4ZWQoKVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyT2JqZWN0cygpIHtcclxuICAgICAgICBjb25zdCByZWFsT3JpZ2luID0gdGhpcy5yZWFsT3JpZ2luO1xyXG5cclxuICAgICAgICBsZXQgb2JqZWN0U2l6ZSwgb2JqZWN0Qm9yZGVyO1xyXG5cclxuICAgICAgICB0aGlzLmNvbnRleHQyRC5zdHJva2VTdHlsZSA9ICdwdXJwbGUnO1xyXG4gICAgICAgIHRoaXMuY29udGV4dDJELmxpbmVXaWR0aCA9IDI7XHJcblxyXG4gICAgICAgIGZvcihjb25zdCBvYmplY3RUb1JlbmRlciBvZiBfLnNvcnRCeShbLi4udGhpcy5vYmplY3RTZXRdLCAnbGF5ZXInKSkge1xyXG4gICAgICAgICAgICBpZihvYmplY3RUb1JlbmRlci5tYXlSZW5kZXIoKSkge1xyXG4gICAgICAgICAgICAgICAgb2JqZWN0U2l6ZSA9IG9iamVjdFRvUmVuZGVyLnNpemU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQyRC5kcmF3SW1hZ2UoXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0VG9SZW5kZXIuc3ByaXRlLFxyXG4gICAgICAgICAgICAgICAgICAgIChyZWFsT3JpZ2luWzBdICsgb2JqZWN0VG9SZW5kZXIueCAtIG9iamVjdFRvUmVuZGVyLnBpdm90WCpvYmplY3RTaXplWzBdKS50b0ZpeGVkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgKHJlYWxPcmlnaW5bMV0gLSAob2JqZWN0VG9SZW5kZXIueSArICgxIC0gb2JqZWN0VG9SZW5kZXIucGl2b3RZKSpvYmplY3RTaXplWzFdKSkudG9GaXhlZCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIChvYmplY3RTaXplWzBdKS50b0ZpeGVkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgKG9iamVjdFNpemVbMV0pLnRvRml4ZWQoKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmRyYXdCb3JkZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIUdhbWVPYmplY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVuZGVyLnJlbmRlck9iamVjdHM6IEdhbWVPYmplY3QgY2xhc3Mgbm90IGRlZmluZWQuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoKG9iamVjdFRvUmVuZGVyIGluc3RhbmNlb2YgR2FtZU9iamVjdCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0Qm9yZGVyID0gb2JqZWN0VG9SZW5kZXIuYm9yZGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQyRC5zdHJva2VSZWN0KHJlYWxPcmlnaW5bMF0gKyBvYmplY3RCb3JkZXIubGVmdCwgcmVhbE9yaWdpblsxXSAtIG9iamVjdEJvcmRlci50b3AsIG9iamVjdFRvUmVuZGVyLmJvcmRlcldpZHRoLCBvYmplY3RUb1JlbmRlci5ib3JkZXJIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJUaWxlR3JpZCgpIHtcclxuICAgICAgICBpZih0aGlzLnRlcnJhaW4pIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0MkQuc3Ryb2tlU3R5bGUgPSAnd2hpdGUnO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQyRC5saW5lV2lkdGggPSAxO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcmVhbE9yaWdpbiA9IHRoaXMucmVhbE9yaWdpbjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1pblggPSBNYXRoLmNlaWwoMC41IC0gcmVhbE9yaWdpblswXS90aGlzLnRlcnJhaW4udGlsZVNpemVYKTtcclxuICAgICAgICAgICAgY29uc3QgbWF4WCA9IE1hdGguZmxvb3IoMC41ICsgKHRoaXMuY2FudmFzLndpZHRoIC0gcmVhbE9yaWdpblswXSkvdGhpcy50ZXJyYWluLnRpbGVTaXplWCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtaW5ZID0gTWF0aC5jZWlsKC0wLjUgKyAocmVhbE9yaWdpblsxXSAtIHRoaXMuY2FudmFzLmhlaWdodCkvdGhpcy50ZXJyYWluLnRpbGVTaXplWSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1heFkgPSBNYXRoLmZsb29yKC0wLjUgKyByZWFsT3JpZ2luWzFdL3RoaXMudGVycmFpbi50aWxlU2l6ZVkpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0MkQuYmVnaW5QYXRoKCk7XHJcblxyXG4gICAgICAgICAgICBsZXQgbG9hY2tlZFBvc2l0aW9uID0gMDtcclxuXHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IG1pblg7IGkgPD0gbWF4WDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBsb2Fja2VkUG9zaXRpb24gPSAocmVhbE9yaWdpblswXSArIChpIC0gMC41KSp0aGlzLnRlcnJhaW4udGlsZVNpemVYKS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQyRC5tb3ZlVG8obG9hY2tlZFBvc2l0aW9uLCAwKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dDJELmxpbmVUbyhsb2Fja2VkUG9zaXRpb24sdGhpcy5jYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yKGxldCBqID0gbWluWTsgaiA8PSBtYXhZOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGxvYWNrZWRQb3NpdGlvbiA9IChyZWFsT3JpZ2luWzFdIC0gKGogKyAwLjUpKnRoaXMudGVycmFpbi50aWxlU2l6ZVkpLnRvRml4ZWQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dDJELm1vdmVUbygwLCBsb2Fja2VkUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0MkQubGluZVRvKHRoaXMuY2FudmFzLndpZHRoLCBsb2Fja2VkUG9zaXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQyRC5zdHJva2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwiY29uc3QgSW1hZ2VSZXNvdXJjZVN0YXR1cyA9IHtcclxuICAgIElOSVRJQVRJTkc6ICdJbml0aWF0aW5nJyxcclxuICAgIEZBSUxFRDogJ0ZhaWxlZCcsXHJcbiAgICBMT0FESU5HOiAnTG9hZGluZycsXHJcbiAgICBMT0FERUQ6ICdMb2FkZWQnXHJcbn07XHJcblxyXG5jbGFzcyBJbWFnZVJlc291cmNlIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3MgPSAwO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gSW1hZ2VSZXNvdXJjZVN0YXR1cy5JTklUSUFUSU5HO1xyXG4gICAgICAgIHRoaXMub25Mb2FkID0gbnVsbDtcclxuICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsO1xyXG4gICAgICAgIHRoaXMub25TdGF0dXNDaGFuZ2VkID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0IElNQUdFX1NUQVRVUygpIHtcclxuICAgICAgICByZXR1cm4gSW1hZ2VSZXNvdXJjZVN0YXR1cztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbG9hZGVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN0YXR1cyA9PSBJbWFnZVJlc291cmNlU3RhdHVzLkxPQURFRDtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQcm9ncmVzcyhwcm9ncmVzcykge1xyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3MgPSBwcm9ncmVzcztcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coYEltYWdlUmVzb3VyY2Uuc2V0UHJvZ3Jlc3M6ICR7cHJvZ3Jlc3N9YCk7XHJcblxyXG4gICAgICAgIGlmKHRoaXMub25Qcm9ncmVzcykge1xyXG4gICAgICAgICAgICB0aGlzLm9uUHJvZ3Jlc3ModGhpcy5wcm9ncmVzcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFN0YXR1cyhzdGF0dXMpIHtcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcclxuXHJcbiAgICAgICAgaWYodGhpcy5vblN0YXR1c0NoYW5nZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5vblN0YXR1c0NoYW5nZWQodGhpcy5zdGF0dXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLnN0YXR1cykge1xyXG4gICAgICAgICAgICBjYXNlIEltYWdlUmVzb3VyY2VTdGF0dXMuSU5JVElBVElORzpcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIEltYWdlUmVzb3VyY2VTdGF0dXMuRkFJTEVEOlxyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgSW1hZ2VSZXNvdXJjZVN0YXR1cy5MT0FESU5HOlxyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgSW1hZ2VSZXNvdXJjZVN0YXR1cy5MT0FERUQ6XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UHJvZ3Jlc3MoMSk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMub25Mb2FkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uTG9hZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VHJpZ2dlcnMoKSB7XHJcbiAgICAgICAgaWYodGhpcy5pbWcpIHtcclxuICAgICAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbWcub25sb2Fkc3RhcnQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoSW1hZ2VSZXNvdXJjZVN0YXR1cy5MT0FESU5HKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5vbnByb2dyZXNzID0gcHJvZ3Jlc3MgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSB0aGlzLnNldFByb2dyZXNzKHByb2dyZXNzKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoSW1hZ2VSZXNvdXJjZVN0YXR1cy5MT0FERUQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodGhpcyk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbWcub25lcnJvciA9IChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdHVzKEltYWdlUmVzb3VyY2VTdGF0dXMuRkFJTEVEKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFNvdXJjZShzb3VyY2UsIGFsaWFzKSB7XHJcbiAgICAgICAgaWYoc291cmNlKSB7XHJcbiAgICAgICAgICAgIGlmKHNvdXJjZSBpbnN0YW5jZW9mIEltYWdlKSB7XHJcbiAgICAgICAgICAgICAgICBpZihzb3VyY2Uuc3JjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYWxpYXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGlhcyA9IGFsaWFzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZVNyYyA9IHNvdXJjZS5zcmM7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWcgPSBzb3VyY2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHNvdXJjZS5jb21wbGV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1cyhJbWFnZVJlc291cmNlU3RhdHVzLkxPQURFRCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFRyaWdnZXJzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW1hZ2VSZXNvdXJjZSByZXF1aXJlcyBhIHByb3BlciBzb3VyY2UuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZih0eXBlb2Ygc291cmNlID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICBpZihhbGlhcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWxpYXMgPSBhbGlhcztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmltYWdlU3JjID0gc291cmNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRyaWdnZXJzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuc3JjID0gc291cmNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW1hZ2VSZXNvdXJjZSByZXF1aXJlcyBhIHByb3BlciBzb3VyY2UuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBSZXNvdXJjZXMge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5pbWFnZUNhY2hlID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiBAbWV0aG9kIGFkZEltYWdlIC0gQWRkIGFuIGltYWdlIHJlc291cmNlIGFuZCBzdGFydHMgbG9hZGluZyBpdCBpZiBwb3NzaWJsZS5cclxuICAgICogQHBhcmFtIHtPYmplY3R8c3RyaW5nfSBpbWdTb3VyY2UgLSBpbWFnZSBzb3VyY2UuIEl0IG1heSBiZSBhbiBpbWcgZWxlbWVudCBvYmplY3Qgb3IgdGhlIGltZyB1cmwgc3RyaW5nLlxyXG4gICAgKiBAcGFyYW0ge3N0cmluZ30gW2FsaWFzXSAtIGltYWdlIGFsaWFzIHVzZWQgdG8gcmV0cmlldmUgcmVzb3VyY2UuIGlmIGltZ1NvdXJjZSBpcyBhIHN0cmluZyBhbmQgYWxpYXMgaXMgbm90IHNwZWNpZmllZCwgdGhlbiB0aGUgYWxpYXMgd2lsbCBiZSBzZXQgdG8gdGhlIGltZ1NvdXJjZS5cclxuICAgICogQHJldHVybiB7UHJvbWlzc2V9IC0gcHJvbWlzZSB0aGF0IGZ1bGxmaWxscyB3aGVuIHRoZSByZXNvdXJjZSBoYXMgbG9hZGVkLlxyXG4gICAgKi9cclxuICAgIGFkZEltYWdlKGltZ1NvdXJjZSwgYWxpYXMpIHtcclxuICAgICAgICBpZiggKHR5cGVvZiBpbWdTb3VyY2UgPT0gJ3N0cmluZycpICYmICFhbGlhcyApIHtcclxuICAgICAgICAgICAgYWxpYXMgPSBpbWdTb3VyY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBuZXdJbWFnZVJlc291cmNlID0gbmV3IEltYWdlUmVzb3VyY2UoKTtcclxuXHJcbiAgICAgICAgaWYoIWFsaWFzKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXNvdXJjZXMuYWRkSW1hZ2U6IGFsaWFzIG5vdCBzZXQgYW5kIHRodXMgdGhpcyBpbWFnZSB3aWxsIG5vdCBiZSBjYWNoZWQhJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZih0aGlzLmltYWdlQ2FjaGUuaGFzKGFsaWFzKSkge1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KGBSZXNvdXJjZXMuYWRkSW1hZ2U6IGltYWdlIGFsaWFzIFwiJHthbGlhc31cIiBpcyBhbHJlYWR5IGJlaW5nIHVzZWQgYW5kIHdpbGwgYmUgb3ZlcndyaXR0ZW4uYCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VDYWNoZS5zZXQoYWxpYXMsIG5ld0ltYWdlUmVzb3VyY2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld0ltYWdlUmVzb3VyY2Uuc2V0U291cmNlKGltZ1NvdXJjZSwgYWxpYXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiBAbWV0aG9kIGFkZEltYWdlcyAtIFNhbWUgYXMgYWRkSW1hZ2UgYnV0IGZvciBtdWx0cGxlIGltYWdlIHJlc291cmNlcy5cclxuICAgICogQHBhcmFtIHtBcnJheX0gc291cmNlcyAtIGVhY2ggZWxlbWVudCBzaG91bGQgYmUgYW4gYXJyYXkgdGhhdCBtYXRjaGVzIHRoZSBhcmd1bWVudHMgb2YgdGhlIGFkZEltYWdlIG1ldGhvZDogW2ltZ1NvdXJjZSwgYWxpYXNdLlxyXG4gICAgKiBAcmV0dXJuIHtQcm9taXNzZX0gLSBwcm9taXNlIHRoYXQgZnVsbGZpbGxzIHdoZW4gYWxsIHJlc291cmNlcyBoYXZlIGxvYWRlZC5cclxuICAgICovXHJcbiAgICBhZGRJbWFnZXMoc291cmNlcykge1xyXG4gICAgICAgIGlmKCEoc291cmNlcyBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZXNvdXJjZXMuYWRkSW1hZ2VzOiBhcmd1bWVudCBpcyBub3QgYW4gYXJyYXknKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHByb21pc2VzID0gW107XHJcblxyXG4gICAgICAgIGZvcihjb25zdCBlbnRyeSBvZiBzb3VyY2VzKSB7XHJcbiAgICAgICAgICAgIGlmKGVudHJ5IGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2godGhpcy5hZGRJbWFnZS5hcHBseSh0aGlzLCBlbnRyeSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaCh0aGlzLmFkZEltYWdlKGVudHJ5KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0T3JBZGRJbWFnZShpbWdTb3VyY2UsIGFsaWFzKSB7XHJcbiAgICAgICAgaWYoICh0eXBlb2YgaW1nU291cmNlID09ICdzdHJpbmcnKSAmJiAhYWxpYXMgKSB7XHJcbiAgICAgICAgICAgIGFsaWFzID0gaW1nU291cmNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbmV3SW1hZ2VSZXNvdXJjZSA9IG5ldyBJbWFnZVJlc291cmNlKCk7XHJcblxyXG4gICAgICAgIGlmKCFhbGlhcykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUmVzb3VyY2VzLmFkZEltYWdlOiBhbGlhcyBub3Qgc2V0IGFuZCB0aHVzIHRoaXMgaW1hZ2Ugd2lsbCBub3QgYmUgY2FjaGVkIScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmltYWdlQ2FjaGUuZ2V0KGFsaWFzKTtcclxuXHJcbiAgICAgICAgICAgIGlmKGNhY2hlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY2FjaGUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW1hZ2VDYWNoZS5zZXQoYWxpYXMsIG5ld0ltYWdlUmVzb3VyY2UpO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3SW1hZ2VSZXNvdXJjZS5zZXRTb3VyY2UoaW1nU291cmNlLCBhbGlhcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0T3JBZGRJbWFnZXMoc291cmNlcykge1xyXG4gICAgICAgIGlmKCEoc291cmNlcyBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZXNvdXJjZXMuYWRkSW1hZ2VzOiBhcmd1bWVudCBpcyBub3QgYW4gYXJyYXknKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHByb21pc2VzID0gW107XHJcblxyXG4gICAgICAgIGZvcihjb25zdCBlbnRyeSBvZiBzb3VyY2VzKSB7XHJcbiAgICAgICAgICAgIGlmKGVudHJ5IGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2godGhpcy5nZXRPckFkZEltYWdlLmFwcGx5KHRoaXMsIGVudHJ5KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMuZ2V0T3JBZGRJbWFnZShlbnRyeSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiBAbWV0aG9kIGdldEltYWdlIC0gcmV0dXJucyB0aGUgaW1nIGVsZW1lbnQgb2JqZWN0IHJlc3BlY3RpdmUgdG8gdGhlIGdpdmVuIGFsaWFzLlxyXG4gICAgKi9cclxuICAgIGdldEltYWdlKGFsaWFzKSB7XHJcbiAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmltYWdlQ2FjaGUuZ2V0KGFsaWFzKTtcclxuXHJcbiAgICAgICAgaWYoIWNhY2hlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Jlc291cmNlcy5nZXRJbWFnZTogY291bGQgbm90IGZpbmQgYWxpYXMgXCIke2FsaWFzfVwiJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY2FjaGU7XHJcbiAgICB9XHJcbn1cclxuIiwiY2xhc3MgVGlsZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihyb3csIGNvbHVtbiwgc3ByaXRlKSB7XHJcbiAgICAgICAgaWYoc3ByaXRlIGluc3RhbmNlb2YgSW1hZ2UpIHtcclxuICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBzcHJpdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoc3ByaXRlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RpbGUuY29uc3RydWN0b3I6IHNwcml0ZSBpcyBub3QgYSBJbWFnZSBvYmplY3QuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcm93ID0gTnVtYmVyKHJvdy50b0ZpeGVkKCkpO1xyXG4gICAgICAgIGNvbHVtbiA9IE51bWJlcihjb2x1bW4udG9GaXhlZCgpKTtcclxuXHJcbiAgICAgICAgaWYoICh0eXBlb2Ygcm93ID09ICdudW1iZXInKSAmJiAodHlwZW9mIGNvbHVtbiA9PSAnbnVtYmVyJykgKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm93ID0gcm93O1xyXG4gICAgICAgICAgICB0aGlzLmNvbHVtbiA9IGNvbHVtbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RpbGUuY29uc3RydWN0b3I6IHJvdyBhbmQgY29sdW1uIG11c3QgYmUgbnVtYmVycy4nKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmhpZ2hsaWdodGVkID0gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIFRlcnJhaW4ge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy50aWxlU2l6ZVggPSA2NDtcclxuICAgICAgICB0aGlzLnRpbGVTaXplWSA9IDY0O1xyXG5cclxuICAgICAgICB0aGlzLnRpbGVNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy50aWxlSGlnaGxpZ2h0TWFwID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0aWxlcygpIHtcclxuICAgICAgICByZXR1cm4gWy4uLnRoaXMudGlsZU1hcC52YWx1ZXMoKV07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHRpbGVTaXplKCkge1xyXG4gICAgICAgIHJldHVybiBbdGhpcy50aWxlU2l6ZVgsIHRoaXMudGlsZVNpemVZXTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdGlsZVNpemUodGlsZVNpemUpIHtcclxuICAgICAgICBpZiggKHRpbGVTaXplIGluc3RhbmNlb2YgQXJyYXkpICYmICh0aWxlU2l6ZS5sZW5ndGggPT0gMikgJiYgKHR5cGVvZiB0aWxlU2l6ZVswXSA9PSAnbnVtYmVyJykgJiYgKHR5cGVvZiB0aWxlU2l6ZVsxXSA9PSAnbnVtYmVyJykgKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGlsZVNpemVYID0gdGlsZVNpemVbMF07XHJcbiAgICAgICAgICAgIHRoaXMudGlsZVNpemVZID0gdGlsZVNpemVbMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzZXQgVGVycmFpbi50aWxlU2l6ZTogdGlsZVNpemUgaXMgbm90IGFuIGFycmF5IG9mIHNpemUgMiB0aGF0IGNvbnRhaW5zIG51bWJlcnMuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBzZXRUaWxlKHRpbGUpIHtcclxuICAgICAgICBpZighKHRpbGUgaW5zdGFuY2VvZiBUaWxlKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdUZXJyYWluLnNldFRpbGU6IHRpbGUgaXMgbm90IGEgVGlsZSBvYmplY3QuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRpbGVNYXAuc2V0KGAke3RpbGUucm93fXgke3RpbGUuY29sdW1ufWAsIHRpbGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRUaWxlcyh0aWxlcykge1xyXG4gICAgICAgIGlmKCEodGlsZXMgaW5zdGFuY2VvZiBBcnJheSkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignVGVycmFpbi5zZXRUaWxlczogdGlsZXMgaXMgbm90IGFuIEFycmF5LicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZm9yKGNvbnN0IHRpbGUgb2YgdGlsZXMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VGlsZSh0aWxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRUaWxlSGlnaGxpZ2h0KHJvdywgY29sdW1uLCBoaWdobGlnaHRlZCA9IHRydWUpIHtcclxuICAgICAgICBpZiggKHR5cGVvZiByb3cgPT0gJ251bWJlcicpICYmICh0eXBlb2YgY29sdW1uID09ICdudW1iZXInKSAmJiAodHlwZW9mIGhpZ2hsaWdodGVkID09ICdib29sZWFuJykgKSB7XHJcbiAgICAgICAgICAgIGxldCB0aWxlID0gdGhpcy50aWxlTWFwLmdldChgJHtyb3d9eCR7Y29sdW1ufWApO1xyXG4gICAgICAgICAgICBpZighdGlsZSkge1xyXG4gICAgICAgICAgICAgICAgdGlsZSA9IG5ldyBUaWxlKHJvdywgY29sdW1uKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VGlsZSh0aWxlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGlsZS5oaWdobGlnaHRlZCA9IGhpZ2hsaWdodGVkO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRpbGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdUZXJyYWluLnNldFRpbGVIaWdobGlnaHQ6IHJvdyBhbmQgY29sdW1uIG11c3QgYmUgbnVtYmVycyBhbmQgaGlnaGxpZ2h0ZWQgbXVzdCBiZSBhIGJvb2xlYW4uJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhcigpIHtcclxuICAgICAgICB0aGlzLnRpbGVNYXAuY2xlYXIoKTtcclxuICAgICAgICB0aGlzLnRpbGVIaWdobGlnaHRNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICB9XHJcbn1cclxuIl19
