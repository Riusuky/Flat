'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
* @class
*/
var Engine = function () {
    /**
    * @constructor
    */
    function Engine() {
        _classCallCheck(this, Engine);

        if (Engine.instance instanceof Engine) {
            console.error('Engine.constructor: Engine instance already exists.');
            return null;
        }

        Engine.instance = this;

        this.lastTime = Date.now();
        this.gameObjectSet = new Set();
        this.collisionCandidateSet = new Set();
        this.keyCallbackSet = new Set();
        this.mouseCallbackSet = new Set();

        document.addEventListener('keyup', this.handleKeyEvents.bind(this));
        document.addEventListener('keydown', this.handleKeyEvents.bind(this));
        document.addEventListener('keypress', this.handleKeyEvents.bind(this));

        if (!Render) {
            console.error('Engine.constructor: Render class is not defined.');
        } else if (!(Render.instance instanceof Render)) {
            console.error('Engine.constructor: There is no render instance to subscribre mouse events.');
        } else {
            this.render = Render.instance;

            this.render.canvas.addEventListener('mouseover', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('mousemove', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('mouseleave', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('mouseout', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('click', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('auxclick', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('mousedown', this.handleMouseEvents.bind(this));
            this.render.canvas.addEventListener('mouseup', this.handleMouseEvents.bind(this));
        }
    }

    _createClass(Engine, [{
        key: 'handleKeyEvents',
        value: function handleKeyEvents(event) {
            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = this.keyCallbackSet[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var callback = _step.value;

                    callback(event);
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }
        }
    }, {
        key: 'handleMouseEvents',
        value: function handleMouseEvents(event) {
            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
                for (var _iterator2 = this.mouseCallbackSet[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                    var callback = _step2.value;

                    callback(event);
                }
            } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                        _iterator2.return();
                    }
                } finally {
                    if (_didIteratorError2) {
                        throw _iteratorError2;
                    }
                }
            }
        }
    }, {
        key: 'start',
        value: function start() {
            requestAnimationFrame(this.routine.bind(this));
        }
    }, {
        key: 'routine',
        value: function routine() {
            var deltaTime = (this.currentTime - this.lastTime) / 1000;

            var _iteratorNormalCompletion3 = true;
            var _didIteratorError3 = false;
            var _iteratorError3 = undefined;

            try {
                for (var _iterator3 = this.gameObjectSet[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                    var gameObject = _step3.value;

                    gameObject.earlyUpdate(deltaTime);
                }
            } catch (err) {
                _didIteratorError3 = true;
                _iteratorError3 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion3 && _iterator3.return) {
                        _iterator3.return();
                    }
                } finally {
                    if (_didIteratorError3) {
                        throw _iteratorError3;
                    }
                }
            }

            this.checkForCollisions();

            var _iteratorNormalCompletion4 = true;
            var _didIteratorError4 = false;
            var _iteratorError4 = undefined;

            try {
                for (var _iterator4 = this.gameObjectSet[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
                    var _gameObject = _step4.value;

                    _gameObject.lateUpdate(deltaTime);
                }
            } catch (err) {
                _didIteratorError4 = true;
                _iteratorError4 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion4 && _iterator4.return) {
                        _iterator4.return();
                    }
                } finally {
                    if (_didIteratorError4) {
                        throw _iteratorError4;
                    }
                }
            }

            this.render.render();

            this.lastTime = this.currentTime;

            requestAnimationFrame(this.routine.bind(this));
        }
    }, {
        key: 'checkForCollisions',
        value: function checkForCollisions() {
            var gameObjects = [].concat(_toConsumableArray(this.collisionCandidateSet));

            var _iteratorNormalCompletion5 = true;
            var _didIteratorError5 = false;
            var _iteratorError5 = undefined;

            try {
                for (var _iterator5 = _.filter(gameObjects, 'dynamic')[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
                    var dynamicObject = _step5.value;
                    var _iteratorNormalCompletion6 = true;
                    var _didIteratorError6 = false;
                    var _iteratorError6 = undefined;

                    try {
                        for (var _iterator6 = gameObjects[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
                            var gameObject = _step6.value;

                            if (gameObject != dynamicObject) {
                                dynamicObject.onCollisionCheck(gameObject);
                            }
                        }
                    } catch (err) {
                        _didIteratorError6 = true;
                        _iteratorError6 = err;
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion6 && _iterator6.return) {
                                _iterator6.return();
                            }
                        } finally {
                            if (_didIteratorError6) {
                                throw _iteratorError6;
                            }
                        }
                    }
                }
            } catch (err) {
                _didIteratorError5 = true;
                _iteratorError5 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion5 && _iterator5.return) {
                        _iterator5.return();
                    }
                } finally {
                    if (_didIteratorError5) {
                        throw _iteratorError5;
                    }
                }
            }
        }

        /**
        * @callback routineCallback
        * @param {number} deltaTime - time since the callback was last called.
        */

        /**
        * @method registerUpdateCallback - add a callback to be invoked by the engine.
        * @param {routineCallback} callback
        */

    }, {
        key: 'registerUpdateCallback',
        value: function registerUpdateCallback(gameObject) {
            var registerCollisionCheck = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

            if (!GameObject) {
                console.error('Engine.registerUpdateCallback: GameObject class is not defined.');
            } else if (!(gameObject instanceof GameObject)) {
                console.error('Engine.registerUpdateCallback: gameObject is not an instance of GameObject.');
            } else {
                this.gameObjectSet.add(gameObject);

                if (registerCollisionCheck) {
                    this.collisionCandidateSet.add(gameObject);
                }
            }
        }
    }, {
        key: 'registerCollisionCandidate',
        value: function registerCollisionCandidate(gameObject) {
            if (!GameObject) {
                console.error('Engine.registerUpdateCallback: GameObject class is not defined.');
            } else if (!(gameObject instanceof GameObject)) {
                console.error('Engine.registerUpdateCallback: gameObject is not an instance of GameObject.');
            } else {
                this.collisionCandidateSet.add(gameObject);
            }
        }
    }, {
        key: 'registerKeyEventCallback',
        value: function registerKeyEventCallback(callback) {
            if (typeof callback == 'function') {
                this.keyCallbackSet.add(callback);
            } else {
                console.error('Engine.registerKeyEventCallback: callback is not set as a function.');
            }
        }
    }, {
        key: 'registerMouseEventCallback',
        value: function registerMouseEventCallback(callback) {
            if (typeof callback == 'function') {
                this.mouseCallbackSet.add(callback);
            } else {
                console.error('Engine.registerMouseEventCallback: callback is not set as a function.');
            }
        }
    }, {
        key: 'currentTime',
        get: function get() {
            return Date.now();
        }
    }]);

    return Engine;
}();
"use strict";

var flat = {};
'use strict';

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
* @class
*/
var ImageObject = function () {
    /**
    * @constructor
    */
    function ImageObject(sprite) {
        var subscribeToRender = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

        _classCallCheck(this, ImageObject);

        if (sprite) {
            this.setSprite(sprite);
        }

        this.pivotX = 0.5;
        this.pivotY = 0.5;

        this.x = 0;
        this.y = 0;

        this.originalsizeX = this.originalsizeX || 0;
        this.originalsizeY = this.originalsizeY || 0;

        this.scaleX = 1;
        this.scaleY = 1;

        this.layer = 0;

        this.visible = true;

        if (!Render) {
            console.error('ImageObject.constructor: Render class is not defined.');
        } else if (!(Render.instance instanceof Render)) {
            console.error('ImageObject.constructor: There is no render instance to subscribre to.');
        } else {
            this.render = Render.instance;
            if (subscribeToRender) {
                this.subscribeToRender();
            }
        }
    }

    _createClass(ImageObject, [{
        key: 'mayRender',
        value: function mayRender() {
            return this.sprite instanceof Image && this.visible;
        }
    }, {
        key: 'setSprite',
        value: function setSprite(sprite) {
            var adjustSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

            if (sprite instanceof Image) {
                this.sprite = sprite;

                if (adjustSize) {
                    this.originalsizeX = sprite.naturalWidth;
                    this.originalsizeY = sprite.naturalHeight;
                }
            } else if (sprite) {
                console.error('GameObject.constructor: sprite is not set as a Image object.');
            } else {
                this.sprite = null;
            }
        }
    }, {
        key: 'subscribeToRender',
        value: function subscribeToRender() {
            this.render.registerObject(this);
        }
    }, {
        key: 'unsubscribeToRender',
        value: function unsubscribeToRender() {
            this.render.unregisterObject(this);
        }
    }, {
        key: 'createCopy',
        value: function createCopy() {
            var newCopy = new ImageObject(this.sprite, false);

            this.copyPropertiesTo(newCopy);

            return newCopy;
        }
    }, {
        key: 'copyPropertiesTo',
        value: function copyPropertiesTo(targetImageObject) {
            if (targetImageObject instanceof ImageObject) {
                targetImageObject.sprite = this.sprite;

                targetImageObject.pivot = [this.pivotX, this.pivotY];
                targetImageObject.position = [this.x, this.y];

                targetImageObject.originalsize = [this.originalsizeX, this.originalsizeY];

                targetImageObject.scale = [this.scaleX, this.scaleY];

                targetImageObject.layer = this.layer;
            } else {
                console.error('ImageObject.copyPropertiesTo: targetImageObject is not a ImageObject instance.');
            }
        }
    }, {
        key: 'pivot',
        get: function get() {
            return [this.pivotX, this.pivotY];
        },
        set: function set(pivot) {
            if (pivot instanceof Array && pivot.length == 2 && typeof pivot[0] == 'number' && typeof pivot[1] == 'number') {
                this.pivotX = pivot[0];
                this.pivotY = pivot[1];
            } else {
                console.error('set ImageObject.pivot: pivot is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'position',
        get: function get() {
            return [this.x, this.y];
        },
        set: function set(position) {
            if (position instanceof Array && position.length == 2 && typeof position[0] == 'number' && typeof position[1] == 'number') {
                this.x = position[0];
                this.y = position[1];
            } else {
                console.error('set ImageObject.position: position is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'sizeX',
        get: function get() {
            return this.originalsizeX * this.scaleX;
        }
    }, {
        key: 'sizeY',
        get: function get() {
            return this.originalsizeY * this.scaleY;
        }
    }, {
        key: 'size',
        get: function get() {
            return [this.originalsizeX * this.scaleX, this.originalsizeY * this.scaleY];
        }
    }, {
        key: 'originalsize',
        get: function get() {
            return [this.originalsizeX, this.originalsizeY];
        },
        set: function set(originalsize) {
            if (originalsize instanceof Array && originalsize.length == 2 && typeof originalsize[0] == 'number' && typeof originalsize[1] == 'number') {
                this.originalsizeX = originalsize[0];
                this.originalsizeY = originalsize[1];
            } else {
                console.error('set ImageObject.originalsize: originalsize is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'scale',
        get: function get() {
            return [this.scaleX, this.scaleY];
        },
        set: function set(scale) {
            if (scale instanceof Array && scale.length == 2 && typeof scale[0] == 'number' && typeof scale[1] == 'number') {
                this.scaleX = scale[0];
                this.scaleY = scale[1];
            } else if (typeof scale == 'number') {
                this.scaleX = scale;
                this.scaleY = scale;
            } else {
                console.error('set ImageObject.scale: scale is not an array of size 2 that contains numbers or simply a number.');
            }
        }
    }]);

    return ImageObject;
}();

/**
* @class
*/


var GameObject = function (_ImageObject) {
    _inherits(GameObject, _ImageObject);

    /**
    * @constructor
    */
    function GameObject(sprite) {
        var subscribeToRender = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
        var subscribreToEngine = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

        _classCallCheck(this, GameObject);

        var _this = _possibleConstructorReturn(this, (GameObject.__proto__ || Object.getPrototypeOf(GameObject)).call(this, sprite, subscribeToRender));

        _this.vx = 0;
        _this.vy = 0;

        _this.originalBorderWidth = _this.originalsizeX || 64;
        _this.originalBorderHeight = _this.originalsizeY || 64;

        _this.walkable = false;
        _this.dynamic = false;

        _this.step = [0, 0];

        if (!Engine) {
            console.error('GameObject.constructor: Engine class is not defined.');
        } else if (!(Engine.instance instanceof Engine)) {
            console.error('GameObject.constructor: There is no Engine instance to subscribre to.');
        } else {
            _this.engine = Engine.instance;

            if (subscribreToEngine) {
                _this.engine.registerCollisionCandidate(_this);
            }
        }
        return _this;
    }

    _createClass(GameObject, [{
        key: 'earlyUpdate',
        value: function earlyUpdate(deltaTime) {
            this.step[0] = this.vx * deltaTime;
            this.step[1] = this.vy * deltaTime;
        }
    }, {
        key: 'lateUpdate',
        value: function lateUpdate() {
            this.x += this.step[0];
            this.y += this.step[1];
        }
    }, {
        key: 'hasCollided',
        value: function hasCollided(otherBorder) {
            var myBorder = this.border;

            return Math.min(myBorder.right, otherBorder.right) - Math.max(myBorder.left, otherBorder.left) >= 0 && Math.min(myBorder.top, otherBorder.top) - Math.max(myBorder.bottom, otherBorder.bottom) >= 0;
        }
    }, {
        key: 'onCollision',
        value: function onCollision(otherGameObject) {}
    }, {
        key: 'createCopy',
        value: function createCopy() {
            var newCopy = new GameObject(this.sprite, false);

            this.copyPropertiesTo(newCopy);

            return newCopy;
        }
    }, {
        key: 'copyPropertiesTo',
        value: function copyPropertiesTo(targetGameObject) {
            if (targetGameObject instanceof GameObject) {
                _get(GameObject.prototype.__proto__ || Object.getPrototypeOf(GameObject.prototype), 'copyPropertiesTo', this).call(this, targetGameObject);

                targetGameObject.vx = this.vx;
                targetGameObject.vy = this.vy;

                targetGameObject.originalBorderWidth = this.originalBorderWidth;
                targetGameObject.originalBorderHeight = this.originalBorderHeight;
            } else {
                console.error('GameObject.copyPropertiesTo: targetGameObject is not a GameObject instance.');
            }
        }
    }, {
        key: 'borderWidth',
        get: function get() {
            return this.originalBorderWidth * this.scaleX;
        }
    }, {
        key: 'borderHeight',
        get: function get() {
            return this.originalBorderHeight * this.scaleY;
        }
    }, {
        key: 'originalBorder',
        get: function get() {
            return [this.originalBorderWidth, this.originalBorderHeight];
        },
        set: function set(originalBorder) {
            if (originalBorder instanceof Array && originalBorder.length == 2 && typeof originalBorder[0] == 'number' && typeof originalBorder[1] == 'number') {
                this.originalBorderWidth = originalBorder[0];
                this.originalBorderHeight = originalBorder[1];
            } else {
                console.error('set ImageObject.originalBorder: originalBorder is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'border',
        get: function get() {
            var borderRadius = [+0.5 * this.originalBorderWidth * this.scaleX, 0.5 * this.originalBorderHeight * this.scaleY];

            return {
                top: this.y + borderRadius[1],
                right: this.x + borderRadius[0],
                bottom: this.y - borderRadius[1],
                left: this.x - borderRadius[0]
            };
        }
    }]);

    return GameObject;
}(ImageObject);

/**
* @class
*/


var Player = function (_GameObject) {
    _inherits(Player, _GameObject);

    /**
    * @constructor
    */
    function Player(sprite) {
        var subscribeToEngine = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
        var subscribeToRender = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
        var upKeys = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [87, 38];
        var rightKeys = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [68, 39];
        var downKeys = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : [83, 40];
        var leftKeys = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : [65, 37];

        _classCallCheck(this, Player);

        var _this2 = _possibleConstructorReturn(this, (Player.__proto__ || Object.getPrototypeOf(Player)).call(this, sprite, subscribeToRender, subscribeToEngine));

        _this2.keyMap = new Map();

        _this2.setKeyMap(upKeys, 'up');
        _this2.setKeyMap(rightKeys, 'right');
        _this2.setKeyMap(downKeys, 'down');
        _this2.setKeyMap(leftKeys, 'left');

        _this2.lastAction = 'none';

        _this2.moveSpeed = 200;

        _this2.walkable = true;
        _this2.dynamic = true;

        if (!Engine) {
            console.error('Player.constructor: Engine class is not defined.');
        } else if (!(Engine.instance instanceof Engine)) {
            console.error('Player.constructor: There is no Engine instance to subscribre to.');
        } else {
            _this2.engine = Engine.instance;
            if (subscribeToEngine) {
                _this2.subscribeToEngine();
            }
        }
        return _this2;
    }

    _createClass(Player, [{
        key: 'setKeyMap',
        value: function setKeyMap(keys, action) {
            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = keys[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var key = _step.value;

                    this.keyMap.set(key, action);
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }
        }
    }, {
        key: 'subscribeToEngine',
        value: function subscribeToEngine() {
            this.engine.registerKeyEventCallback(this.handleKeyEvents.bind(this));
            this.engine.registerUpdateCallback(this);
        }
    }, {
        key: 'handleKeyEvents',
        value: function handleKeyEvents(event) {
            if (event.keyCode && this.keyMap.has(event.keyCode)) {
                var action = this.keyMap.get(event.keyCode);

                if (event.type == 'keyup') {
                    action += 'Cancel';
                }

                this.performAction(action);
            }
        }
    }, {
        key: 'onCollisionCheck',
        value: function onCollisionCheck(otherGameObject) {
            if (!otherGameObject.walkable) {
                var myBorder = void 0;
                var targetBorder = otherGameObject.border;

                if (this.step[0] != 0) {
                    myBorder = this.border;
                    myBorder.left += this.step[0];
                    myBorder.right += this.step[0];

                    if (otherGameObject.hasCollided(myBorder)) {
                        if (this.step[0] > 0) {
                            this.step[0] += targetBorder.left - myBorder.right - 1;
                        } else {
                            this.step[0] += targetBorder.right - myBorder.left + 1;
                        }
                    }
                }

                if (this.step[1] != 0) {
                    myBorder = this.border;
                    myBorder.top += this.step[1];
                    myBorder.bottom += this.step[1];

                    if (otherGameObject.hasCollided(myBorder)) {
                        if (this.step[1] > 0) {
                            this.step[1] += targetBorder.bottom - myBorder.top - 1;
                        } else {
                            this.step[1] += targetBorder.top - myBorder.bottom + 1;
                        }
                    }
                }
            }
        }
    }, {
        key: 'performAction',
        value: function performAction() {
            var action = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'none';

            if (this.lastAction != action) {
                switch (action) {
                    case 'up':
                        this.vy = this.moveSpeed;
                        break;
                    case 'upCancel':
                        if (this.vy > 0) {
                            this.vy = 0;
                        }
                        break;
                    case 'right':
                        this.vx = this.moveSpeed;
                        break;
                    case 'rightCancel':
                        if (this.vx > 0) {
                            this.vx = 0;
                        }
                        break;
                    case 'down':
                        this.vy = -this.moveSpeed;
                        break;
                    case 'downCancel':
                        if (this.vy < 0) {
                            this.vy = 0;
                        }
                        break;
                    case 'left':
                        this.vx = -this.moveSpeed;
                        break;
                    case 'leftCancel':
                        if (this.vx < 0) {
                            this.vx = 0;
                        }
                        break;
                    case 'none':
                        break;
                    default:
                }

                this.lastAction = action;
            }
        }
    }]);

    return Player;
}(GameObject);
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Render = function () {
    function Render(canvas) {
        _classCallCheck(this, Render);

        if (Render.instance instanceof Render) {
            console.error('Render.constructor: Render instance already exists.');
            return null;
        }

        if (!(canvas instanceof HTMLCanvasElement)) {
            console.error("Render.constructor: given canvas object is not an HTMLCanvasElement.");
            return null;
        }

        Render.instance = this;

        this.canvas = canvas;
        this.context2D = this.canvas.getContext('2d');

        this.updateCanvasSize();

        window.addEventListener('resize', this.updateCanvasSize);

        // Coordinate sytem. Axis orientation will be: X->right , Y->up
        this.originX = 0.5;
        this.originY = 0.5;

        this.coordOffsetX = 0;
        this.coordOffsetY = 0;

        this.objectSet = new Set();

        this.drawTileGrid = false;
        this.drawBorders = false;
        this.drawTileHighlight = false;
    }

    _createClass(Render, [{
        key: 'canvasPositionToRenderCoordinates',
        value: function canvasPositionToRenderCoordinates(position) {
            if (position instanceof Array && position.length == 2 && typeof position[0] == 'number' && typeof position[1] == 'number') {
                var realOrigin = this.realOrigin;

                return [position[0] - realOrigin[0], realOrigin[1] - position[1]];
            } else {
                console.error('set Render.canvasPositionToRenderCoordinates: position is not an array of size 2 that contains numbers.');
                return null;
            }
        }
    }, {
        key: 'mousePositionToCanvasRelativePosition',
        value: function mousePositionToCanvasRelativePosition(mousePosition) {
            var canvasRect = this.canvas.getBoundingClientRect();

            return [mousePosition[0] - canvasRect.left, mousePosition[1] - canvasRect.top];
        }
    }, {
        key: 'mousePositionToRenderCoordinates',
        value: function mousePositionToRenderCoordinates(mousePosition) {
            return this.canvasPositionToRenderCoordinates(this.mousePositionToCanvasRelativePosition(mousePosition));
        }
    }, {
        key: 'mousePositionToTileCoordinates',
        value: function mousePositionToTileCoordinates(mousePosition) {
            if (!Terrain) {
                console.error('Render.mousePositionToTileCoordinates: Terrain class is not defined.');
            } else if (!(this.terrain instanceof Terrain)) {
                console.error('Render.mousePositionToTileCoordinates: terrain is not set.');
            } else {
                var realOrigin = this.realOrigin;
                var relativeCanvasPosition = this.mousePositionToCanvasRelativePosition(mousePosition);

                var coordinates = [0.5 + (relativeCanvasPosition[0] - realOrigin[0]) / this.terrain.tileSizeX, -0.5 + (realOrigin[1] - relativeCanvasPosition[1]) / this.terrain.tileSizeY];

                return [Math.floor(coordinates[0]), Math.ceil(coordinates[1])];
            }
        }
    }, {
        key: 'updateCanvasSize',
        value: function updateCanvasSize() {
            var containerStyle = window.getComputedStyle(this.canvas.parentElement);

            this.canvas.width = parseFloat(containerStyle.width) - parseFloat(containerStyle.paddingLeft) - parseFloat(containerStyle.paddingRight) - parseFloat(containerStyle.borderLeftWidth) - parseFloat(containerStyle.borderRightWidth);
            this.canvas.height = parseFloat(containerStyle.height) - parseFloat(containerStyle.paddingTop) - parseFloat(containerStyle.paddingBottom) - parseFloat(containerStyle.borderTopWidth) - parseFloat(containerStyle.borderBottomWidth);
        }
    }, {
        key: 'registerObject',
        value: function registerObject(imageObject) {
            if (!ImageObject) {
                console.error('Render.registerObject: ImageObject class is not defined.');
            } else if (!(imageObject instanceof ImageObject)) {
                console.error('Render.registerObject: imageObject is not a ImageObject object.');
            } else {
                this.objectSet.add(imageObject);
            }
        }
    }, {
        key: 'unregisterObject',
        value: function unregisterObject(imageObject) {
            if (!ImageObject) {
                console.error('Render.registerObject: ImageObject class is not defined.');
            } else if (!(imageObject instanceof ImageObject)) {
                console.error('Render.registerObject: imageObject is not a ImageObject object.');
            } else {
                this.objectSet.delete(imageObject);
            }
        }
    }, {
        key: 'setTerrain',
        value: function setTerrain(terrain) {
            if (!Terrain) {
                console.error('Render.setTerrain: Terrain class is not defined.');
            } else if (!(terrain instanceof Terrain)) {
                console.error('Render.setTerrain: terrain is not a Terrain object.');
            } else {
                this.terrain = terrain;
            }
        }
    }, {
        key: 'render',
        value: function render() {
            this.context2D.clearRect(0, 0, this.canvas.width, this.canvas.height);

            this.renderTerrain();

            if (this.drawTileGrid) {
                this.renderTileGrid();
            }

            this.renderObjects();
        }
    }, {
        key: 'renderTerrain',
        value: function renderTerrain() {
            var realOrigin = this.realOrigin;

            this.context2D.fillStyle = 'rgba(255, 255, 255, 0.4)';

            if (this.terrain) {
                var _iteratorNormalCompletion = true;
                var _didIteratorError = false;
                var _iteratorError = undefined;

                try {
                    for (var _iterator = this.terrain.tiles[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                        var tile = _step.value;

                        var tilePosition = [(realOrigin[0] + (tile.row - 0.5) * this.terrain.tileSizeX).toFixed(), (realOrigin[1] - (tile.column + 0.5) * this.terrain.tileSizeY).toFixed()];

                        if (tile.sprite) {
                            this.context2D.drawImage(tile.sprite, tilePosition[0], tilePosition[1], this.terrain.tileSizeX.toFixed(), this.terrain.tileSizeY.toFixed());
                        }

                        if (this.drawTileHighlight && tile.highlighted) {
                            this.context2D.fillRect(tilePosition[0], tilePosition[1], this.terrain.tileSizeX.toFixed(), this.terrain.tileSizeY.toFixed());
                        }
                    }
                } catch (err) {
                    _didIteratorError = true;
                    _iteratorError = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion && _iterator.return) {
                            _iterator.return();
                        }
                    } finally {
                        if (_didIteratorError) {
                            throw _iteratorError;
                        }
                    }
                }
            }
        }
    }, {
        key: 'renderObjects',
        value: function renderObjects() {
            var realOrigin = this.realOrigin;

            var objectSize = void 0,
                objectBorder = void 0;

            this.context2D.strokeStyle = 'purple';
            this.context2D.lineWidth = 2;

            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
                for (var _iterator2 = _.chain([].concat(_toConsumableArray(this.objectSet))).sortBy('y').reverse().sortBy('layer').value()[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                    var objectToRender = _step2.value;

                    if (objectToRender.mayRender()) {
                        objectSize = objectToRender.size;
                        this.context2D.drawImage(objectToRender.sprite, (realOrigin[0] + objectToRender.x - objectToRender.pivotX * objectSize[0]).toFixed(), (realOrigin[1] - (objectToRender.y + (1 - objectToRender.pivotY) * objectSize[1])).toFixed(), objectSize[0].toFixed(), objectSize[1].toFixed());

                        if (this.drawBorders) {
                            if (!GameObject) {
                                console.error('Render.renderObjects: GameObject class not defined.');
                            } else if (objectToRender instanceof GameObject) {
                                objectBorder = objectToRender.border;
                                this.context2D.strokeRect(realOrigin[0] + objectBorder.left, realOrigin[1] - objectBorder.top, objectToRender.borderWidth, objectToRender.borderHeight);
                            }
                        }
                    }
                }
            } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                        _iterator2.return();
                    }
                } finally {
                    if (_didIteratorError2) {
                        throw _iteratorError2;
                    }
                }
            }
        }
    }, {
        key: 'renderTileGrid',
        value: function renderTileGrid() {
            if (this.terrain) {
                this.context2D.strokeStyle = 'white';
                this.context2D.lineWidth = 1;

                var realOrigin = this.realOrigin;

                var minX = Math.ceil(0.5 - realOrigin[0] / this.terrain.tileSizeX);
                var maxX = Math.floor(0.5 + (this.canvas.width - realOrigin[0]) / this.terrain.tileSizeX);

                var minY = Math.ceil(-0.5 + (realOrigin[1] - this.canvas.height) / this.terrain.tileSizeY);
                var maxY = Math.floor(-0.5 + realOrigin[1] / this.terrain.tileSizeY);

                this.context2D.beginPath();

                var loackedPosition = 0;

                for (var i = minX; i <= maxX; i++) {
                    loackedPosition = (realOrigin[0] + (i - 0.5) * this.terrain.tileSizeX).toFixed();
                    this.context2D.moveTo(loackedPosition, 0);
                    this.context2D.lineTo(loackedPosition, this.canvas.height);
                }

                for (var j = minY; j <= maxY; j++) {
                    loackedPosition = (realOrigin[1] - (j + 0.5) * this.terrain.tileSizeY).toFixed();
                    this.context2D.moveTo(0, loackedPosition);
                    this.context2D.lineTo(this.canvas.width, loackedPosition);
                }

                this.context2D.stroke();
            }
        }
    }, {
        key: 'origin',
        get: function get() {
            return [this.originX, this.originY];
        },
        set: function set(origin) {
            if (origin instanceof Array && origin.length == 2 && typeof origin[0] == 'number' && typeof origin[1] == 'number') {
                this.originX = origin[0];
                this.originY = origin[1];
            } else {
                console.error('set Render.origin: origin is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'coordOffset',
        get: function get() {
            return [this.coordOffsetX, this.coordOffsetY];
        },
        set: function set(coordOffset) {
            if (coordOffset instanceof Array && coordOffset.length == 2 && typeof coordOffset[0] == 'number' && typeof coordOffset[1] == 'number') {
                this.coordOffsetX = coordOffset[0].toFixed();
                this.coordOffsetY = coordOffset[1].toFixed();
            } else {
                console.error('set Render.coordOffset: coordOffset is not an array of size 2 that contains numbers.');
            }
        }
    }, {
        key: 'realOrigin',
        get: function get() {
            return [this.originX * this.canvas.width + this.coordOffsetX, (1 - this.originY) * this.canvas.height - this.coordOffsetY];
        }
    }]);

    return Render;
}();
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var ImageResourceStatus = {
    INITIATING: 'Initiating',
    FAILED: 'Failed',
    LOADING: 'Loading',
    LOADED: 'Loaded'
};

var ImageResource = function () {
    function ImageResource() {
        _classCallCheck(this, ImageResource);

        this.progress = 0;
        this.status = ImageResourceStatus.INITIATING;
        this.onLoad = null;
        this.onProgress = null;
        this.onStatusChanged = null;
    }

    _createClass(ImageResource, [{
        key: 'setProgress',
        value: function setProgress(progress) {
            this.progress = progress;

            console.log('ImageResource.setProgress: ' + progress);

            if (this.onProgress) {
                this.onProgress(this.progress);
            }
        }
    }, {
        key: 'setStatus',
        value: function setStatus(status) {
            this.status = status;

            if (this.onStatusChanged) {
                this.onStatusChanged(this.status);
            }

            switch (this.status) {
                case ImageResourceStatus.INITIATING:
                    break;

                case ImageResourceStatus.FAILED:
                    break;

                case ImageResourceStatus.LOADING:
                    break;

                case ImageResourceStatus.LOADED:
                    this.setProgress(1);
                    if (this.onLoad) {
                        this.onLoad();
                    }
                    break;

                default:
            }
        }
    }, {
        key: 'setTriggers',
        value: function setTriggers() {
            var _this = this;

            if (this.img) {
                this.promise = new Promise(function (resolve, reject) {
                    _this.img.onloadstart = function () {
                        _this.setStatus(ImageResourceStatus.LOADING);
                    };
                    _this.img.onprogress = function (progress) {
                        _this.progress = _this.setProgress(progress);
                    };
                    _this.img.onload = function () {
                        _this.setStatus(ImageResourceStatus.LOADED);
                        resolve(_this);
                    };
                    _this.img.onerror = function (error) {
                        _this.setStatus(ImageResourceStatus.FAILED);
                        reject(error);
                    };
                });
            }
        }
    }, {
        key: 'setSource',
        value: function setSource(source, alias) {
            var _this2 = this;

            if (source) {
                if (source instanceof Image) {
                    if (source.src) {
                        if (alias) {
                            this.alias = alias;
                        }

                        this.imageSrc = source.src;
                        this.img = source;

                        if (source.complete) {
                            this.setStatus(ImageResourceStatus.LOADED);

                            return new Promise(function (resolve, reject) {
                                resolve(_this2);
                            });
                        } else {
                            this.setTriggers();
                        }
                    } else {
                        console.error('ImageResource requires a proper source.');
                    }
                } else if (typeof source == 'string') {
                    if (alias) {
                        this.alias = alias;
                    }

                    this.imageSrc = source;
                    this.img = new Image();

                    this.setTriggers();

                    this.img.src = source;
                }

                return this.promise;
            } else {
                console.error('ImageResource requires a proper source.');
            }
        }
    }, {
        key: 'loaded',
        get: function get() {
            return this.status == ImageResourceStatus.LOADED;
        }
    }], [{
        key: 'IMAGE_STATUS',
        get: function get() {
            return ImageResourceStatus;
        }
    }]);

    return ImageResource;
}();

var Resources = function () {
    function Resources() {
        _classCallCheck(this, Resources);

        this.imageCache = new Map();
    }

    /**
    * @method addImage - Add an image resource and starts loading it if possible.
    * @param {Object|string} imgSource - image source. It may be an img element object or the img url string.
    * @param {string} [alias] - image alias used to retrieve resource. if imgSource is a string and alias is not specified, then the alias will be set to the imgSource.
    * @return {Promisse} - promise that fullfills when the resource has loaded.
    */


    _createClass(Resources, [{
        key: 'addImage',
        value: function addImage(imgSource, alias) {
            if (typeof imgSource == 'string' && !alias) {
                alias = imgSource;
            }

            var newImageResource = new ImageResource();

            if (!alias) {
                console.log('Resources.addImage: alias not set and thus this image will not be cached!');
            } else {
                if (this.imageCache.has(alias)) {
                    window.alert('Resources.addImage: image alias "' + alias + '" is already being used and will be overwritten.');
                }

                this.imageCache.set(alias, newImageResource);
            }

            return newImageResource.setSource(imgSource, alias);
        }

        /**
        * @method addImages - Same as addImage but for multple image resources.
        * @param {Array} sources - each element should be an array that matches the arguments of the addImage method: [imgSource, alias].
        * @return {Promisse} - promise that fullfills when all resources have loaded.
        */

    }, {
        key: 'addImages',
        value: function addImages(sources) {
            if (!(sources instanceof Array)) {
                console.error('Resources.addImages: argument is not an array');

                return;
            }

            var promises = [];

            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = sources[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var entry = _step.value;

                    if (entry instanceof Array) {
                        promises.push(this.addImage.apply(this, entry));
                    } else {
                        promises.push(this.addImage(entry));
                    }
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }

            return Promise.all(promises);
        }
    }, {
        key: 'getOrAddImage',
        value: function getOrAddImage(imgSource, alias) {
            if (typeof imgSource == 'string' && !alias) {
                alias = imgSource;
            }

            var newImageResource = new ImageResource();

            if (!alias) {
                console.log('Resources.addImage: alias not set and thus this image will not be cached!');
            } else {
                var cache = this.imageCache.get(alias);

                if (cache) {
                    return new Promise(function (resolve, reject) {
                        resolve(cache);
                    });
                }
            }

            this.imageCache.set(alias, newImageResource);

            return newImageResource.setSource(imgSource, alias);
        }
    }, {
        key: 'getOrAddImages',
        value: function getOrAddImages(sources) {
            if (!(sources instanceof Array)) {
                console.error('Resources.addImages: argument is not an array');

                return;
            }

            var promises = [];

            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
                for (var _iterator2 = sources[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                    var entry = _step2.value;

                    if (entry instanceof Array) {
                        promises.push(this.getOrAddImage.apply(this, entry));
                    } else {
                        promises.push(this.getOrAddImage(entry));
                    }
                }
            } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                        _iterator2.return();
                    }
                } finally {
                    if (_didIteratorError2) {
                        throw _iteratorError2;
                    }
                }
            }

            return Promise.all(promises);
        }

        /**
        * @method getImage - returns the img element object respective to the given alias.
        */

    }, {
        key: 'getImage',
        value: function getImage(alias) {
            var cache = this.imageCache.get(alias);

            if (!cache) {
                console.error('Resources.getImage: could not find alias "${alias}"');
            }

            return cache;
        }
    }]);

    return Resources;
}();
'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Tile = function Tile(row, column, sprite) {
    _classCallCheck(this, Tile);

    if (sprite instanceof Image) {
        this.sprite = sprite;
    } else if (sprite) {
        console.error('Tile.constructor: sprite is not a Image object.');
        return null;
    }

    row = Number(row.toFixed());
    column = Number(column.toFixed());

    if (typeof row == 'number' && typeof column == 'number') {
        this.row = row;
        this.column = column;
    } else {
        console.error('Tile.constructor: row and column must be numbers.');
        return null;
    }

    this.highlighted = false;
};

var Terrain = function () {
    function Terrain() {
        _classCallCheck(this, Terrain);

        this.tileSizeX = 64;
        this.tileSizeY = 64;

        this.tileMap = new Map();
        this.tileHighlightMap = new Map();
    }

    _createClass(Terrain, [{
        key: 'setTile',
        value: function setTile(tile) {
            if (!(tile instanceof Tile)) {
                console.error('Terrain.setTile: tile is not a Tile object.');
            } else {
                this.tileMap.set(tile.row + 'x' + tile.column, tile);
            }
        }
    }, {
        key: 'setTiles',
        value: function setTiles(tiles) {
            if (!(tiles instanceof Array)) {
                console.error('Terrain.setTiles: tiles is not an Array.');
            } else {
                var _iteratorNormalCompletion = true;
                var _didIteratorError = false;
                var _iteratorError = undefined;

                try {
                    for (var _iterator = tiles[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                        var tile = _step.value;

                        this.setTile(tile);
                    }
                } catch (err) {
                    _didIteratorError = true;
                    _iteratorError = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion && _iterator.return) {
                            _iterator.return();
                        }
                    } finally {
                        if (_didIteratorError) {
                            throw _iteratorError;
                        }
                    }
                }
            }
        }
    }, {
        key: 'setTileHighlight',
        value: function setTileHighlight(row, column) {
            var highlighted = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

            if (typeof row == 'number' && typeof column == 'number' && typeof highlighted == 'boolean') {
                var tile = this.tileMap.get(row + 'x' + column);
                if (!tile) {
                    tile = new Tile(row, column);
                    this.setTile(tile);
                }

                tile.highlighted = highlighted;

                return tile;
            } else {
                console.error('Terrain.setTileHighlight: row and column must be numbers and highlighted must be a boolean.');
            }

            return null;
        }
    }, {
        key: 'clear',
        value: function clear() {
            this.tileMap.clear();
            this.tileHighlightMap = new Map();
        }
    }, {
        key: 'tiles',
        get: function get() {
            return [].concat(_toConsumableArray(this.tileMap.values()));
        }
    }, {
        key: 'tileSize',
        get: function get() {
            return [this.tileSizeX, this.tileSizeY];
        },
        set: function set(tileSize) {
            if (tileSize instanceof Array && tileSize.length == 2 && typeof tileSize[0] == 'number' && typeof tileSize[1] == 'number') {
                this.tileSizeX = tileSize[0];
                this.tileSizeY = tileSize[1];
            } else {
                console.error('set Terrain.tileSize: tileSize is not an array of size 2 that contains numbers.');
            }
        }
    }]);

    return Terrain;
}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS5qcyIsImZsYXQuanMiLCJnYW1lLW9iamVjdC5qcyIsInJlbmRlci5qcyIsInJlc291cmNlcy5qcyIsInRlcnJhaW4uanMiXSwibmFtZXMiOlsiRW5naW5lIiwiaW5zdGFuY2UiLCJjb25zb2xlIiwiZXJyb3IiLCJsYXN0VGltZSIsIkRhdGUiLCJub3ciLCJnYW1lT2JqZWN0U2V0IiwiU2V0IiwiY29sbGlzaW9uQ2FuZGlkYXRlU2V0Iiwia2V5Q2FsbGJhY2tTZXQiLCJtb3VzZUNhbGxiYWNrU2V0IiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlS2V5RXZlbnRzIiwiYmluZCIsIlJlbmRlciIsInJlbmRlciIsImNhbnZhcyIsImhhbmRsZU1vdXNlRXZlbnRzIiwiZXZlbnQiLCJjYWxsYmFjayIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJvdXRpbmUiLCJkZWx0YVRpbWUiLCJjdXJyZW50VGltZSIsImdhbWVPYmplY3QiLCJlYXJseVVwZGF0ZSIsImNoZWNrRm9yQ29sbGlzaW9ucyIsImxhdGVVcGRhdGUiLCJnYW1lT2JqZWN0cyIsIl8iLCJmaWx0ZXIiLCJkeW5hbWljT2JqZWN0Iiwib25Db2xsaXNpb25DaGVjayIsInJlZ2lzdGVyQ29sbGlzaW9uQ2hlY2siLCJHYW1lT2JqZWN0IiwiYWRkIiwiZmxhdCIsIkltYWdlT2JqZWN0Iiwic3ByaXRlIiwic3Vic2NyaWJlVG9SZW5kZXIiLCJzZXRTcHJpdGUiLCJwaXZvdFgiLCJwaXZvdFkiLCJ4IiwieSIsIm9yaWdpbmFsc2l6ZVgiLCJvcmlnaW5hbHNpemVZIiwic2NhbGVYIiwic2NhbGVZIiwibGF5ZXIiLCJ2aXNpYmxlIiwiSW1hZ2UiLCJhZGp1c3RTaXplIiwibmF0dXJhbFdpZHRoIiwibmF0dXJhbEhlaWdodCIsInJlZ2lzdGVyT2JqZWN0IiwidW5yZWdpc3Rlck9iamVjdCIsIm5ld0NvcHkiLCJjb3B5UHJvcGVydGllc1RvIiwidGFyZ2V0SW1hZ2VPYmplY3QiLCJwaXZvdCIsInBvc2l0aW9uIiwib3JpZ2luYWxzaXplIiwic2NhbGUiLCJBcnJheSIsImxlbmd0aCIsInN1YnNjcmlicmVUb0VuZ2luZSIsInZ4IiwidnkiLCJvcmlnaW5hbEJvcmRlcldpZHRoIiwib3JpZ2luYWxCb3JkZXJIZWlnaHQiLCJ3YWxrYWJsZSIsImR5bmFtaWMiLCJzdGVwIiwiZW5naW5lIiwicmVnaXN0ZXJDb2xsaXNpb25DYW5kaWRhdGUiLCJvdGhlckJvcmRlciIsIm15Qm9yZGVyIiwiYm9yZGVyIiwiTWF0aCIsIm1pbiIsInJpZ2h0IiwibWF4IiwibGVmdCIsInRvcCIsImJvdHRvbSIsIm90aGVyR2FtZU9iamVjdCIsInRhcmdldEdhbWVPYmplY3QiLCJvcmlnaW5hbEJvcmRlciIsImJvcmRlclJhZGl1cyIsIlBsYXllciIsInN1YnNjcmliZVRvRW5naW5lIiwidXBLZXlzIiwicmlnaHRLZXlzIiwiZG93bktleXMiLCJsZWZ0S2V5cyIsImtleU1hcCIsIk1hcCIsInNldEtleU1hcCIsImxhc3RBY3Rpb24iLCJtb3ZlU3BlZWQiLCJrZXlzIiwiYWN0aW9uIiwia2V5Iiwic2V0IiwicmVnaXN0ZXJLZXlFdmVudENhbGxiYWNrIiwicmVnaXN0ZXJVcGRhdGVDYWxsYmFjayIsImtleUNvZGUiLCJoYXMiLCJnZXQiLCJ0eXBlIiwicGVyZm9ybUFjdGlvbiIsInRhcmdldEJvcmRlciIsImhhc0NvbGxpZGVkIiwiSFRNTENhbnZhc0VsZW1lbnQiLCJjb250ZXh0MkQiLCJnZXRDb250ZXh0IiwidXBkYXRlQ2FudmFzU2l6ZSIsIndpbmRvdyIsIm9yaWdpblgiLCJvcmlnaW5ZIiwiY29vcmRPZmZzZXRYIiwiY29vcmRPZmZzZXRZIiwib2JqZWN0U2V0IiwiZHJhd1RpbGVHcmlkIiwiZHJhd0JvcmRlcnMiLCJkcmF3VGlsZUhpZ2hsaWdodCIsInJlYWxPcmlnaW4iLCJtb3VzZVBvc2l0aW9uIiwiY2FudmFzUmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImNhbnZhc1Bvc2l0aW9uVG9SZW5kZXJDb29yZGluYXRlcyIsIm1vdXNlUG9zaXRpb25Ub0NhbnZhc1JlbGF0aXZlUG9zaXRpb24iLCJUZXJyYWluIiwidGVycmFpbiIsInJlbGF0aXZlQ2FudmFzUG9zaXRpb24iLCJjb29yZGluYXRlcyIsInRpbGVTaXplWCIsInRpbGVTaXplWSIsImZsb29yIiwiY2VpbCIsImNvbnRhaW5lclN0eWxlIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsInBhcmVudEVsZW1lbnQiLCJ3aWR0aCIsInBhcnNlRmxvYXQiLCJwYWRkaW5nTGVmdCIsInBhZGRpbmdSaWdodCIsImJvcmRlckxlZnRXaWR0aCIsImJvcmRlclJpZ2h0V2lkdGgiLCJoZWlnaHQiLCJwYWRkaW5nVG9wIiwicGFkZGluZ0JvdHRvbSIsImJvcmRlclRvcFdpZHRoIiwiYm9yZGVyQm90dG9tV2lkdGgiLCJpbWFnZU9iamVjdCIsImRlbGV0ZSIsImNsZWFyUmVjdCIsInJlbmRlclRlcnJhaW4iLCJyZW5kZXJUaWxlR3JpZCIsInJlbmRlck9iamVjdHMiLCJmaWxsU3R5bGUiLCJ0aWxlcyIsInRpbGUiLCJ0aWxlUG9zaXRpb24iLCJyb3ciLCJ0b0ZpeGVkIiwiY29sdW1uIiwiZHJhd0ltYWdlIiwiaGlnaGxpZ2h0ZWQiLCJmaWxsUmVjdCIsIm9iamVjdFNpemUiLCJvYmplY3RCb3JkZXIiLCJzdHJva2VTdHlsZSIsImxpbmVXaWR0aCIsImNoYWluIiwic29ydEJ5IiwicmV2ZXJzZSIsInZhbHVlIiwib2JqZWN0VG9SZW5kZXIiLCJtYXlSZW5kZXIiLCJzaXplIiwic3Ryb2tlUmVjdCIsImJvcmRlcldpZHRoIiwiYm9yZGVySGVpZ2h0IiwibWluWCIsIm1heFgiLCJtaW5ZIiwibWF4WSIsImJlZ2luUGF0aCIsImxvYWNrZWRQb3NpdGlvbiIsImkiLCJtb3ZlVG8iLCJsaW5lVG8iLCJqIiwic3Ryb2tlIiwib3JpZ2luIiwiY29vcmRPZmZzZXQiLCJJbWFnZVJlc291cmNlU3RhdHVzIiwiSU5JVElBVElORyIsIkZBSUxFRCIsIkxPQURJTkciLCJMT0FERUQiLCJJbWFnZVJlc291cmNlIiwicHJvZ3Jlc3MiLCJzdGF0dXMiLCJvbkxvYWQiLCJvblByb2dyZXNzIiwib25TdGF0dXNDaGFuZ2VkIiwibG9nIiwic2V0UHJvZ3Jlc3MiLCJpbWciLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbmxvYWRzdGFydCIsInNldFN0YXR1cyIsIm9ucHJvZ3Jlc3MiLCJvbmxvYWQiLCJvbmVycm9yIiwic291cmNlIiwiYWxpYXMiLCJzcmMiLCJpbWFnZVNyYyIsImNvbXBsZXRlIiwic2V0VHJpZ2dlcnMiLCJSZXNvdXJjZXMiLCJpbWFnZUNhY2hlIiwiaW1nU291cmNlIiwibmV3SW1hZ2VSZXNvdXJjZSIsImFsZXJ0Iiwic2V0U291cmNlIiwic291cmNlcyIsInByb21pc2VzIiwiZW50cnkiLCJwdXNoIiwiYWRkSW1hZ2UiLCJhcHBseSIsImFsbCIsImNhY2hlIiwiZ2V0T3JBZGRJbWFnZSIsIlRpbGUiLCJOdW1iZXIiLCJ0aWxlTWFwIiwidGlsZUhpZ2hsaWdodE1hcCIsInNldFRpbGUiLCJjbGVhciIsInZhbHVlcyIsInRpbGVTaXplIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7SUFHTUE7QUFDRjs7O0FBR0Esc0JBQWM7QUFBQTs7QUFDVixZQUFHQSxPQUFPQyxRQUFQLFlBQTJCRCxNQUE5QixFQUFzQztBQUNsQ0Usb0JBQVFDLEtBQVIsQ0FBYyxxREFBZDtBQUNBLG1CQUFPLElBQVA7QUFDSDs7QUFFREgsZUFBT0MsUUFBUCxHQUFrQixJQUFsQjs7QUFFQSxhQUFLRyxRQUFMLEdBQWdCQyxLQUFLQyxHQUFMLEVBQWhCO0FBQ0EsYUFBS0MsYUFBTCxHQUFxQixJQUFJQyxHQUFKLEVBQXJCO0FBQ0EsYUFBS0MscUJBQUwsR0FBNkIsSUFBSUQsR0FBSixFQUE3QjtBQUNBLGFBQUtFLGNBQUwsR0FBc0IsSUFBSUYsR0FBSixFQUF0QjtBQUNBLGFBQUtHLGdCQUFMLEdBQXdCLElBQUlILEdBQUosRUFBeEI7O0FBRUFJLGlCQUFTQyxnQkFB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O0FBQ0g7MEJBRVkrRyxVQUFVO0FBQ25CLGdCQUFLQSxvQkFBb0J6TCxLQUFyQixJQUFnQ3lMLFNBQVN4TCxNQUFULElBQW1CLENBQW5ELElBQTBELE9BQU93TCxTQUFTLENBQVQsQ0FBUCxJQUFzQixRQUFoRixJQUE4RixPQUFPQSxTQUFTLENBQVQsQ0FBUCxJQUFzQixRQUF4SCxFQUFvSTtBQUNoSSxxQkFBS2hILFNBQUwsR0FBaUJnSCxTQUFTLENBQVQsQ0FBakI7QUFDQSxxQkFBSy9HLFNBQUwsR0FBaUIrRyxTQUFTLENBQVQsQ0FBakI7QUFDSCxhQUhELE1BSUs7QUFDRHpQLHdCQUFRQyxLQUFSLENBQWMsaUZBQWQ7QUFDSDtBQUNKIiwiZmlsZSI6ImZsYXQtZW5naW5lLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4qIEBjbGFzc1xyXG4qL1xyXG5jbGFzcyBFbmdpbmUge1xyXG4gICAgLyoqXHJcbiAgICAqIEBjb25zdHJ1Y3RvclxyXG4gICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIGlmKEVuZ2luZS5pbnN0YW5jZSBpbnN0YW5jZW9mIEVuZ2luZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFbmdpbmUuY29uc3RydWN0b3I6IEVuZ2luZSBpbnN0YW5jZSBhbHJlYWR5IGV4aXN0cy4nKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBFbmdpbmUuaW5zdGFuY2UgPSB0aGlzO1xyXG5cclxuICAgICAgICB0aGlzLmxhc3RUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgICAgICB0aGlzLmdhbWVPYmplY3RTZXQgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgdGhpcy5jb2xsaXNpb25DYW5kaWRhdGVTZXQgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgdGhpcy5rZXlDYWxsYmFja1NldCA9IG5ldyBTZXQoKTtcclxuICAgICAgICB0aGlzLm1vdXNlQ2FsbGJhY2tTZXQgPSBuZXcgU2V0KCk7XHJcblxyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5oYW5kbGVLZXlFdmVudHMuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuaGFuZGxlS2V5RXZlbnRzLmJpbmQodGhpcykpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgdGhpcy5oYW5kbGVLZXlFdmVudHMuYmluZCh0aGlzKSk7XHJcblxyXG4gICAgICAgIGlmKCFSZW5kZXIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRW5naW5lLmNvbnN0cnVjdG9yOiBSZW5kZXIgY2xhc3MgaXMgbm90IGRlZmluZWQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoIShSZW5kZXIuaW5zdGFuY2UgaW5zdGFuY2VvZiBSZW5kZXIpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VuZ2luZS5jb25zdHJ1Y3RvcjogVGhlcmUgaXMgbm8gcmVuZGVyIGluc3RhbmNlIHRvIHN1YnNjcmlicmUgbW91c2UgZXZlbnRzLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIgPSBSZW5kZXIuaW5zdGFuY2U7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuaGFuZGxlTW91c2VFdmVudHMuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3V0JywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2F1eGNsaWNrJywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuaGFuZGxlTW91c2VFdmVudHMuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5oYW5kbGVNb3VzZUV2ZW50cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlS2V5RXZlbnRzKGV2ZW50KSB7XHJcbiAgICAgICAgZm9yKGNvbnN0IGNhbGxiYWNrIG9mIHRoaXMua2V5Q2FsbGJhY2tTZXQpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBoYW5kbGVNb3VzZUV2ZW50cyhldmVudCkge1xyXG4gICAgICAgIGZvcihjb25zdCBjYWxsYmFjayBvZiB0aGlzLm1vdXNlQ2FsbGJhY2tTZXQpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGFydCgpIHtcclxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5yb3V0aW5lLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjdXJyZW50VGltZSgpIHtcclxuICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTtcclxuICAgIH1cclxuXHJcbiAgICByb3V0aW5lKCkge1xyXG4gICAgICAgIGNvbnN0IGRlbHRhVGltZSA9ICh0aGlzLmN1cnJlbnRUaW1lIC0gdGhpcy5sYXN0VGltZSkvMTAwMDtcclxuXHJcbiAgICAgICAgZm9yKGNvbnN0IGdhbWVPYmplY3Qgb2YgdGhpcy5nYW1lT2JqZWN0U2V0KSB7XHJcbiAgICAgICAgICAgIGdhbWVPYmplY3QuZWFybHlVcGRhdGUoZGVsdGFUaW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2hlY2tGb3JDb2xsaXNpb25zKCk7XHJcblxyXG4gICAgICAgIGZvcihjb25zdCBnYW1lT2JqZWN0IG9mIHRoaXMuZ2FtZU9iamVjdFNldCkge1xyXG4gICAgICAgICAgICBnYW1lT2JqZWN0LmxhdGVVcGRhdGUoZGVsdGFUaW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyLnJlbmRlcigpO1xyXG5cclxuICAgICAgICB0aGlzLmxhc3RUaW1lID0gdGhpcy5jdXJyZW50VGltZTtcclxuXHJcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMucm91dGluZS5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuXHJcbiAgICBjaGVja0ZvckNvbGxpc2lvbnMoKSB7XHJcbiAgICAgICAgY29uc3QgZ2FtZU9iamVjdHMgPSBbLi4udGhpcy5jb2xsaXNpb25DYW5kaWRhdGVTZXRdO1xyXG5cclxuICAgICAgICBmb3IoY29uc3QgZHluYW1pY09iamVjdCBvZiBfLmZpbHRlcihnYW1lT2JqZWN0cywgJ2R5bmFtaWMnKSkge1xyXG4gICAgICAgICAgICBmb3IoY29uc3QgZ2FtZU9iamVjdCBvZiBnYW1lT2JqZWN0cykge1xyXG4gICAgICAgICAgICAgICAgaWYoZ2FtZU9iamVjdCAhPSBkeW5hbWljT2JqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZHluYW1pY09iamVjdC5vbkNvbGxpc2lvbkNoZWNrKGdhbWVPYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiBAY2FsbGJhY2sgcm91dGluZUNhbGxiYWNrXHJcbiAgICAqIEBwYXJhbSB7bnVtYmVyfSBkZWx0YVRpbWUgLSB0aW1lIHNpbmNlIHRoZSBjYWxsYmFjayB3YXMgbGFzdCBjYWxsZWQuXHJcbiAgICAqL1xyXG5cclxuICAgIC8qKlxyXG4gICAgKiBAbWV0aG9kIHJlZ2lzdGVyVXBkYXRlQ2FsbGJhY2sgLSBhZGQgYSBjYWxsYmFjayB0byBiZSBpbnZva2VkIGJ5IHRoZSBlbmdpbmUuXHJcbiAgICAqIEBwYXJhbSB7cm91dGluZUNhbGxiYWNrfSBjYWxsYmFja1xyXG4gICAgKi9cclxuICAgIHJlZ2lzdGVyVXBkYXRlQ2FsbGJhY2soZ2FtZU9iamVjdCwgcmVnaXN0ZXJDb2xsaXNpb25DaGVjayA9IHRydWUpIHtcclxuICAgICAgICBpZighR2FtZU9iamVjdCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFbmdpbmUucmVnaXN0ZXJVcGRhdGVDYWxsYmFjazogR2FtZU9iamVjdCBjbGFzcyBpcyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighKGdhbWVPYmplY3QgaW5zdGFuY2VvZiBHYW1lT2JqZWN0KSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFbmdpbmUucmVnaXN0ZXJVcGRhdGVDYWxsYmFjazogZ2FtZU9iamVjdCBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgR2FtZU9iamVjdC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZU9iamVjdFNldC5hZGQoZ2FtZU9iamVjdCk7XHJcblxyXG4gICAgICAgICAgICBpZihyZWdpc3RlckNvbGxpc2lvbkNoZWNrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbGxpc2lvbkNhbmRpZGF0ZVNldC5hZGQoZ2FtZU9iamVjdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVnaXN0ZXJDb2xsaXNpb25DYW5kaWRhdGUoZ2FtZU9iamVjdCkge1xyXG4gICAgICAgIGlmKCFHYW1lT2JqZWN0KSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VuZ2luZS5yZWdpc3RlclVwZGF0ZUNhbGxiYWNrOiBHYW1lT2JqZWN0IGNsYXNzIGlzIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKCEoZ2FtZU9iamVjdCBpbnN0YW5jZW9mIEdhbWVPYmplY3QpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VuZ2luZS5yZWdpc3RlclVwZGF0ZUNhbGxiYWNrOiBnYW1lT2JqZWN0IGlzIG5vdCBhbiBpbnN0YW5jZSBvZiBHYW1lT2JqZWN0LicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xsaXNpb25DYW5kaWRhdGVTZXQuYWRkKGdhbWVPYmplY3QpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWdpc3RlcktleUV2ZW50Q2FsbGJhY2soY2FsbGJhY2spIHtcclxuICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICB0aGlzLmtleUNhbGxiYWNrU2V0LmFkZChjYWxsYmFjayk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFbmdpbmUucmVnaXN0ZXJLZXlFdmVudENhbGxiYWNrOiBjYWxsYmFjayBpcyBub3Qgc2V0IGFzIGEgZnVuY3Rpb24uJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyTW91c2VFdmVudENhbGxiYWNrKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZUNhbGxiYWNrU2V0LmFkZChjYWxsYmFjayk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFbmdpbmUucmVnaXN0ZXJNb3VzZUV2ZW50Q2FsbGJhY2s6IGNhbGxiYWNrIGlzIG5vdCBzZXQgYXMgYSBmdW5jdGlvbi4nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwiY29uc3QgZmxhdCA9IHt9O1xyXG4iLCIvKipcclxuKiBAY2xhc3NcclxuKi9cclxuY2xhc3MgSW1hZ2VPYmplY3Qge1xyXG4gICAgLyoqXHJcbiAgICAqIEBjb25zdHJ1Y3RvclxyXG4gICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHNwcml0ZSwgc3Vic2NyaWJlVG9SZW5kZXIgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYoc3ByaXRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0U3ByaXRlKHNwcml0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnBpdm90WCA9IDAuNTtcclxuICAgICAgICB0aGlzLnBpdm90WSA9IDAuNTtcclxuXHJcbiAgICAgICAgdGhpcy54ID0gMDtcclxuICAgICAgICB0aGlzLnkgPSAwO1xyXG5cclxuICAgICAgICB0aGlzLm9yaWdpbmFsc2l6ZVggPSB0aGlzLm9yaWdpbmFsc2l6ZVggfHwgMDtcclxuICAgICAgICB0aGlzLm9yaWdpbmFsc2l6ZVkgPSB0aGlzLm9yaWdpbmFsc2l6ZVkgfHwgMDtcclxuXHJcbiAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xyXG4gICAgICAgIHRoaXMuc2NhbGVZID0gMTtcclxuXHJcbiAgICAgICAgdGhpcy5sYXllciA9IDA7XHJcblxyXG4gICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmKCFSZW5kZXIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW1hZ2VPYmplY3QuY29uc3RydWN0b3I6IFJlbmRlciBjbGFzcyBpcyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighKFJlbmRlci5pbnN0YW5jZSBpbnN0YW5jZW9mIFJlbmRlcikpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW1hZ2VPYmplY3QuY29uc3RydWN0b3I6IFRoZXJlIGlzIG5vIHJlbmRlciBpbnN0YW5jZSB0byBzdWJzY3JpYnJlIHRvLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIgPSBSZW5kZXIuaW5zdGFuY2U7XHJcbiAgICAgICAgICAgIGlmKHN1YnNjcmliZVRvUmVuZGVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZVRvUmVuZGVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHBpdm90KCkge1xyXG4gICAgICAgIHJldHVybiBbdGhpcy5waXZvdFgsIHRoaXMucGl2b3RZXTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgcGl2b3QocGl2b3QpIHtcclxuICAgICAgICBpZiggKHBpdm90IGluc3RhbmNlb2YgQXJyYXkpICYmIChwaXZvdC5sZW5ndGggPT0gMikgJiYgKHR5cGVvZiBwaXZvdFswXSA9PSAnbnVtYmVyJykgJiYgKHR5cGVvZiBwaXZvdFsxXSA9PSAnbnVtYmVyJykgKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGl2b3RYID0gcGl2b3RbMF07XHJcbiAgICAgICAgICAgIHRoaXMucGl2b3RZID0gcGl2b3RbMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzZXQgSW1hZ2VPYmplY3QucGl2b3Q6IHBpdm90IGlzIG5vdCBhbiBhcnJheSBvZiBzaXplIDIgdGhhdCBjb250YWlucyBudW1iZXJzLicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgcG9zaXRpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIFt0aGlzLngsIHRoaXMueV07XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHBvc2l0aW9uKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgaWYoIChwb3NpdGlvbiBpbnN0YW5jZW9mIEFycmF5KSAmJiAocG9zaXRpb24ubGVuZ3RoID09IDIpICYmICh0eXBlb2YgcG9zaXRpb25bMF0gPT0gJ251bWJlcicpICYmICh0eXBlb2YgcG9zaXRpb25bMV0gPT0gJ251bWJlcicpICkge1xyXG4gICAgICAgICAgICB0aGlzLnggPSBwb3NpdGlvblswXTtcclxuICAgICAgICAgICAgdGhpcy55ID0gcG9zaXRpb25bMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzZXQgSW1hZ2VPYmplY3QucG9zaXRpb246IHBvc2l0aW9uIGlzIG5vdCBhbiBhcnJheSBvZiBzaXplIDIgdGhhdCBjb250YWlucyBudW1iZXJzLicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgc2l6ZVgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3JpZ2luYWxzaXplWCp0aGlzLnNjYWxlWDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc2l6ZVkoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3JpZ2luYWxzaXplWSp0aGlzLnNjYWxlWTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc2l6ZSgpIHtcclxuICAgICAgICByZXR1cm4gW3RoaXMub3JpZ2luYWxzaXplWCp0aGlzLnNjYWxlWCwgdGhpcy5vcmlnaW5hbHNpemVZKnRoaXMuc2NhbGVZXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgb3JpZ2luYWxzaXplKCkge1xyXG4gICAgICAgIHJldHVybiBbdGhpcy5vcmlnaW5hbHNpemVYLCB0aGlzLm9yaWdpbmFsc2l6ZVldO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBvcmlnaW5hbHNpemUob3JpZ2luYWxzaXplKSB7XHJcbiAgICAgICAgaWYoIChvcmlnaW5hbHNpemUgaW5zdGFuY2VvZiBBcnJheSkgJiYgKG9yaWdpbmFsc2l6ZS5sZW5ndGggPT0gMikgJiYgKHR5cGVvZiBvcmlnaW5hbHNpemVbMF0gPT0gJ251bWJlcicpICYmICh0eXBlb2Ygb3JpZ2luYWxzaXplWzFdID09ICdudW1iZXInKSApIHtcclxuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbHNpemVYID0gb3JpZ2luYWxzaXplWzBdO1xyXG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsc2l6ZVkgPSBvcmlnaW5hbHNpemVbMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzZXQgSW1hZ2VPYmplY3Qub3JpZ2luYWxzaXplOiBvcmlnaW5hbHNpemUgaXMgbm90IGFuIGFycmF5IG9mIHNpemUgMiB0aGF0IGNvbnRhaW5zIG51bWJlcnMuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBzY2FsZSgpIHtcclxuICAgICAgICByZXR1cm4gW3RoaXMuc2NhbGVYLCB0aGlzLnNjYWxlWV07XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHNjYWxlKHNjYWxlKSB7XHJcbiAgICAgICAgaWYoIChzY2FsZSBpbnN0YW5jZW9mIEFycmF5KSAmJiAoc2NhbGUubGVuZ3RoID09IDIpICYmICh0eXBlb2Ygc2NhbGVbMF0gPT0gJ251bWJlcicpICYmICh0eXBlb2Ygc2NhbGVbMV0gPT0gJ251bWJlcicpICkge1xyXG4gICAgICAgICAgICB0aGlzLnNjYWxlWCA9IHNjYWxlWzBdO1xyXG4gICAgICAgICAgICB0aGlzLnNjYWxlWSA9IHNjYWxlWzFdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKHR5cGVvZiBzY2FsZSA9PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICB0aGlzLnNjYWxlWCA9IHNjYWxlO1xyXG4gICAgICAgICAgICB0aGlzLnNjYWxlWSA9IHNjYWxlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignc2V0IEltYWdlT2JqZWN0LnNjYWxlOiBzY2FsZSBpcyBub3QgYW4gYXJyYXkgb2Ygc2l6ZSAyIHRoYXQgY29udGFpbnMgbnVtYmVycyBvciBzaW1wbHkgYSBudW1iZXIuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1heVJlbmRlcigpIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMuc3ByaXRlIGluc3RhbmNlb2YgSW1hZ2UpICYmIHRoaXMudmlzaWJsZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRTcHJpdGUoc3ByaXRlLCBhZGp1c3RTaXplID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmKHNwcml0ZSBpbnN0YW5jZW9mIEltYWdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gc3ByaXRlO1xyXG5cclxuICAgICAgICAgICAgaWYoYWRqdXN0U2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbHNpemVYID0gc3ByaXRlLm5hdHVyYWxXaWR0aDtcclxuICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxzaXplWSA9IHNwcml0ZS5uYXR1cmFsSGVpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoc3ByaXRlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0dhbWVPYmplY3QuY29uc3RydWN0b3I6IHNwcml0ZSBpcyBub3Qgc2V0IGFzIGEgSW1hZ2Ugb2JqZWN0LicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdWJzY3JpYmVUb1JlbmRlcigpIHtcclxuICAgICAgICB0aGlzLnJlbmRlci5yZWdpc3Rlck9iamVjdCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICB1bnN1YnNjcmliZVRvUmVuZGVyKCkge1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnVucmVnaXN0ZXJPYmplY3QodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ29weSgpIHtcclxuICAgICAgICBjb25zdCBuZXdDb3B5ID0gbmV3IEltYWdlT2JqZWN0KHRoaXMuc3ByaXRlLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIHRoaXMuY29weVByb3BlcnRpZXNUbyhuZXdDb3B5KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld0NvcHk7XHJcbiAgICB9XHJcblxyXG4gICAgY29weVByb3BlcnRpZXNUbyh0YXJnZXRJbWFnZU9iamVjdCkge1xyXG4gICAgICAgIGlmKCh0YXJnZXRJbWFnZU9iamVjdCBpbnN0YW5jZW9mIEltYWdlT2JqZWN0KSkge1xyXG4gICAgICAgICAgICB0YXJnZXRJbWFnZU9iamVjdC5zcHJpdGUgPSB0aGlzLnNwcml0ZTtcclxuXHJcbiAgICAgICAgICAgIHRhcmdldEltYWdlT2JqZWN0LnBpdm90ID0gW3RoaXMucGl2b3RYLCB0aGlzLnBpdm90WV07XHJcbiAgICAgICAgICAgIHRhcmdldEltYWdlT2JqZWN0LnBvc2l0aW9uID0gW3RoaXMueCwgdGhpcy55XTtcclxuXHJcbiAgICAgICAgICAgIHRhcmdldEltYWdlT2JqZWN0Lm9yaWdpbmFsc2l6ZSA9IFt0aGlzLm9yaWdpbmFsc2l6ZVgsIHRoaXMub3JpZ2luYWxzaXplWV07XHJcblxyXG4gICAgICAgICAgICB0YXJnZXRJbWFnZU9iamVjdC5zY2FsZSA9IFt0aGlzLnNjYWxlWCwgdGhpcy5zY2FsZVldO1xyXG5cclxuICAgICAgICAgICAgdGFyZ2V0SW1hZ2VPYmplY3QubGF5ZXIgPSB0aGlzLmxheWVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW1hZ2VPYmplY3QuY29weVByb3BlcnRpZXNUbzogdGFyZ2V0SW1hZ2VPYmplY3QgaXMgbm90IGEgSW1hZ2VPYmplY3QgaW5zdGFuY2UuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuKiBAY2xhc3NcclxuKi9cclxuY2xhc3MgR2FtZU9iamVjdCBleHRlbmRzIEltYWdlT2JqZWN0IHtcclxuICAgIC8qKlxyXG4gICAgKiBAY29uc3RydWN0b3JcclxuICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihzcHJpdGUsIHN1YnNjcmliZVRvUmVuZGVyID0gdHJ1ZSwgc3Vic2NyaWJyZVRvRW5naW5lID0gdHJ1ZSkge1xyXG4gICAgICAgIHN1cGVyKHNwcml0ZSwgc3Vic2NyaWJlVG9SZW5kZXIpO1xyXG5cclxuICAgICAgICB0aGlzLnZ4ID0gMDtcclxuICAgICAgICB0aGlzLnZ5ID0gMDtcclxuXHJcbiAgICAgICAgdGhpcy5vcmlnaW5hbEJvcmRlcldpZHRoID0gdGhpcy5vcmlnaW5hbHNpemVYIHx8IDY0O1xyXG4gICAgICAgIHRoaXMub3JpZ2luYWxCb3JkZXJIZWlnaHQgPSB0aGlzLm9yaWdpbmFsc2l6ZVkgfHwgNjQ7XHJcblxyXG4gICAgICAgIHRoaXMud2Fsa2FibGUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmR5bmFtaWMgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdGhpcy5zdGVwID0gWzAsIDBdO1xyXG5cclxuICAgICAgICBpZighRW5naW5lKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0dhbWVPYmplY3QuY29uc3RydWN0b3I6IEVuZ2luZSBjbGFzcyBpcyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighKEVuZ2luZS5pbnN0YW5jZSBpbnN0YW5jZW9mIEVuZ2luZSkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignR2FtZU9iamVjdC5jb25zdHJ1Y3RvcjogVGhlcmUgaXMgbm8gRW5naW5lIGluc3RhbmNlIHRvIHN1YnNjcmlicmUgdG8uJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmVuZ2luZSA9IEVuZ2luZS5pbnN0YW5jZTtcclxuXHJcbiAgICAgICAgICAgIGlmKHN1YnNjcmlicmVUb0VuZ2luZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbmdpbmUucmVnaXN0ZXJDb2xsaXNpb25DYW5kaWRhdGUodGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZWFybHlVcGRhdGUoZGVsdGFUaW1lKSB7XHJcbiAgICAgICAgdGhpcy5zdGVwWzBdID0gdGhpcy52eCpkZWx0YVRpbWU7XHJcbiAgICAgICAgdGhpcy5zdGVwWzFdID0gdGhpcy52eSpkZWx0YVRpbWU7XHJcbiAgICB9XHJcblxyXG4gICAgbGF0ZVVwZGF0ZSgpIHtcclxuICAgICAgICB0aGlzLnggKz0gdGhpcy5zdGVwWzBdO1xyXG4gICAgICAgIHRoaXMueSArPSB0aGlzLnN0ZXBbMV07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGJvcmRlcldpZHRoKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9yaWdpbmFsQm9yZGVyV2lkdGgqdGhpcy5zY2FsZVg7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGJvcmRlckhlaWdodCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5vcmlnaW5hbEJvcmRlckhlaWdodCp0aGlzLnNjYWxlWTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgb3JpZ2luYWxCb3JkZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIFt0aGlzLm9yaWdpbmFsQm9yZGVyV2lkdGgsIHRoaXMub3JpZ2luYWxCb3JkZXJIZWlnaHRdO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBvcmlnaW5hbEJvcmRlcihvcmlnaW5hbEJvcmRlcikge1xyXG4gICAgICAgIGlmKCAob3JpZ2luYWxCb3JkZXIgaW5zdGFuY2VvZiBBcnJheSkgJiYgKG9yaWdpbmFsQm9yZGVyLmxlbmd0aCA9PSAyKSAmJiAodHlwZW9mIG9yaWdpbmFsQm9yZGVyWzBdID09ICdudW1iZXInKSAmJiAodHlwZW9mIG9yaWdpbmFsQm9yZGVyWzFdID09ICdudW1iZXInKSApIHtcclxuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEJvcmRlcldpZHRoID0gb3JpZ2luYWxCb3JkZXJbMF07XHJcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxCb3JkZXJIZWlnaHQgPSBvcmlnaW5hbEJvcmRlclsxXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3NldCBJbWFnZU9iamVjdC5vcmlnaW5hbEJvcmRlcjogb3JpZ2luYWxCb3JkZXIgaXMgbm90IGFuIGFycmF5IG9mIHNpemUgMiB0aGF0IGNvbnRhaW5zIG51bWJlcnMuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBib3JkZXIoKSB7XHJcbiAgICAgICAgY29uc3QgYm9yZGVyUmFkaXVzID0gWysgMC41KnRoaXMub3JpZ2luYWxCb3JkZXJXaWR0aCp0aGlzLnNjYWxlWCwgMC41KnRoaXMub3JpZ2luYWxCb3JkZXJIZWlnaHQqdGhpcy5zY2FsZVldO1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0b3A6IHRoaXMueSArIGJvcmRlclJhZGl1c1sxXSxcclxuICAgICAgICAgICAgcmlnaHQ6IHRoaXMueCArIGJvcmRlclJhZGl1c1swXSxcclxuICAgICAgICAgICAgYm90dG9tOiB0aGlzLnkgLSBib3JkZXJSYWRpdXNbMV0sXHJcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMueCAtIGJvcmRlclJhZGl1c1swXVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaGFzQ29sbGlkZWQob3RoZXJCb3JkZXIpIHtcclxuICAgICAgICBjb25zdCBteUJvcmRlciA9IHRoaXMuYm9yZGVyO1xyXG5cclxuICAgICAgICByZXR1cm4gKE1hdGgubWluKG15Qm9yZGVyLnJpZ2h0LCBvdGhlckJvcmRlci5yaWdodCkgLSBNYXRoLm1heChteUJvcmRlci5sZWZ0LCBvdGhlckJvcmRlci5sZWZ0KSA+PSAwKSAmJiAoTWF0aC5taW4obXlCb3JkZXIudG9wLCBvdGhlckJvcmRlci50b3ApIC0gTWF0aC5tYXgobXlCb3JkZXIuYm90dG9tLCBvdGhlckJvcmRlci5ib3R0b20pID49IDApO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ29sbGlzaW9uKG90aGVyR2FtZU9iamVjdCkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVDb3B5KCkge1xyXG4gICAgICAgIGNvbnN0IG5ld0NvcHkgPSBuZXcgR2FtZU9iamVjdCh0aGlzLnNwcml0ZSwgZmFsc2UpO1xyXG5cclxuICAgICAgICB0aGlzLmNvcHlQcm9wZXJ0aWVzVG8obmV3Q29weSk7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXdDb3B5O1xyXG4gICAgfVxyXG5cclxuICAgIGNvcHlQcm9wZXJ0aWVzVG8odGFyZ2V0R2FtZU9iamVjdCkge1xyXG4gICAgICAgIGlmKCh0YXJnZXRHYW1lT2JqZWN0IGluc3RhbmNlb2YgR2FtZU9iamVjdCkpIHtcclxuICAgICAgICAgICAgc3VwZXIuY29weVByb3BlcnRpZXNUbyh0YXJnZXRHYW1lT2JqZWN0KTtcclxuXHJcbiAgICAgICAgICAgIHRhcmdldEdhbWVPYmplY3QudnggPSB0aGlzLnZ4O1xyXG4gICAgICAgICAgICB0YXJnZXRHYW1lT2JqZWN0LnZ5ID0gdGhpcy52eTtcclxuXHJcbiAgICAgICAgICAgIHRhcmdldEdhbWVPYmplY3Qub3JpZ2luYWxCb3JkZXJXaWR0aCA9IHRoaXMub3JpZ2luYWxCb3JkZXJXaWR0aDtcclxuICAgICAgICAgICAgdGFyZ2V0R2FtZU9iamVjdC5vcmlnaW5hbEJvcmRlckhlaWdodCA9IHRoaXMub3JpZ2luYWxCb3JkZXJIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdHYW1lT2JqZWN0LmNvcHlQcm9wZXJ0aWVzVG86IHRhcmdldEdhbWVPYmplY3QgaXMgbm90IGEgR2FtZU9iamVjdCBpbnN0YW5jZS4nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4qIEBjbGFzc1xyXG4qL1xyXG5jbGFzcyBQbGF5ZXIgZXh0ZW5kcyBHYW1lT2JqZWN0IHtcclxuICAgIC8qKlxyXG4gICAgKiBAY29uc3RydWN0b3JcclxuICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBzcHJpdGUsXHJcbiAgICAgICAgc3Vic2NyaWJlVG9FbmdpbmUgPSB0cnVlLFxyXG4gICAgICAgIHN1YnNjcmliZVRvUmVuZGVyID0gdHJ1ZSxcclxuICAgICAgICB1cEtleXMgPSBbODcsIDM4XSxcclxuICAgICAgICByaWdodEtleXMgPSBbNjgsIDM5XSxcclxuICAgICAgICBkb3duS2V5cyA9IFs4MywgNDBdLFxyXG4gICAgICAgIGxlZnRLZXlzID0gWzY1LCAzN11cclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKHNwcml0ZSwgc3Vic2NyaWJlVG9SZW5kZXIsIHN1YnNjcmliZVRvRW5naW5lKTtcclxuXHJcbiAgICAgICAgdGhpcy5rZXlNYXAgPSBuZXcgTWFwKCk7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0S2V5TWFwKHVwS2V5cywgJ3VwJyk7XHJcbiAgICAgICAgdGhpcy5zZXRLZXlNYXAocmlnaHRLZXlzLCAncmlnaHQnKTtcclxuICAgICAgICB0aGlzLnNldEtleU1hcChkb3duS2V5cywgJ2Rvd24nKTtcclxuICAgICAgICB0aGlzLnNldEtleU1hcChsZWZ0S2V5cywgJ2xlZnQnKTtcclxuXHJcbiAgICAgICAgdGhpcy5sYXN0QWN0aW9uID0gJ25vbmUnO1xyXG5cclxuICAgICAgICB0aGlzLm1vdmVTcGVlZCA9IDIwMDtcclxuXHJcbiAgICAgICAgdGhpcy53YWxrYWJsZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5keW5hbWljID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYoIUVuZ2luZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdQbGF5ZXIuY29uc3RydWN0b3I6IEVuZ2luZSBjbGFzcyBpcyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighKEVuZ2luZS5pbnN0YW5jZSBpbnN0YW5jZW9mIEVuZ2luZSkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUGxheWVyLmNvbnN0cnVjdG9yOiBUaGVyZSBpcyBubyBFbmdpbmUgaW5zdGFuY2UgdG8gc3Vic2NyaWJyZSB0by4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW5naW5lID0gRW5naW5lLmluc3RhbmNlO1xyXG4gICAgICAgICAgICBpZihzdWJzY3JpYmVUb0VuZ2luZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVUb0VuZ2luZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEtleU1hcChrZXlzLCBhY3Rpb24pIHtcclxuICAgICAgICBmb3IoY29uc3Qga2V5IG9mIGtleXMpIHtcclxuICAgICAgICAgICAgdGhpcy5rZXlNYXAuc2V0KGtleSwgYWN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3Vic2NyaWJlVG9FbmdpbmUoKSB7XHJcbiAgICAgICAgdGhpcy5lbmdpbmUucmVnaXN0ZXJLZXlFdmVudENhbGxiYWNrKHRoaXMuaGFuZGxlS2V5RXZlbnRzLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMuZW5naW5lLnJlZ2lzdGVyVXBkYXRlQ2FsbGJhY2sodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlS2V5RXZlbnRzKGV2ZW50KSB7XHJcbiAgICAgICAgaWYoZXZlbnQua2V5Q29kZSAmJiB0aGlzLmtleU1hcC5oYXMoZXZlbnQua2V5Q29kZSkpIHtcclxuICAgICAgICAgICAgbGV0IGFjdGlvbiA9IHRoaXMua2V5TWFwLmdldChldmVudC5rZXlDb2RlKTtcclxuXHJcbiAgICAgICAgICAgIGlmKGV2ZW50LnR5cGUgPT0gJ2tleXVwJykge1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uICs9ICdDYW5jZWwnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnBlcmZvcm1BY3Rpb24oYWN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25Db2xsaXNpb25DaGVjayhvdGhlckdhbWVPYmplY3QpIHtcclxuICAgICAgICBpZighb3RoZXJHYW1lT2JqZWN0LndhbGthYmxlKSB7XHJcbiAgICAgICAgICAgIGxldCBteUJvcmRlcjtcclxuICAgICAgICAgICAgY29uc3QgdGFyZ2V0Qm9yZGVyID0gb3RoZXJHYW1lT2JqZWN0LmJvcmRlcjtcclxuXHJcbiAgICAgICAgICAgIGlmKHRoaXMuc3RlcFswXSAhPSAwKSB7XHJcbiAgICAgICAgICAgICAgICBteUJvcmRlciA9IHRoaXMuYm9yZGVyO1xyXG4gICAgICAgICAgICAgICAgbXlCb3JkZXIubGVmdCArPSB0aGlzLnN0ZXBbMF07XHJcbiAgICAgICAgICAgICAgICBteUJvcmRlci5yaWdodCArPSB0aGlzLnN0ZXBbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYob3RoZXJHYW1lT2JqZWN0Lmhhc0NvbGxpZGVkKG15Qm9yZGVyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc3RlcFswXSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGVwWzBdICs9IHRhcmdldEJvcmRlci5sZWZ0IC0gbXlCb3JkZXIucmlnaHQgLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGVwWzBdICs9IHRhcmdldEJvcmRlci5yaWdodCAtIG15Qm9yZGVyLmxlZnQgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYodGhpcy5zdGVwWzFdICE9IDApIHtcclxuICAgICAgICAgICAgICAgIG15Qm9yZGVyID0gdGhpcy5ib3JkZXI7XHJcbiAgICAgICAgICAgICAgICBteUJvcmRlci50b3AgKz0gdGhpcy5zdGVwWzFdO1xyXG4gICAgICAgICAgICAgICAgbXlCb3JkZXIuYm90dG9tICs9IHRoaXMuc3RlcFsxXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihvdGhlckdhbWVPYmplY3QuaGFzQ29sbGlkZWQobXlCb3JkZXIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zdGVwWzFdID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0ZXBbMV0gKz0gdGFyZ2V0Qm9yZGVyLmJvdHRvbSAtIG15Qm9yZGVyLnRvcCAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0ZXBbMV0gKz0gdGFyZ2V0Qm9yZGVyLnRvcCAtIG15Qm9yZGVyLmJvdHRvbSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHBlcmZvcm1BY3Rpb24oYWN0aW9uID0gJ25vbmUnKSB7XHJcbiAgICAgICAgaWYodGhpcy5sYXN0QWN0aW9uICE9IGFjdGlvbikge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSB0aGlzLm1vdmVTcGVlZDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3VwQ2FuY2VsJzpcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnZ5ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IHRoaXMubW92ZVNwZWVkO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAncmlnaHRDYW5jZWwnOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudnggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtdGhpcy5tb3ZlU3BlZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdkb3duQ2FuY2VsJzpcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnZ5IDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLXRoaXMubW92ZVNwZWVkO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnbGVmdENhbmNlbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy52eCA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnbm9uZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmxhc3RBY3Rpb24gPSBhY3Rpb247XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsImNsYXNzIFJlbmRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihjYW52YXMpIHtcclxuICAgICAgICBpZihSZW5kZXIuaW5zdGFuY2UgaW5zdGFuY2VvZiBSZW5kZXIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVuZGVyLmNvbnN0cnVjdG9yOiBSZW5kZXIgaW5zdGFuY2UgYWxyZWFkeSBleGlzdHMuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoIShjYW52YXMgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlJlbmRlci5jb25zdHJ1Y3RvcjogZ2l2ZW4gY2FudmFzIG9iamVjdCBpcyBub3QgYW4gSFRNTENhbnZhc0VsZW1lbnQuXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFJlbmRlci5pbnN0YW5jZSA9IHRoaXM7XHJcblxyXG4gICAgICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xyXG4gICAgICAgIHRoaXMuY29udGV4dDJEID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVDYW52YXNTaXplKCk7XHJcblxyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnVwZGF0ZUNhbnZhc1NpemUpO1xyXG5cclxuICAgICAgICAvLyBDb29yZGluYXRlIHN5dGVtLiBBeGlzIG9yaWVudGF0aW9uIHdpbGwgYmU6IFgtPnJpZ2h0ICwgWS0+dXBcclxuICAgICAgICB0aGlzLm9yaWdpblggPSAwLjU7XHJcbiAgICAgICAgdGhpcy5vcmlnaW5ZID0gMC41O1xyXG5cclxuICAgICAgICB0aGlzLmNvb3JkT2Zmc2V0WCA9IDA7XHJcbiAgICAgICAgdGhpcy5jb29yZE9mZnNldFkgPSAwO1xyXG5cclxuICAgICAgICB0aGlzLm9iamVjdFNldCA9IG5ldyBTZXQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5kcmF3VGlsZUdyaWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmRyYXdCb3JkZXJzID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5kcmF3VGlsZUhpZ2hsaWdodCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbnZhc1Bvc2l0aW9uVG9SZW5kZXJDb29yZGluYXRlcyhwb3NpdGlvbikge1xyXG4gICAgICAgIGlmKCAocG9zaXRpb24gaW5zdGFuY2VvZiBBcnJheSkgJiYgKHBvc2l0aW9uLmxlbmd0aCA9PSAyKSAmJiAodHlwZW9mIHBvc2l0aW9uWzBdID09ICdudW1iZXInKSAmJiAodHlwZW9mIHBvc2l0aW9uWzFdID09ICdudW1iZXInKSApIHtcclxuICAgICAgICAgICAgY29uc3QgcmVhbE9yaWdpbiA9IHRoaXMucmVhbE9yaWdpbjtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvblswXSAtIHJlYWxPcmlnaW5bMF0sXHJcbiAgICAgICAgICAgICAgICByZWFsT3JpZ2luWzFdIC0gcG9zaXRpb25bMV1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3NldCBSZW5kZXIuY2FudmFzUG9zaXRpb25Ub1JlbmRlckNvb3JkaW5hdGVzOiBwb3NpdGlvbiBpcyBub3QgYW4gYXJyYXkgb2Ygc2l6ZSAyIHRoYXQgY29udGFpbnMgbnVtYmVycy4nKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1vdXNlUG9zaXRpb25Ub0NhbnZhc1JlbGF0aXZlUG9zaXRpb24obW91c2VQb3NpdGlvbikge1xyXG4gICAgICAgIGNvbnN0IGNhbnZhc1JlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgbW91c2VQb3NpdGlvblswXSAtIGNhbnZhc1JlY3QubGVmdCxcclxuICAgICAgICAgICAgbW91c2VQb3NpdGlvblsxXSAtIGNhbnZhc1JlY3QudG9wXHJcbiAgICAgICAgXTtcclxuICAgIH1cclxuXHJcbiAgICBtb3VzZVBvc2l0aW9uVG9SZW5kZXJDb29yZGluYXRlcyhtb3VzZVBvc2l0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzUG9zaXRpb25Ub1JlbmRlckNvb3JkaW5hdGVzKHRoaXMubW91c2VQb3NpdGlvblRvQ2FudmFzUmVsYXRpdmVQb3NpdGlvbihtb3VzZVBvc2l0aW9uKSk7XHJcbiAgICB9XHJcblxyXG4gICAgbW91c2VQb3NpdGlvblRvVGlsZUNvb3JkaW5hdGVzKG1vdXNlUG9zaXRpb24pIHtcclxuICAgICAgICBpZighVGVycmFpbikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZW5kZXIubW91c2VQb3NpdGlvblRvVGlsZUNvb3JkaW5hdGVzOiBUZXJyYWluIGNsYXNzIGlzIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKCEodGhpcy50ZXJyYWluIGluc3RhbmNlb2YgVGVycmFpbikpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVuZGVyLm1vdXNlUG9zaXRpb25Ub1RpbGVDb29yZGluYXRlczogdGVycmFpbiBpcyBub3Qgc2V0LicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgcmVhbE9yaWdpbiA9IHRoaXMucmVhbE9yaWdpbjtcclxuICAgICAgICAgICAgY29uc3QgcmVsYXRpdmVDYW52YXNQb3NpdGlvbiA9IHRoaXMubW91c2VQb3NpdGlvblRvQ2FudmFzUmVsYXRpdmVQb3NpdGlvbihtb3VzZVBvc2l0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gW1xyXG4gICAgICAgICAgICAgICAgMC41ICsgKHJlbGF0aXZlQ2FudmFzUG9zaXRpb25bMF0gLSByZWFsT3JpZ2luWzBdKS90aGlzLnRlcnJhaW4udGlsZVNpemVYLFxyXG4gICAgICAgICAgICAgICAgLTAuNSArIChyZWFsT3JpZ2luWzFdIC0gcmVsYXRpdmVDYW52YXNQb3NpdGlvblsxXSkvdGhpcy50ZXJyYWluLnRpbGVTaXplWVxyXG4gICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoY29vcmRpbmF0ZXNbMF0pLFxyXG4gICAgICAgICAgICAgICAgTWF0aC5jZWlsKGNvb3JkaW5hdGVzWzFdKVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgb3JpZ2luKCkge1xyXG4gICAgICAgIHJldHVybiBbdGhpcy5vcmlnaW5YLCB0aGlzLm9yaWdpblldO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBvcmlnaW4ob3JpZ2luKSB7XHJcbiAgICAgICAgaWYoIChvcmlnaW4gaW5zdGFuY2VvZiBBcnJheSkgJiYgKG9yaWdpbi5sZW5ndGggPT0gMikgJiYgKHR5cGVvZiBvcmlnaW5bMF0gPT0gJ251bWJlcicpICYmICh0eXBlb2Ygb3JpZ2luWzFdID09ICdudW1iZXInKSApIHtcclxuICAgICAgICAgICAgdGhpcy5vcmlnaW5YID0gb3JpZ2luWzBdO1xyXG4gICAgICAgICAgICB0aGlzLm9yaWdpblkgPSBvcmlnaW5bMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzZXQgUmVuZGVyLm9yaWdpbjogb3JpZ2luIGlzIG5vdCBhbiBhcnJheSBvZiBzaXplIDIgdGhhdCBjb250YWlucyBudW1iZXJzLicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgY29vcmRPZmZzZXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIFt0aGlzLmNvb3JkT2Zmc2V0WCwgdGhpcy5jb29yZE9mZnNldFldO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBjb29yZE9mZnNldChjb29yZE9mZnNldCkge1xyXG4gICAgICAgIGlmKCAoY29vcmRPZmZzZXQgaW5zdGFuY2VvZiBBcnJheSkgJiYgKGNvb3JkT2Zmc2V0Lmxlbmd0aCA9PSAyKSAmJiAodHlwZW9mIGNvb3JkT2Zmc2V0WzBdID09ICdudW1iZXInKSAmJiAodHlwZW9mIGNvb3JkT2Zmc2V0WzFdID09ICdudW1iZXInKSApIHtcclxuICAgICAgICAgICAgdGhpcy5jb29yZE9mZnNldFggPSBjb29yZE9mZnNldFswXS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29vcmRPZmZzZXRZID0gY29vcmRPZmZzZXRbMV0udG9GaXhlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignc2V0IFJlbmRlci5jb29yZE9mZnNldDogY29vcmRPZmZzZXQgaXMgbm90IGFuIGFycmF5IG9mIHNpemUgMiB0aGF0IGNvbnRhaW5zIG51bWJlcnMuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCByZWFsT3JpZ2luKCkge1xyXG4gICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgIHRoaXMub3JpZ2luWCp0aGlzLmNhbnZhcy53aWR0aCArIHRoaXMuY29vcmRPZmZzZXRYLFxyXG4gICAgICAgICAgICAoMSAtIHRoaXMub3JpZ2luWSkqdGhpcy5jYW52YXMuaGVpZ2h0IC0gdGhpcy5jb29yZE9mZnNldFlcclxuICAgICAgICBdO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUNhbnZhc1NpemUoKSB7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmNhbnZhcy5wYXJlbnRFbGVtZW50KTtcclxuXHJcbiAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSBwYXJzZUZsb2F0KGNvbnRhaW5lclN0eWxlLndpZHRoKSAtIHBhcnNlRmxvYXQoY29udGFpbmVyU3R5bGUucGFkZGluZ0xlZnQpIC0gcGFyc2VGbG9hdChjb250YWluZXJTdHlsZS5wYWRkaW5nUmlnaHQpIC0gcGFyc2VGbG9hdChjb250YWluZXJTdHlsZS5ib3JkZXJMZWZ0V2lkdGgpIC0gcGFyc2VGbG9hdChjb250YWluZXJTdHlsZS5ib3JkZXJSaWdodFdpZHRoKTtcclxuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSBwYXJzZUZsb2F0KGNvbnRhaW5lclN0eWxlLmhlaWdodCkgLSBwYXJzZUZsb2F0KGNvbnRhaW5lclN0eWxlLnBhZGRpbmdUb3ApIC0gcGFyc2VGbG9hdChjb250YWluZXJTdHlsZS5wYWRkaW5nQm90dG9tKSAtIHBhcnNlRmxvYXQoY29udGFpbmVyU3R5bGUuYm9yZGVyVG9wV2lkdGgpIC0gcGFyc2VGbG9hdChjb250YWluZXJTdHlsZS5ib3JkZXJCb3R0b21XaWR0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVnaXN0ZXJPYmplY3QoaW1hZ2VPYmplY3QpIHtcclxuICAgICAgICBpZighSW1hZ2VPYmplY3QpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVuZGVyLnJlZ2lzdGVyT2JqZWN0OiBJbWFnZU9iamVjdCBjbGFzcyBpcyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighKGltYWdlT2JqZWN0IGluc3RhbmNlb2YgSW1hZ2VPYmplY3QpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlbmRlci5yZWdpc3Rlck9iamVjdDogaW1hZ2VPYmplY3QgaXMgbm90IGEgSW1hZ2VPYmplY3Qgb2JqZWN0LicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5vYmplY3RTZXQuYWRkKGltYWdlT2JqZWN0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdW5yZWdpc3Rlck9iamVjdChpbWFnZU9iamVjdCkge1xyXG4gICAgICAgIGlmKCFJbWFnZU9iamVjdCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZW5kZXIucmVnaXN0ZXJPYmplY3Q6IEltYWdlT2JqZWN0IGNsYXNzIGlzIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKCEoaW1hZ2VPYmplY3QgaW5zdGFuY2VvZiBJbWFnZU9iamVjdCkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVuZGVyLnJlZ2lzdGVyT2JqZWN0OiBpbWFnZU9iamVjdCBpcyBub3QgYSBJbWFnZU9iamVjdCBvYmplY3QuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm9iamVjdFNldC5kZWxldGUoaW1hZ2VPYmplY3QpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRUZXJyYWluKHRlcnJhaW4pIHtcclxuICAgICAgICBpZighVGVycmFpbikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZW5kZXIuc2V0VGVycmFpbjogVGVycmFpbiBjbGFzcyBpcyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighKHRlcnJhaW4gaW5zdGFuY2VvZiBUZXJyYWluKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZW5kZXIuc2V0VGVycmFpbjogdGVycmFpbiBpcyBub3QgYSBUZXJyYWluIG9iamVjdC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudGVycmFpbiA9IHRlcnJhaW47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlcigpIHtcclxuICAgICAgICB0aGlzLmNvbnRleHQyRC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyVGVycmFpbigpO1xyXG5cclxuICAgICAgICBpZih0aGlzLmRyYXdUaWxlR3JpZCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlclRpbGVHcmlkKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJlbmRlck9iamVjdHMoKTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJUZXJyYWluKCkge1xyXG4gICAgICAgIGNvbnN0IHJlYWxPcmlnaW4gPSB0aGlzLnJlYWxPcmlnaW47XHJcblxyXG4gICAgICAgIHRoaXMuY29udGV4dDJELmZpbGxTdHlsZSA9ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNCknO1xyXG5cclxuICAgICAgICBpZih0aGlzLnRlcnJhaW4pIHtcclxuICAgICAgICAgICAgZm9yKGNvbnN0IHRpbGUgb2YgdGhpcy50ZXJyYWluLnRpbGVzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0aWxlUG9zaXRpb24gPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgKHJlYWxPcmlnaW5bMF0gKyAodGlsZS5yb3cgLSAwLjUpKnRoaXMudGVycmFpbi50aWxlU2l6ZVgpLnRvRml4ZWQoKSxcclxuICAgICAgICAgICAgICAgICAgICAocmVhbE9yaWdpblsxXSAtICh0aWxlLmNvbHVtbiArIDAuNSkqdGhpcy50ZXJyYWluLnRpbGVTaXplWSkudG9GaXhlZCgpXHJcbiAgICAgICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKHRpbGUuc3ByaXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0MkQuZHJhd0ltYWdlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aWxlLnNwcml0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGlsZVBvc2l0aW9uWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aWxlUG9zaXRpb25bMV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnRlcnJhaW4udGlsZVNpemVYKS50b0ZpeGVkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnRlcnJhaW4udGlsZVNpemVZKS50b0ZpeGVkKClcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuZHJhd1RpbGVIaWdobGlnaHQgJiYgdGlsZS5oaWdobGlnaHRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dDJELmZpbGxSZWN0KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aWxlUG9zaXRpb25bMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbGVQb3NpdGlvblsxXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMudGVycmFpbi50aWxlU2l6ZVgpLnRvRml4ZWQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMudGVycmFpbi50aWxlU2l6ZVkpLnRvRml4ZWQoKVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyT2JqZWN0cygpIHtcclxuICAgICAgICBjb25zdCByZWFsT3JpZ2luID0gdGhpcy5yZWFsT3JpZ2luO1xyXG5cclxuICAgICAgICBsZXQgb2JqZWN0U2l6ZSwgb2JqZWN0Qm9yZGVyO1xyXG5cclxuICAgICAgICB0aGlzLmNvbnRleHQyRC5zdHJva2VTdHlsZSA9ICdwdXJwbGUnO1xyXG4gICAgICAgIHRoaXMuY29udGV4dDJELmxpbmVXaWR0aCA9IDI7XHJcblxyXG4gICAgICAgIGZvcihjb25zdCBvYmplY3RUb1JlbmRlciBvZiBfLmNoYWluKFsuLi50aGlzLm9iamVjdFNldF0pLnNvcnRCeSgneScpLnJldmVyc2UoKS5zb3J0QnkoJ2xheWVyJykudmFsdWUoKSkge1xyXG4gICAgICAgICAgICBpZihvYmplY3RUb1JlbmRlci5tYXlSZW5kZXIoKSkge1xyXG4gICAgICAgICAgICAgICAgb2JqZWN0U2l6ZSA9IG9iamVjdFRvUmVuZGVyLnNpemU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQyRC5kcmF3SW1hZ2UoXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0VG9SZW5kZXIuc3ByaXRlLFxyXG4gICAgICAgICAgICAgICAgICAgIChyZWFsT3JpZ2luWzBdICsgb2JqZWN0VG9SZW5kZXIueCAtIG9iamVjdFRvUmVuZGVyLnBpdm90WCpvYmplY3RTaXplWzBdKS50b0ZpeGVkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgKHJlYWxPcmlnaW5bMV0gLSAob2JqZWN0VG9SZW5kZXIueSArICgxIC0gb2JqZWN0VG9SZW5kZXIucGl2b3RZKSpvYmplY3RTaXplWzFdKSkudG9GaXhlZCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIChvYmplY3RTaXplWzBdKS50b0ZpeGVkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgKG9iamVjdFNpemVbMV0pLnRvRml4ZWQoKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmRyYXdCb3JkZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIUdhbWVPYmplY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVuZGVyLnJlbmRlck9iamVjdHM6IEdhbWVPYmplY3QgY2xhc3Mgbm90IGRlZmluZWQuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoKG9iamVjdFRvUmVuZGVyIGluc3RhbmNlb2YgR2FtZU9iamVjdCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0Qm9yZGVyID0gb2JqZWN0VG9SZW5kZXIuYm9yZGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQyRC5zdHJva2VSZWN0KHJlYWxPcmlnaW5bMF0gKyBvYmplY3RCb3JkZXIubGVmdCwgcmVhbE9yaWdpblsxXSAtIG9iamVjdEJvcmRlci50b3AsIG9iamVjdFRvUmVuZGVyLmJvcmRlcldpZHRoLCBvYmplY3RUb1JlbmRlci5ib3JkZXJIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJUaWxlR3JpZCgpIHtcclxuICAgICAgICBpZih0aGlzLnRlcnJhaW4pIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0MkQuc3Ryb2tlU3R5bGUgPSAnd2hpdGUnO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQyRC5saW5lV2lkdGggPSAxO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcmVhbE9yaWdpbiA9IHRoaXMucmVhbE9yaWdpbjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1pblggPSBNYXRoLmNlaWwoMC41IC0gcmVhbE9yaWdpblswXS90aGlzLnRlcnJhaW4udGlsZVNpemVYKTtcclxuICAgICAgICAgICAgY29uc3QgbWF4WCA9IE1hdGguZmxvb3IoMC41ICsgKHRoaXMuY2FudmFzLndpZHRoIC0gcmVhbE9yaWdpblswXSkvdGhpcy50ZXJyYWluLnRpbGVTaXplWCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtaW5ZID0gTWF0aC5jZWlsKC0wLjUgKyAocmVhbE9yaWdpblsxXSAtIHRoaXMuY2FudmFzLmhlaWdodCkvdGhpcy50ZXJyYWluLnRpbGVTaXplWSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1heFkgPSBNYXRoLmZsb29yKC0wLjUgKyByZWFsT3JpZ2luWzFdL3RoaXMudGVycmFpbi50aWxlU2l6ZVkpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0MkQuYmVnaW5QYXRoKCk7XHJcblxyXG4gICAgICAgICAgICBsZXQgbG9hY2tlZFBvc2l0aW9uID0gMDtcclxuXHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IG1pblg7IGkgPD0gbWF4WDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBsb2Fja2VkUG9zaXRpb24gPSAocmVhbE9yaWdpblswXSArIChpIC0gMC41KSp0aGlzLnRlcnJhaW4udGlsZVNpemVYKS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQyRC5tb3ZlVG8obG9hY2tlZFBvc2l0aW9uLCAwKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dDJELmxpbmVUbyhsb2Fja2VkUG9zaXRpb24sdGhpcy5jYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yKGxldCBqID0gbWluWTsgaiA8PSBtYXhZOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGxvYWNrZWRQb3NpdGlvbiA9IChyZWFsT3JpZ2luWzFdIC0gKGogKyAwLjUpKnRoaXMudGVycmFpbi50aWxlU2l6ZVkpLnRvRml4ZWQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dDJELm1vdmVUbygwLCBsb2Fja2VkUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0MkQubGluZVRvKHRoaXMuY2FudmFzLndpZHRoLCBsb2Fja2VkUG9zaXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQyRC5zdHJva2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwiY29uc3QgSW1hZ2VSZXNvdXJjZVN0YXR1cyA9IHtcclxuICAgIElOSVRJQVRJTkc6ICdJbml0aWF0aW5nJyxcclxuICAgIEZBSUxFRDogJ0ZhaWxlZCcsXHJcbiAgICBMT0FESU5HOiAnTG9hZGluZycsXHJcbiAgICBMT0FERUQ6ICdMb2FkZWQnXHJcbn07XHJcblxyXG5jbGFzcyBJbWFnZVJlc291cmNlIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3MgPSAwO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gSW1hZ2VSZXNvdXJjZVN0YXR1cy5JTklUSUFUSU5HO1xyXG4gICAgICAgIHRoaXMub25Mb2FkID0gbnVsbDtcclxuICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsO1xyXG4gICAgICAgIHRoaXMub25TdGF0dXNDaGFuZ2VkID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0IElNQUdFX1NUQVRVUygpIHtcclxuICAgICAgICByZXR1cm4gSW1hZ2VSZXNvdXJjZVN0YXR1cztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbG9hZGVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN0YXR1cyA9PSBJbWFnZVJlc291cmNlU3RhdHVzLkxPQURFRDtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQcm9ncmVzcyhwcm9ncmVzcykge1xyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3MgPSBwcm9ncmVzcztcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coYEltYWdlUmVzb3VyY2Uuc2V0UHJvZ3Jlc3M6ICR7cHJvZ3Jlc3N9YCk7XHJcblxyXG4gICAgICAgIGlmKHRoaXMub25Qcm9ncmVzcykge1xyXG4gICAgICAgICAgICB0aGlzLm9uUHJvZ3Jlc3ModGhpcy5wcm9ncmVzcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFN0YXR1cyhzdGF0dXMpIHtcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcclxuXHJcbiAgICAgICAgaWYodGhpcy5vblN0YXR1c0NoYW5nZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5vblN0YXR1c0NoYW5nZWQodGhpcy5zdGF0dXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLnN0YXR1cykge1xyXG4gICAgICAgICAgICBjYXNlIEltYWdlUmVzb3VyY2VTdGF0dXMuSU5JVElBVElORzpcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIEltYWdlUmVzb3VyY2VTdGF0dXMuRkFJTEVEOlxyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgSW1hZ2VSZXNvdXJjZVN0YXR1cy5MT0FESU5HOlxyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgSW1hZ2VSZXNvdXJjZVN0YXR1cy5MT0FERUQ6XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UHJvZ3Jlc3MoMSk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMub25Mb2FkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uTG9hZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VHJpZ2dlcnMoKSB7XHJcbiAgICAgICAgaWYodGhpcy5pbWcpIHtcclxuICAgICAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbWcub25sb2Fkc3RhcnQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoSW1hZ2VSZXNvdXJjZVN0YXR1cy5MT0FESU5HKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5vbnByb2dyZXNzID0gcHJvZ3Jlc3MgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSB0aGlzLnNldFByb2dyZXNzKHByb2dyZXNzKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoSW1hZ2VSZXNvdXJjZVN0YXR1cy5MT0FERUQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodGhpcyk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbWcub25lcnJvciA9IChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdHVzKEltYWdlUmVzb3VyY2VTdGF0dXMuRkFJTEVEKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFNvdXJjZShzb3VyY2UsIGFsaWFzKSB7XHJcbiAgICAgICAgaWYoc291cmNlKSB7XHJcbiAgICAgICAgICAgIGlmKHNvdXJjZSBpbnN0YW5jZW9mIEltYWdlKSB7XHJcbiAgICAgICAgICAgICAgICBpZihzb3VyY2Uuc3JjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYWxpYXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGlhcyA9IGFsaWFzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZVNyYyA9IHNvdXJjZS5zcmM7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWcgPSBzb3VyY2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHNvdXJjZS5jb21wbGV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1cyhJbWFnZVJlc291cmNlU3RhdHVzLkxPQURFRCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFRyaWdnZXJzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW1hZ2VSZXNvdXJjZSByZXF1aXJlcyBhIHByb3BlciBzb3VyY2UuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZih0eXBlb2Ygc291cmNlID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICBpZihhbGlhcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWxpYXMgPSBhbGlhcztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmltYWdlU3JjID0gc291cmNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRyaWdnZXJzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuc3JjID0gc291cmNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW1hZ2VSZXNvdXJjZSByZXF1aXJlcyBhIHByb3BlciBzb3VyY2UuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBSZXNvdXJjZXMge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5pbWFnZUNhY2hlID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiBAbWV0aG9kIGFkZEltYWdlIC0gQWRkIGFuIGltYWdlIHJlc291cmNlIGFuZCBzdGFydHMgbG9hZGluZyBpdCBpZiBwb3NzaWJsZS5cclxuICAgICogQHBhcmFtIHtPYmplY3R8c3RyaW5nfSBpbWdTb3VyY2UgLSBpbWFnZSBzb3VyY2UuIEl0IG1heSBiZSBhbiBpbWcgZWxlbWVudCBvYmplY3Qgb3IgdGhlIGltZyB1cmwgc3RyaW5nLlxyXG4gICAgKiBAcGFyYW0ge3N0cmluZ30gW2FsaWFzXSAtIGltYWdlIGFsaWFzIHVzZWQgdG8gcmV0cmlldmUgcmVzb3VyY2UuIGlmIGltZ1NvdXJjZSBpcyBhIHN0cmluZyBhbmQgYWxpYXMgaXMgbm90IHNwZWNpZmllZCwgdGhlbiB0aGUgYWxpYXMgd2lsbCBiZSBzZXQgdG8gdGhlIGltZ1NvdXJjZS5cclxuICAgICogQHJldHVybiB7UHJvbWlzc2V9IC0gcHJvbWlzZSB0aGF0IGZ1bGxmaWxscyB3aGVuIHRoZSByZXNvdXJjZSBoYXMgbG9hZGVkLlxyXG4gICAgKi9cclxuICAgIGFkZEltYWdlKGltZ1NvdXJjZSwgYWxpYXMpIHtcclxuICAgICAgICBpZiggKHR5cGVvZiBpbWdTb3VyY2UgPT0gJ3N0cmluZycpICYmICFhbGlhcyApIHtcclxuICAgICAgICAgICAgYWxpYXMgPSBpbWdTb3VyY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBuZXdJbWFnZVJlc291cmNlID0gbmV3IEltYWdlUmVzb3VyY2UoKTtcclxuXHJcbiAgICAgICAgaWYoIWFsaWFzKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXNvdXJjZXMuYWRkSW1hZ2U6IGFsaWFzIG5vdCBzZXQgYW5kIHRodXMgdGhpcyBpbWFnZSB3aWxsIG5vdCBiZSBjYWNoZWQhJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZih0aGlzLmltYWdlQ2FjaGUuaGFzKGFsaWFzKSkge1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KGBSZXNvdXJjZXMuYWRkSW1hZ2U6IGltYWdlIGFsaWFzIFwiJHthbGlhc31cIiBpcyBhbHJlYWR5IGJlaW5nIHVzZWQgYW5kIHdpbGwgYmUgb3ZlcndyaXR0ZW4uYCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VDYWNoZS5zZXQoYWxpYXMsIG5ld0ltYWdlUmVzb3VyY2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld0ltYWdlUmVzb3VyY2Uuc2V0U291cmNlKGltZ1NvdXJjZSwgYWxpYXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiBAbWV0aG9kIGFkZEltYWdlcyAtIFNhbWUgYXMgYWRkSW1hZ2UgYnV0IGZvciBtdWx0cGxlIGltYWdlIHJlc291cmNlcy5cclxuICAgICogQHBhcmFtIHtBcnJheX0gc291cmNlcyAtIGVhY2ggZWxlbWVudCBzaG91bGQgYmUgYW4gYXJyYXkgdGhhdCBtYXRjaGVzIHRoZSBhcmd1bWVudHMgb2YgdGhlIGFkZEltYWdlIG1ldGhvZDogW2ltZ1NvdXJjZSwgYWxpYXNdLlxyXG4gICAgKiBAcmV0dXJuIHtQcm9taXNzZX0gLSBwcm9taXNlIHRoYXQgZnVsbGZpbGxzIHdoZW4gYWxsIHJlc291cmNlcyBoYXZlIGxvYWRlZC5cclxuICAgICovXHJcbiAgICBhZGRJbWFnZXMoc291cmNlcykge1xyXG4gICAgICAgIGlmKCEoc291cmNlcyBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZXNvdXJjZXMuYWRkSW1hZ2VzOiBhcmd1bWVudCBpcyBub3QgYW4gYXJyYXknKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHByb21pc2VzID0gW107XHJcblxyXG4gICAgICAgIGZvcihjb25zdCBlbnRyeSBvZiBzb3VyY2VzKSB7XHJcbiAgICAgICAgICAgIGlmKGVudHJ5IGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2godGhpcy5hZGRJbWFnZS5hcHBseSh0aGlzLCBlbnRyeSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaCh0aGlzLmFkZEltYWdlKGVudHJ5KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0T3JBZGRJbWFnZShpbWdTb3VyY2UsIGFsaWFzKSB7XHJcbiAgICAgICAgaWYoICh0eXBlb2YgaW1nU291cmNlID09ICdzdHJpbmcnKSAmJiAhYWxpYXMgKSB7XHJcbiAgICAgICAgICAgIGFsaWFzID0gaW1nU291cmNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbmV3SW1hZ2VSZXNvdXJjZSA9IG5ldyBJbWFnZVJlc291cmNlKCk7XHJcblxyXG4gICAgICAgIGlmKCFhbGlhcykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUmVzb3VyY2VzLmFkZEltYWdlOiBhbGlhcyBub3Qgc2V0IGFuZCB0aHVzIHRoaXMgaW1hZ2Ugd2lsbCBub3QgYmUgY2FjaGVkIScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmltYWdlQ2FjaGUuZ2V0KGFsaWFzKTtcclxuXHJcbiAgICAgICAgICAgIGlmKGNhY2hlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY2FjaGUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW1hZ2VDYWNoZS5zZXQoYWxpYXMsIG5ld0ltYWdlUmVzb3VyY2UpO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3SW1hZ2VSZXNvdXJjZS5zZXRTb3VyY2UoaW1nU291cmNlLCBhbGlhcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0T3JBZGRJbWFnZXMoc291cmNlcykge1xyXG4gICAgICAgIGlmKCEoc291cmNlcyBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZXNvdXJjZXMuYWRkSW1hZ2VzOiBhcmd1bWVudCBpcyBub3QgYW4gYXJyYXknKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHByb21pc2VzID0gW107XHJcblxyXG4gICAgICAgIGZvcihjb25zdCBlbnRyeSBvZiBzb3VyY2VzKSB7XHJcbiAgICAgICAgICAgIGlmKGVudHJ5IGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2godGhpcy5nZXRPckFkZEltYWdlLmFwcGx5KHRoaXMsIGVudHJ5KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMuZ2V0T3JBZGRJbWFnZShlbnRyeSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiBAbWV0aG9kIGdldEltYWdlIC0gcmV0dXJucyB0aGUgaW1nIGVsZW1lbnQgb2JqZWN0IHJlc3BlY3RpdmUgdG8gdGhlIGdpdmVuIGFsaWFzLlxyXG4gICAgKi9cclxuICAgIGdldEltYWdlKGFsaWFzKSB7XHJcbiAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmltYWdlQ2FjaGUuZ2V0KGFsaWFzKTtcclxuXHJcbiAgICAgICAgaWYoIWNhY2hlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Jlc291cmNlcy5nZXRJbWFnZTogY291bGQgbm90IGZpbmQgYWxpYXMgXCIke2FsaWFzfVwiJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY2FjaGU7XHJcbiAgICB9XHJcbn1cclxuIiwiY2xhc3MgVGlsZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihyb3csIGNvbHVtbiwgc3ByaXRlKSB7XHJcbiAgICAgICAgaWYoc3ByaXRlIGluc3RhbmNlb2YgSW1hZ2UpIHtcclxuICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBzcHJpdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoc3ByaXRlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RpbGUuY29uc3RydWN0b3I6IHNwcml0ZSBpcyBub3QgYSBJbWFnZSBvYmplY3QuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcm93ID0gTnVtYmVyKHJvdy50b0ZpeGVkKCkpO1xyXG4gICAgICAgIGNvbHVtbiA9IE51bWJlcihjb2x1bW4udG9GaXhlZCgpKTtcclxuXHJcbiAgICAgICAgaWYoICh0eXBlb2Ygcm93ID09ICdudW1iZXInKSAmJiAodHlwZW9mIGNvbHVtbiA9PSAnbnVtYmVyJykgKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm93ID0gcm93O1xyXG4gICAgICAgICAgICB0aGlzLmNvbHVtbiA9IGNvbHVtbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RpbGUuY29uc3RydWN0b3I6IHJvdyBhbmQgY29sdW1uIG11c3QgYmUgbnVtYmVycy4nKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmhpZ2hsaWdodGVkID0gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIFRlcnJhaW4ge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy50aWxlU2l6ZVggPSA2NDtcclxuICAgICAgICB0aGlzLnRpbGVTaXplWSA9IDY0O1xyXG5cclxuICAgICAgICB0aGlzLnRpbGVNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy50aWxlSGlnaGxpZ2h0TWFwID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0aWxlcygpIHtcclxuICAgICAgICByZXR1cm4gWy4uLnRoaXMudGlsZU1hcC52YWx1ZXMoKV07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHRpbGVTaXplKCkge1xyXG4gICAgICAgIHJldHVybiBbdGhpcy50aWxlU2l6ZVgsIHRoaXMudGlsZVNpemVZXTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdGlsZVNpemUodGlsZVNpemUpIHtcclxuICAgICAgICBpZiggKHRpbGVTaXplIGluc3RhbmNlb2YgQXJyYXkpICYmICh0aWxlU2l6ZS5sZW5ndGggPT0gMikgJiYgKHR5cGVvZiB0aWxlU2l6ZVswXSA9PSAnbnVtYmVyJykgJiYgKHR5cGVvZiB0aWxlU2l6ZVsxXSA9PSAnbnVtYmVyJykgKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGlsZVNpemVYID0gdGlsZVNpemVbMF07XHJcbiAgICAgICAgICAgIHRoaXMudGlsZVNpemVZID0gdGlsZVNpemVbMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzZXQgVGVycmFpbi50aWxlU2l6ZTogdGlsZVNpemUgaXMgbm90IGFuIGFycmF5IG9mIHNpemUgMiB0aGF0IGNvbnRhaW5zIG51bWJlcnMuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBzZXRUaWxlKHRpbGUpIHtcclxuICAgICAgICBpZighKHRpbGUgaW5zdGFuY2VvZiBUaWxlKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdUZXJyYWluLnNldFRpbGU6IHRpbGUgaXMgbm90IGEgVGlsZSBvYmplY3QuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRpbGVNYXAuc2V0KGAke3RpbGUucm93fXgke3RpbGUuY29sdW1ufWAsIHRpbGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRUaWxlcyh0aWxlcykge1xyXG4gICAgICAgIGlmKCEodGlsZXMgaW5zdGFuY2VvZiBBcnJheSkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignVGVycmFpbi5zZXRUaWxlczogdGlsZXMgaXMgbm90IGFuIEFycmF5LicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZm9yKGNvbnN0IHRpbGUgb2YgdGlsZXMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VGlsZSh0aWxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRUaWxlSGlnaGxpZ2h0KHJvdywgY29sdW1uLCBoaWdobGlnaHRlZCA9IHRydWUpIHtcclxuICAgICAgICBpZiggKHR5cGVvZiByb3cgPT0gJ251bWJlcicpICYmICh0eXBlb2YgY29sdW1uID09ICdudW1iZXInKSAmJiAodHlwZW9mIGhpZ2hsaWdodGVkID09ICdib29sZWFuJykgKSB7XHJcbiAgICAgICAgICAgIGxldCB0aWxlID0gdGhpcy50aWxlTWFwLmdldChgJHtyb3d9eCR7Y29sdW1ufWApO1xyXG4gICAgICAgICAgICBpZighdGlsZSkge1xyXG4gICAgICAgICAgICAgICAgdGlsZSA9IG5ldyBUaWxlKHJvdywgY29sdW1uKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VGlsZSh0aWxlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGlsZS5oaWdobGlnaHRlZCA9IGhpZ2hsaWdodGVkO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRpbGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdUZXJyYWluLnNldFRpbGVIaWdobGlnaHQ6IHJvdyBhbmQgY29sdW1uIG11c3QgYmUgbnVtYmVycyBhbmQgaGlnaGxpZ2h0ZWQgbXVzdCBiZSBhIGJvb2xlYW4uJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhcigpIHtcclxuICAgICAgICB0aGlzLnRpbGVNYXAuY2xlYXIoKTtcclxuICAgICAgICB0aGlzLnRpbGVIaWdobGlnaHRNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICB9XHJcbn1cclxuIl19
